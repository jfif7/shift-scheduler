(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{143:(e,t,s)=>{"use strict";s.d(t,{LocaleProvider:()=>l,Y:()=>o});var i=s(5155),a=s(2115),n=s(6096);let r=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[l,o]=(0,a.useState)("en"),[c,d]=(0,a.useState)(null);return((0,a.useEffect)(()=>{let e=localStorage.getItem("locale");e&&("en"===e||"zh-TW"===e)&&o(e)},[]),(0,a.useEffect)(()=>{(async()=>{try{let e=await s(5272)("./".concat(l,".json"));d(e.default)}catch(e){console.error("Failed to load messages:",e)}})()},[l]),c)?(0,i.jsx)(r.Provider,{value:{locale:l,setLocale:e=>{o(e),localStorage.setItem("locale",e)}},children:(0,i.jsx)(n.A,{locale:l,messages:c,children:t})}):(0,i.jsx)("div",{children:"Loading..."})}function o(){let e=(0,a.useContext)(r);if(void 0===e)throw Error("useLocale must be used within a LocaleProvider");return e}},1216:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>tI});var i=s(5155),a=s(2115),n=s(2473),r=s(2596),l=s(9688);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,r.$)(t))}function c(e){let{className:t,...s}=e;return(0,i.jsx)(n.bL,{"data-slot":"tabs",className:o("flex flex-col gap-2",t),...s})}function d(e){let{className:t,...s}=e;return(0,i.jsx)(n.B8,{"data-slot":"tabs-list",className:o("bg-background text-muted-foreground w-full border-b shadow-sm",t),...s})}function h(e){let{className:t,...s}=e;return(0,i.jsx)(n.l9,{"data-slot":"tabs-trigger",className:o("data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-muted-foreground inline-flex h-14 items-center justify-center gap-2 px-8 py-4 text-sm font-medium whitespace-nowrap transition-all hover:text-foreground hover:bg-muted/80 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 relative after:absolute after:bottom-0 after:left-0 after:right-0 after:h-1 after:bg-transparent data-[state=active]:after:bg-primary",t),...s})}function u(e){let{className:t,...s}=e;return(0,i.jsx)(n.UC,{"data-slot":"tabs-content",className:o("flex-1 outline-none",t),...s})}var m=s(9708),f=s(2085);let p=(0,f.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function g(e){let{className:t,variant:s,size:a,asChild:n=!1,...r}=e,l=n?m.DX:"button";return(0,i.jsx)(l,{"data-slot":"button",className:o(p({variant:s,size:a,className:t})),...r})}var x=s(1284),v=s(9074),y=s(381),S=s(2525),b=s(7580),j=s(3052),N=s(2355);function w(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card",className:o("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function k(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card-header",className:o("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function P(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card-title",className:o("leading-none font-semibold",t),...s})}function D(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card-content",className:o("px-6",t),...s})}var E=s(1522),T=s(6474),A=s(5196),I=s(7863);function C(e){let{...t}=e;return(0,i.jsx)(E.bL,{"data-slot":"select",...t})}function M(e){let{...t}=e;return(0,i.jsx)(E.WT,{"data-slot":"select-value",...t})}function _(e){let{className:t,size:s="default",children:a,...n}=e;return(0,i.jsxs)(E.l9,{"data-slot":"select-trigger","data-size":s,className:o("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[a,(0,i.jsx)(E.In,{asChild:!0,children:(0,i.jsx)(T.A,{className:"size-4 opacity-50"})})]})}function O(e){let{className:t,children:s,position:a="popper",...n}=e;return(0,i.jsx)(E.ZL,{children:(0,i.jsxs)(E.UC,{"data-slot":"select-content",className:o("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...n,children:[(0,i.jsx)(W,{}),(0,i.jsx)(E.LM,{className:o("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,i.jsx)(F,{})]})})}function R(e){let{className:t,children:s,...a}=e;return(0,i.jsxs)(E.q7,{"data-slot":"select-item",className:o("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...a,children:[(0,i.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,i.jsx)(E.VF,{children:(0,i.jsx)(A.A,{className:"size-4"})})}),(0,i.jsx)(E.p4,{children:s})]})}function W(e){let{className:t,...s}=e;return(0,i.jsx)(E.PP,{"data-slot":"select-scroll-up-button",className:o("flex cursor-default items-center justify-center py-1",t),...s,children:(0,i.jsx)(I.A,{className:"size-4"})})}function F(e){let{className:t,...s}=e;return(0,i.jsx)(E.wn,{"data-slot":"select-scroll-down-button",className:o("flex cursor-default items-center justify-center py-1",t),...s,children:(0,i.jsx)(T.A,{className:"size-4"})})}var L=s(4616),z=s(646),V=s(9428);let U=(e,t)=>e<0||e>11||!t?0:new Date(t,e+1,0).getDate(),B=(e,t)=>e<0||e>11?"":t("months.".concat(e))||"",H=(e,t)=>new Date(t,e,1).getDay(),J=(e,t,s)=>{let i=new Date(s,t,e).getDay();return 0===i||6===i};var Y=s(6671),q=s(7652);let G=e=>{let{schedules:t,activeScheduleId:s,onScheduleSelect:n,onScheduleAdd:r,onScheduleDelete:l}=e,[o,c]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[f,p]=(0,a.useState)("auto"),x=(0,q.c3)(),y=s&&!o,b=new Date,j=b.getMonth(),N=b.getFullYear(),E=()=>{if(0===t.length)return null;let e=t[0];for(let s=1;s<t.length;s++){let i=t[s];(i.year>e.year||i.year===e.year&&i.month>e.month)&&(e=i)}return e},T=()=>{let e=E();if(!e)return{month:j,year:N};let t=new Date(e.year,e.month),s=new Date(t.getFullYear(),t.getMonth()+1);return{month:s.getMonth(),year:s.getFullYear()}},A=(e,t,s)=>{l(e),Y.oR.success(x("toast.scheduleDeleted"),{description:x("toast.scheduleDeletedDescription",{month:B(t,x),year:s})})},I=[...t].sort((e,t)=>t.year-e.year||t.month-e.month),W=Array.from({length:12},(e,t)=>({value:t.toString(),label:x("months.".concat(t))})),F=Array.from({length:10},(e,t)=>{let s=b.getFullYear()-2+t;return{value:s.toString(),label:s.toString()}});return(0,i.jsxs)(w,{children:[(0,i.jsxs)(k,{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(P,{className:"flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"w-5 h-5"}),x("scheduleHistory.title"),y&&s&&(0,i.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["-"," ",(()=>{let e=t.find(e=>e.id===s);return e?"".concat(B(e.month,x)," ").concat(e.year):""})()]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[y&&(0,i.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>n(null),className:"flex items-center gap-2",children:x("scheduleHistory.showAll")}),(0,i.jsxs)(g,{onClick:()=>{let{month:e,year:t}=T();c(!0),h(e),m(t),p("auto")},size:"sm",className:"flex items-center gap-2",children:[(0,i.jsx)(L.A,{className:"w-4 h-4"}),x("scheduleHistory.addSchedule")]})]})]}),0===t.length&&(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:x("scheduleHistory.noSchedulesYet")})]}),!y&&(0,i.jsxs)(D,{className:"space-y-4",children:[o&&(0,i.jsxs)("div",{className:"p-4 border rounded-lg bg-muted/50 space-y-4",children:[(0,i.jsx)("h4",{className:"font-medium",children:x("scheduleHistory.createNewSchedule")}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:x("scheduleHistory.month")}),(0,i.jsxs)(C,{value:(null==d?void 0:d.toString())||"",onValueChange:e=>h(parseInt(e)),children:[(0,i.jsx)(_,{children:(0,i.jsx)(M,{placeholder:x("scheduleHistory.selectMonth")})}),(0,i.jsx)(O,{children:W.map(e=>(0,i.jsx)(R,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:x("scheduleHistory.year")}),(0,i.jsxs)(C,{value:(null==u?void 0:u.toString())||"",onValueChange:e=>m(parseInt(e)),children:[(0,i.jsx)(_,{children:(0,i.jsx)(M,{placeholder:x("scheduleHistory.selectYear")})}),(0,i.jsx)(O,{children:F.map(e=>(0,i.jsx)(R,{value:e.value,children:e.label},e.value))})]})]})]}),t.length>0&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:x("scheduleHistory.employeeImport")}),(0,i.jsxs)(C,{value:f,onValueChange:p,children:[(0,i.jsx)(_,{children:(0,i.jsx)(M,{placeholder:x("scheduleHistory.chooseImportOption")})}),(0,i.jsxs)(O,{children:[(0,i.jsx)(R,{value:"auto",children:x("scheduleHistory.autoImportFromRecent")}),(0,i.jsx)(R,{value:"none",children:x("scheduleHistory.startWithEmptyList")}),I.map(e=>(0,i.jsxs)(R,{value:e.id,children:[x("scheduleHistory.copyFrom")," ",B(e.month,x)," ",e.year," (",e.employees.length," ",x("scheduleHistory.employees"),")"]},e.id))]})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:x("scheduleHistory.importNote")})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(g,{onClick:()=>{if(!d||!u)return void Y.oR.error(x("toast.invalidInput"),{description:x("toast.selectBothMonthYear")});try{let e;if("auto"===f){let t=E();e=null==t?void 0:t.id}else"none"!==f&&(e=f);r(d,u,e),c(!1),h(null),m(null),p("auto");let t=e?x("toast.withImportedEmployees"):x("toast.withEmptyEmployeeList");Y.oR.success(x("toast.scheduleCreated"),{description:x("toast.scheduleCreatedDescription",{month:B(d,x),year:u,importMessage:t})})}catch(e){Y.oR.error(x("toast.creationFailed"),{description:e instanceof Error?e.message:x("toast.creationFailedDescription")})}},size:"sm",children:x("scheduleHistory.createSchedule")}),(0,i.jsx)(g,{variant:"outline",onClick:()=>{c(!1),h(null),m(null),p("auto")},size:"sm",children:x("scheduleHistory.cancel")})]})]}),I.length>0&&(0,i.jsx)("div",{className:"space-y-2",children:I.map(e=>(0,i.jsxs)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat(e.id===s?"bg-primary/10 border-primary":"hover:bg-muted/50"),onClick:()=>{e.id===s?n(null):n(e.id)},children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center gap-3",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[e.isGenerated?(0,i.jsx)(z.A,{className:"w-4 h-4 text-green-600"}):(0,i.jsx)(V.A,{className:"w-4 h-4 text-muted-foreground"}),(0,i.jsxs)("span",{className:"font-medium",children:[B(e.month,x)," ",e.year]})]})}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.employees.length," ",x("scheduleHistory.employees")]}),(0,i.jsx)(g,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),A(e.id,e.month,e.year)},className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:(0,i.jsx)(S.A,{className:"w-3 h-3"})})]})]}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[x("scheduleHistory.created")," ",e.createdAt.toLocaleDateString(),e.isGenerated&&(0,i.jsxs)("span",{className:"ml-2 text-green-600",children:["• ",x("scheduleHistory.generated")]})]})]},e.id))})]})]})};function K(e){let{className:t,type:s,...a}=e;return(0,i.jsx)("input",{type:s,"data-slot":"input",className:o("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}var Q=s(968);function X(e){let{className:t,...s}=e;return(0,i.jsx)(Q.b,{"data-slot":"label",className:o("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}let Z=(0,f.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function $(e){let{className:t,variant:s,asChild:a=!1,...n}=e,r=a?m.DX:"span";return(0,i.jsx)(r,{"data-slot":"badge",className:o(Z({variant:s}),t),...n})}var ee=s(4073);let et=a.forwardRef((e,t)=>{let{className:s,label:n,labelPosition:r="top",...l}=e,c=Array.isArray(l.value)?l.value:Array.isArray(l.defaultValue)?l.defaultValue:[l.min||0,l.max||100],[d,h]=a.useState(c);return a.useEffect(()=>{Array.isArray(l.value)&&h(l.value)},[l.value]),(0,i.jsxs)(ee.bL,{ref:t,className:o("relative flex w-full touch-none select-none items-center",s),...l,value:d,onValueChange:e=>{h(e),l.onValueChange&&l.onValueChange(e)},children:[(0,i.jsx)(ee.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,i.jsx)(ee.Q6,{className:"absolute h-full bg-primary"})}),d.map((e,t)=>(0,i.jsx)(a.Fragment,{children:(0,i.jsx)(ee.zi,{className:"block h-4 w-4 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:n&&(0,i.jsx)("span",{className:o("absolute flex w-full justify-center","top"===r&&"-top-7","bottom"===r&&"top-4"),children:n(e)})})},t))]})});et.displayName="DualRangeSlider";let es=e=>{let{employee:t,isSelected:s,isEditing:n,predefinedTags:r,onEmployeeSelect:l,onRemoveEmployee:o,onUpdateEmployee:c,onToggleTag:d,onStartEditing:h,onStopEditing:u}=e,[m,f]=(0,a.useState)(""),[p,x]=(0,a.useState)([0,0]),[v,y]=(0,a.useState)([0,0]),[b,j]=(0,a.useState)([0,0]),N=(0,q.c3)(),w=()=>{f(t.name),x(t.shiftsPerMonth),y(t.weekdayShifts),j(t.weekendShifts),h(t)};return(0,i.jsx)("div",{className:"border rounded-lg transition-colors ".concat(s?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:n?(0,i.jsxs)("div",{className:"p-4 space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(X,{htmlFor:"editName",className:"mb-1",children:N("employees.name")}),(0,i.jsx)(K,{id:"editName",value:m,onChange:e=>f(e.target.value),placeholder:N("employees.namePlaceholder")})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:N("employees.shiftsRangeNote")}),(0,i.jsxs)("div",{children:[(0,i.jsx)(X,{className:"mb-2",children:N("employees.minMaxShiftsPerMonth")}),(0,i.jsx)("div",{className:"px-3 mb-8",children:(0,i.jsx)(et,{value:p,onValueChange:e=>x(e),max:31,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(X,{className:"mb-2",children:N("employees.minMaxWeekdayShifts")}),(0,i.jsx)("div",{className:"px-3 mb-8",children:(0,i.jsx)(et,{value:v,onValueChange:e=>y(e),max:23,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(X,{className:"mb-2",children:N("employees.minMaxWeekendShifts")}),(0,i.jsx)("div",{className:"px-3 mb-8",children:(0,i.jsx)(et,{value:b,onValueChange:e=>j(e),max:9,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(X,{children:N("employees.tags")}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.map(e=>{let s=t.tags.includes(e);return(0,i.jsx)(g,{variant:s?"default":"outline",size:"sm",onClick:()=>d(t.id,e),children:N(e)},e)})})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(g,{onClick:()=>{c(t.id,{name:m,shiftsPerMonth:p,weekdayShifts:v,weekendShifts:b}),u()},size:"sm",children:N("employees.save")}),(0,i.jsx)(g,{onClick:u,variant:"outline",size:"sm",children:N("employees.cancel")}),(0,i.jsxs)(g,{onClick:()=>{o(t.id),u()},variant:"destructive",size:"sm",children:[(0,i.jsx)(S.A,{className:"w-4 h-4 mr-1"}),N("employees.delete")]})]})]}):(0,i.jsx)("div",{className:"p-3 cursor-pointer",onClick:()=>l(s?"":t.id),children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"font-medium",children:t.name}),(0,i.jsx)($,{variant:"secondary",children:t.shiftsPerMonth[0]===t.shiftsPerMonth[1]?"".concat(t.shiftsPerMonth[0]," ").concat(N("employees.shifts")):"".concat(t.shiftsPerMonth[0],"-").concat(t.shiftsPerMonth[1]," ").concat(N("employees.shifts"))})]}),t.tags.length>0&&(0,i.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:t.tags.map(e=>(0,i.jsx)($,{variant:"outline",className:"text-xs",children:N(e)},N(e)))}),s&&(0,i.jsx)("div",{className:"mt-2 text-xs text-blue-600",children:N("employees.selectedDescription")})]}),(0,i.jsx)(g,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),w()},children:N("employees.edit")})]})})})},ei=e=>{let{employees:t,selectedEmployee:s,onEmployeeSelect:n,onAddEmployee:r,onRemoveEmployee:l,onUpdateEmployee:o,onToggleTag:c,predefinedTags:d,hasActiveSchedule:h}=e,[u,m]=(0,a.useState)(""),f=(0,q.c3)(),p=e=>{m(e.id)},x=()=>{m("")};return(0,i.jsxs)(w,{className:"flex flex-col min-h-[400px] max-h-[80vh]",children:[(0,i.jsxs)(k,{className:"flex-shrink-0",children:[(0,i.jsx)(P,{children:f("employees.title")}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:f(h?"employees.selectScheduleDescription":"employees.noActiveScheduleDescription")})]}),(0,i.jsx)(D,{className:"flex-1 flex flex-col overflow-hidden",children:h?0===t.length?(0,i.jsxs)("div",{className:"text-center py-8",children:[(0,i.jsx)("p",{className:"text-muted-foreground mb-4",children:f("employees.noEmployeesMessage")}),(0,i.jsxs)(g,{onClick:r,children:[(0,i.jsx)(L.A,{className:"w-4 h-4 mr-2"}),f("employees.addFirstEmployee")]})]}):(0,i.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,i.jsx)("div",{className:"flex-1 space-y-3 overflow-y-auto pr-2",children:t.map(e=>(0,i.jsx)(es,{employee:e,isSelected:s===e.id,isEditing:u===e.id,predefinedTags:d,onEmployeeSelect:n,onRemoveEmployee:l,onUpdateEmployee:o,onToggleTag:c,onStartEditing:p,onStopEditing:x},e.id))}),h&&(0,i.jsxs)(g,{onClick:r,variant:"outline",className:"w-full mt-3 flex-shrink-0",children:[(0,i.jsx)(L.A,{className:"w-4 h-4 mr-2"}),f("employees.addEmployee")]})]}):(0,i.jsx)("div",{className:"text-center py-8",children:(0,i.jsx)("p",{className:"text-muted-foreground mb-4",children:f("employees.noActiveScheduleMessage")})})})]})},ea=e=>{let{value:t,onChange:s,min:n=0,max:r=100,defaultValue:l=n,id:o,className:c,placeholder:d}=e,[h,u]=(0,a.useState)(t.toString());return(0,a.useEffect)(()=>{u(t.toString())},[t]),(0,i.jsx)(K,{id:o,type:"number",min:n,max:r,value:h,onChange:e=>u(e.target.value),onBlur:()=>{let e=Math.max(n,Math.min(r,Number.parseInt(h)||l));u(e.toString()),e!==t&&s(e)},className:c,placeholder:d})},en="https://1.34.36.98:26749";class er extends Error{constructor(e,t,s){super(e),this.status=t,this.details=s,this.name="ScheduleAPIError"}}class el extends er{constructor(e){super("Schedule generation timed out after ".concat(e/1e3," seconds")),this.name="ScheduleTimeoutError"}}class eo extends er{constructor(e,t){super("Server error: ".concat(e)),this.status=t,this.name="ScheduleServerError"}}function ec(e){return{id:e.id,name:e.name,shifts_per_month:e.shiftsPerMonth,weekday_shifts:e.weekdayShifts,weekend_shifts:e.weekendShifts,tags:e.tags}}function ed(e){return{id:e.id,employee_id:e.employeeId,type:e.type,date:e.date,shift_index:e.shiftIndex}}async function eh(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new AbortController,a=setTimeout(()=>i.abort(),s);try{let s=await fetch(e,{...t,signal:i.signal,headers:{"Content-Type":"application/json",...t.headers}});if(clearTimeout(a),!s.ok){let e="HTTP ".concat(s.status,": ").concat(s.statusText);try{let t=await s.json();t.detail&&(e=Array.isArray(t.detail)?t.detail.map(e=>"object"==typeof e&&e.msg?e.msg:String(e)).join(", "):t.detail)}catch(e){}throw new eo(e,s.status)}return await s.json()}catch(e){if(clearTimeout(a),e instanceof DOMException&&"AbortError"===e.name)throw new el(s);if(e instanceof er)throw e;throw new er("Network error: ".concat(e instanceof Error?e.message:"Unknown error"))}}async function eu(){return eh("".concat(en,"/health"),{method:"GET"})}async function em(){return eh("".concat(en,"/api/v1/solver/status"),{method:"GET"})}async function ef(e,t,s,i,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,r={employees:e.map(ec),constraints:t.map(ed),settings:{shifts_per_day:s.shiftsPerDay,persons_per_shift:s.personsPerShift,max_consecutive_shifts:s.maxConsecutiveShifts,max_consecutive_days:s.maxConsecutiveDays,min_rest_days_between_shifts:s.minRestDaysBetweenShifts,prevent_multiple_shifts_per_day:s.preventMultipleShiftsPerDay,max_shifts_per_week:s.maxShiftsPerWeek,min_shifts_per_week:s.minShiftsPerWeek,even_distribution:s.evenDistribution,shift_labels:s.shiftLabels,fairness_weight:1,workload_balance_weight:1,preference_weight:.5,optimize_for:"balanced"},selected_month:i,selected_year:a,timeout:n},l=await eh("".concat(en,"/api/v1/schedule/generate"),{method:"POST",body:JSON.stringify(r)},(n+5)*1e3);return{schedule:function(e){let t={};for(let[s,i]of Object.entries(e.days))t[parseInt(s)]={shifts:i.shifts.map(e=>({employeeIds:e.employee_ids}))};return t}(l.schedule),success:l.success,message:l.message,metadata:l.metadata}}async function ep(){let e=Date.now();try{await eu();let t=Date.now()-e;return{available:!0,latency:t}}catch(e){return{available:!1,error:e instanceof Error?e.message:"Unknown error"}}}let eg=()=>{var e;let[t,s]=(0,a.useState)({available:!1}),[i,n]=(0,a.useState)(!1),[r]=(0,a.useState)({baseUrl:en,timeout:3e4,configured:!0}),l=(0,a.useCallback)(async()=>{n(!0);try{let e=await ep();if(e.available){let[t,i]=await Promise.all([eu().catch(e=>{console.warn("Health check failed:",e)}),em().catch(e=>{console.warn("Solver status check failed:",e)})]);s({available:!0,health:t,solverStatus:i,latency:e.latency,lastChecked:new Date})}else s({available:!1,error:e.error,lastChecked:new Date})}catch(e){s({available:!1,error:e instanceof Error?e.message:"Unknown error",lastChecked:new Date})}finally{n(!1)}},[]);(0,a.useEffect)(()=>{r.configured?l():s({available:!1,error:"API URL not configured",lastChecked:new Date})},[r.configured,l]);let o=(0,a.useCallback)(()=>{if(!r.configured)return"Server URL not configured";if(i)return"Checking server status...";if(!t.available)return t.error||"Server unavailable";if(t.health&&t.solverStatus){let e=t.solverStatus.current_load,s=t.solverStatus.max_concurrent,i=Math.round(e/s*100);return"Server healthy • ".concat(t.latency,"ms • Load: ").concat(e,"/").concat(s," (").concat(i,"%)")}return"Server connected • ".concat(t.latency,"ms")},[r.configured,i,t]),c=(0,a.useCallback)(()=>{if(!r.configured)return"text-yellow-600";if(i)return"text-blue-600";if(!t.available)return"text-red-600";if(t.solverStatus){let e=t.solverStatus.current_load/t.solverStatus.max_concurrent*100;if(e>90)return"text-yellow-600";if(e>70)return"text-orange-600"}return"text-green-600"},[r.configured,i,t]);return{status:t,isChecking:i,config:r,checkConnection:l,getStatusMessage:o,getStatusColor:c,isHealthy:t.available&&!i,canUseCPSAT:t.available&&(null==(e=t.solverStatus)?void 0:e.available)!==!1}};var ex=s(5487),ev=s(3904),ey=s(1539),eS=s(4186);let eb=e=>{let{showDetails:t=!1,className:s=""}=e,{status:a,isChecking:n,config:r,checkConnection:l,getStatusMessage:o,getStatusColor:c,isHealthy:d,canUseCPSAT:h}=eg();return t?(0,i.jsx)(w,{className:"p-4 ".concat(s),children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(ex.A,{className:"h-5 w-5"}),(0,i.jsx)("h3",{className:"font-semibold",children:"CP-SAT Scheduler Server"})]}),(0,i.jsxs)(g,{variant:"outline",size:"sm",onClick:l,disabled:n,children:[(0,i.jsx)(ev.A,{className:"h-4 w-4 mr-2 ".concat(n?"animate-spin":"")}),"Refresh"]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)($,{variant:d?"default":"destructive",className:"text-xs",children:d?"Healthy":"Unavailable"}),(0,i.jsx)("span",{className:"text-sm ".concat(c()),children:o()})]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,i.jsxs)("div",{children:["Endpoint: ",r.baseUrl]}),(0,i.jsxs)("div",{children:["Timeout: ",r.timeout/1e3,"s"]}),a.lastChecked&&(0,i.jsxs)("div",{children:["Last checked: ",a.lastChecked.toLocaleTimeString()]})]})]}),d&&a.solverStatus&&(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)(ey.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{children:"Performance"})]}),(0,i.jsxs)("div",{className:"text-xs space-y-1",children:[(0,i.jsxs)("div",{children:["Latency: ",a.latency,"ms"]}),(0,i.jsxs)("div",{children:["Version: ",a.solverStatus.solver_version]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)(b.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{children:"Load"})]}),(0,i.jsxs)("div",{className:"text-xs space-y-1",children:[(0,i.jsxs)("div",{children:["Active: ",a.solverStatus.current_load," / ",a.solverStatus.max_concurrent]}),(0,i.jsxs)("div",{children:["Capacity: ",Math.round((1-a.solverStatus.current_load/a.solverStatus.max_concurrent)*100),"% free"]})]})]})]}),(0,i.jsx)("div",{className:"text-xs text-gray-600 bg-gray-50 p-2 rounded",children:h?(0,i.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,i.jsx)(ey.A,{className:"h-3 w-3"}),"CP-SAT solver available - will be used automatically for optimal scheduling"]}):(0,i.jsxs)("div",{className:"flex items-center gap-2 text-yellow-700",children:[(0,i.jsx)(eS.A,{className:"h-3 w-3"}),"CP-SAT unavailable - falling back to local genetic/simulated annealing algorithms"]})})]})}):(0,i.jsxs)("div",{className:"flex items-center gap-2 ".concat(s),children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)(ex.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"CP-SAT"})]}),(0,i.jsx)($,{variant:d?"default":"destructive",className:"text-xs",children:d?"Connected":"Offline"}),(0,i.jsx)(g,{variant:"ghost",size:"sm",onClick:l,disabled:n,className:"h-6 w-6 p-0",children:(0,i.jsx)(ev.A,{className:"h-3 w-3 ".concat(n?"animate-spin":"")})})]})},ej=e=>{var t;let{settings:s,onSettingsChange:a}=e,n=(0,q.c3)(),r=(e,t)=>{a({...s,[e]:t})};return(0,i.jsxs)(w,{children:[(0,i.jsxs)(k,{children:[(0,i.jsx)(P,{children:n("constraints.title")}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:n("constraints.description")})]}),(0,i.jsxs)(D,{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"shiftsPerDay",children:n("constraints.shiftsPerDay")}),(0,i.jsx)(ea,{id:"shiftsPerDay",value:s.shiftsPerDay,onChange:e=>{let t=Array.from({length:e},(e,t)=>s.personsPerShift[t]||1),i=Array.from({length:e},(e,t)=>{var i;return(null==(i=s.shiftLabels)?void 0:i[t])||"Shift ".concat(t+1)});a({...s,shiftsPerDay:e,personsPerShift:t,shiftLabels:i})},min:1,max:3,defaultValue:1}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.shiftsPerDayDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{children:n("constraints.personsPerShift")}),s.personsPerShift.map((e,t)=>{var a;return(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsxs)(X,{className:"text-sm w-20",children:[(null==(a=s.shiftLabels)?void 0:a[t])||"Shift ".concat(t+1),":"]}),(0,i.jsx)(ea,{value:e,onChange:e=>{let i=[...s.personsPerShift];i[t]=e,r("personsPerShift",i)},min:1,max:10,defaultValue:1,className:"w-20"})]},t)}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.personsPerShiftDescription")})]}),s.shiftsPerDay>1&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{children:n("settings.shiftLabels")}),null==(t=s.shiftLabels)?void 0:t.map((e,t)=>(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsxs)(X,{className:"text-sm w-20",children:[n("shiftPreferences.shiftLabel",{index:t+1}),":"]}),(0,i.jsx)(K,{type:"text",value:e,placeholder:n("settings.shiftLabelPlaceholder",{index:t+1}),onChange:e=>{let i=[...s.shiftLabels||[]];i[t]=e.target.value||"Shift ".concat(t+1),r("shiftLabels",i)},className:"flex-1"})]},t)),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("settings.customizeShiftNames")})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Scheduling Algorithm"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"preferredAlgorithm",children:"Preferred Algorithm"}),(0,i.jsxs)(C,{value:s.preferredAlgorithm,onValueChange:e=>r("preferredAlgorithm",e),children:[(0,i.jsx)(_,{children:(0,i.jsx)(M,{placeholder:"Select algorithm"})}),(0,i.jsxs)(O,{children:[(0,i.jsx)(R,{value:"auto",children:"Auto (Recommended)"}),(0,i.jsx)(R,{value:"cp-sat",children:"CP-SAT Solver (Best Quality)"}),(0,i.jsx)(R,{value:"genetic",children:"Genetic Algorithm (Fast)"}),(0,i.jsx)(R,{value:"simulated-annealing",children:"Simulated Annealing (Simple)"})]})]}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Auto:"})," Uses CP-SAT if available, falls back to genetic/simulated annealing"]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"CP-SAT:"})," Google's constraint programming solver - highest quality results"]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Genetic:"})," Good for complex multi-shift schedules"]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Simulated Annealing:"})," Simple algorithm for basic single-shift schedules"]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{children:"Server Status"}),(0,i.jsx)(eb,{showDetails:!0})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.restAndRecovery")}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"maxConsecutive",children:n("constraints.maxConsecutiveShifts")}),(0,i.jsx)(ea,{id:"maxConsecutive",value:s.maxConsecutiveShifts,onChange:e=>r("maxConsecutiveShifts",e),min:1,max:7,defaultValue:1}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxConsecutiveShiftsDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"maxConsecutiveDays",children:n("constraints.maxConsecutiveDays")}),(0,i.jsx)(ea,{id:"maxConsecutiveDays",value:s.maxConsecutiveDays,onChange:e=>r("maxConsecutiveDays",e),min:1,max:7,defaultValue:3}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxConsecutiveDaysDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"minRestDays",children:n("constraints.minRestDaysBetweenShifts")}),(0,i.jsx)(ea,{id:"minRestDays",value:s.minRestDaysBetweenShifts,onChange:e=>r("minRestDaysBetweenShifts",e),min:0,max:3,defaultValue:0}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.minRestDaysBetweenShiftsDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(X,{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:s.preventMultipleShiftsPerDay,onChange:e=>r("preventMultipleShiftsPerDay",e.target.checked),className:"rounded"}),n("constraints.preventMultipleShiftsPerDay")]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.preventMultipleShiftsPerDayDescription")})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.weeklyLimits")}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"minShiftsPerWeek",children:n("constraints.minShiftsPerWeek")}),(0,i.jsx)(ea,{id:"minShiftsPerWeek",value:s.minShiftsPerWeek,onChange:e=>r("minShiftsPerWeek",e),min:0,max:7,defaultValue:0}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.minShiftsPerWeekDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"maxShiftsPerWeek",children:n("constraints.maxShiftsPerWeek")}),(0,i.jsx)(ea,{id:"maxShiftsPerWeek",value:s.maxShiftsPerWeek,onChange:e=>r("maxShiftsPerWeek",e),min:1,max:7,defaultValue:1}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxShiftsPerWeekDescription")})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.fairnessAndDistribution")}),(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(X,{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:s.evenDistribution,onChange:e=>r("evenDistribution",e.target.checked),className:"rounded"}),n("constraints.evenShiftDistribution")]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.evenShiftDistributionDescription")})]})})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.apiConfiguration")}),(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(X,{htmlFor:"apiFormat",children:n("constraints.apiFormat")}),(0,i.jsxs)(C,{value:s.apiFormat||"json",onValueChange:e=>r("apiFormat",e),children:[(0,i.jsx)(_,{id:"apiFormat",children:(0,i.jsx)(M,{placeholder:"Select API format"})}),(0,i.jsxs)(O,{children:[(0,i.jsxs)(R,{value:"json",children:["JSON - ",n("constraints.apiFormatJsonDescription")]}),(0,i.jsxs)(R,{value:"protobuf",children:["Protocol Buffers - ",n("constraints.apiFormatProtobufDescription")]})]})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.apiFormatDescription")})]})})]}),(0,i.jsxs)("div",{className:"border-t pt-6 bg-muted/50 p-4 rounded-lg",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-2",children:n("constraints.constraintSummary")}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.daily"),":"]})," ",n("constraints.dailySummary",{shiftsPerDay:s.shiftsPerDay,personsPerShift:s.personsPerShift.join(n("constraints.separator"))})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.consecutive"),":"]})," ",n("constraints.consecutiveSummary",{maxShifts:s.maxConsecutiveShifts,maxDays:s.maxConsecutiveDays})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.rest"),":"]})," ",n("constraints.restSummary",{days:s.minRestDaysBetweenShifts})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.multipleShifts"),":"]})," ",s.preventMultipleShiftsPerDay?n("constraints.prevented"):n("constraints.allowed")]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.weekly"),":"]})," ",n("constraints.weeklySummary",{minShifts:s.minShiftsPerWeek,maxShifts:s.maxShiftsPerWeek})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.distribution"),":"]})," ",s.evenDistribution?n("constraints.even"):n("constraints.flexible")]})]})]})]})]})]})};var eN=s(3127),ew=s(4261),ek=s(2118);let eP=(e,t,s,i,a,n)=>{let r=U(s,i),l="Date,Shift,Employee\n";for(let a=1;a<=r;a++){let r=e[a],o="".concat(i,"-").concat((s+1).toString().padStart(2,"0"),"-").concat(a.toString().padStart(2,"0"));(null==r?void 0:r.shifts)&&r.shifts.length>0?r.shifts.forEach((e,s)=>{var i;let a=(null==n||null==(i=n.shiftLabels)?void 0:i[s])||"Shift ".concat(s+1);e.employeeIds.length>0?e.employeeIds.forEach(e=>{let s=t.find(t=>t.id===e);l+="".concat(o,",").concat(a,",").concat((null==s?void 0:s.name)||"Unknown","\n")}):l+="".concat(o,",").concat(a,",No Assignment\n")}):l+="".concat(o,",No Shifts,No Assignment\n")}let o=new Blob([l],{type:"text/csv"}),c=window.URL.createObjectURL(o),d=document.createElement("a");d.href=c,d.download="schedule-".concat(B(s,a),"-").concat(i,".csv"),d.click(),window.URL.revokeObjectURL(c)},eD=(e,t,s,i,a,n)=>{let r=document.createElement("canvas"),l=r.getContext("2d");if(!l)return;let o=U(s,i),c=(null==n?void 0:n.shiftsPerDay)&&n.shiftsPerDay>1?60:40;r.width=980,r.height=60+Math.ceil(o/7)*c,l.fillStyle="#ffffff",l.fillRect(0,0,r.width,r.height),l.fillStyle="#000000",l.font="bold 24px Arial",l.textAlign="center",l.fillText("".concat(B(s,a)," ").concat(i," Schedule"),r.width/2,30),l.font="14px Arial",l.textAlign="left";for(let s=1;s<=o;s++){let i=Math.floor((s-1)/7),a=(s-1)%7*140,r=60+i*c;l.strokeStyle="#cccccc",l.strokeRect(a,r,140,c),l.fillStyle="#000000",l.fillText(s.toString(),a+5,r+20);let o=e[s];if((null==o?void 0:o.shifts)&&o.shifts.length>0){let e=35;o.shifts.forEach((s,i)=>{if(s.employeeIds.length>0){if((null==n?void 0:n.shiftsPerDay)&&n.shiftsPerDay>1){var r;let t=(null==(r=n.shiftLabels)?void 0:r[i])||"S".concat(i+1);l.fillStyle="#666666",l.font="10px Arial",l.fillText("".concat(t,":"),a+5,e),e+=12}s.employeeIds.slice(0,2).forEach(s=>{let i=t.find(e=>e.id===s);l.fillStyle="#0066cc",l.font="10px Arial";let n=(null==i?void 0:i.name)||"Unknown",r=n.length>12?n.substring(0,10)+"...":n;l.fillText(r,a+5,e),e+=10}),s.employeeIds.length>2&&(l.fillStyle="#888888",l.font="8px Arial",l.fillText("+".concat(s.employeeIds.length-2," more"),a+5,e),e+=10)}})}}r.toBlob(e=>{if(e){let t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="schedule-".concat(B(s,a),"-").concat(i,".png"),n.click(),window.URL.revokeObjectURL(t)}})},eE=e=>{let{day:t,daySchedule:s,employees:a,constraints:n,selectedEmployee:r,settings:l,isLastInRow:c,isInLastRow:d,showShiftColors:h=!1,onShiftClick:u,onDayClick:m}=e,f=(0,q.c3)(),p=r?n.filter(e=>e.employeeId===r&&e.date===t):[],g=null;if(p.length>0){let e=p.every(e=>"prefer"===e.type),t=p.every(e=>"avoid"===e.type);e?g="prefer":t&&(g="avoid")}let x=["p-1 min-h-24 border-gray-400 transition-colors"];return c||x.push("border-r"),d||x.push("border-b"),(0,i.jsxs)("div",{className:o(x),children:[(0,i.jsxs)("div",{className:"mb-1 relative flex justify-center items-center",children:[(0,i.jsx)("span",{className:"text-sm font-medium",children:t}),r&&l.shiftsPerDay>1&&(0,i.jsx)("button",{onClick:()=>m(t),className:o(["absolute right-0 text-[10px] border transition-colors truncate max-w-[calc(50%-0.5rem)]","constraint-button-".concat(g)]),title:f("scheduleView.setAllShiftsDescription"),children:f("scheduleView.setAllShifts_".concat(g))})]}),(0,i.jsx)("div",{className:"space-y-0.5",children:Array.from({length:l.shiftsPerDay},(e,n)=>{var c,d;let m=null==s||null==(c=s.shifts)?void 0:c[n],f=(null==m?void 0:m.employeeIds)||[],g=(null==(d=l.shiftLabels)?void 0:d[n])||"Shift ".concat(n+1),x=r?p.find(e=>e.shiftIndex===n):null,v=["text-xs border min-h-6 cursor-pointer transition-colors relative"];return h&&l.shiftsPerDay>1&&v.push("shift-".concat(n)),r&&f.includes(r)&&v.push("ring-2 ring-blue-400"),(0,i.jsxs)("div",{className:o(v),onClick:()=>r&&u(t,n),title:g,children:[x&&(0,i.jsx)("div",{className:"absolute top-0 right-0 z-10",children:(0,i.jsx)("span",{className:o(["text-[8px] px-1 py-1 rounded text-white font-bold shadow-sm","prefer"===x.type?"bg-green-600":"bg-red-600"]),children:"prefer"===x.type?"✓":"✗"})}),(0,i.jsx)("div",{className:"space-y-0.5 grid grid-cols-[repeat(auto-fit,minmax(60px,1fr))] gap-0.5",children:f.map((e,s)=>{let l=a.find(t=>t.id===e),c=r===e;return(0,i.jsx)("div",{className:o("text-[12px] truncate",c?"font-bold ring-1 ring-blue-400":""),title:null==l?void 0:l.name,children:null==l?void 0:l.name},"".concat(e,"-").concat(t,"-").concat(n,"-").concat(s))})})]},"".concat(t,"-shift-").concat(n))})})]})},eT=e=>{var t;let{schedule:s,employees:n,selectedMonth:r,selectedYear:l,hasActiveSchedule:c,constraints:d=[],selectedEmployee:h,settings:u,onSetConstraint:m,onRemoveConstraint:f,onGenerateSchedule:p,isGenerating:x=!1}=e,[v,y]=(0,a.useState)(!1),[S,b]=(0,a.useState)(!0),j=(0,a.useRef)(null),N=(0,q.c3)();(0,a.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let E=(e,t)=>{if(!h||!m||!f)return;let s=d.find(s=>s.employeeId===h&&s.date===e&&s.shiftIndex===t);s?"prefer"===s.type?m(h,"avoid",e,t):"avoid"===s.type&&f(h,e,t):m(h,"prefer",e,t)},A=e=>{if(!h||!m||!f)return;let t=d.filter(t=>t.employeeId===h&&t.date===e),s=null;(s=0===t.length?"prefer":t.every(e=>"prefer"===e.type)?"avoid":null)?m(h,s,e):f(h,e)};return(0,i.jsxs)(w,{children:[(0,i.jsx)(k,{children:(0,i.jsxs)(P,{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[!c&&N("schedule.title"),c&&N("schedule.monthSchedule",{month:B(r,N),year:l}),h&&(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:[N("schedule.settingPreferencesFor")," ",(0,i.jsx)("strong",{children:null==(t=n.find(e=>e.id===h))?void 0:t.name})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[p&&(0,i.jsx)(g,{onClick:p,disabled:0===n.length||x,size:"sm",children:x?N("schedule.generating"):N("schedule.generateButton")}),(0,i.jsx)(eb,{}),u.shiftsPerDay>1&&(0,i.jsx)(g,{variant:S?"default":"outline",size:"sm",onClick:()=>b(!S),className:"flex items-center gap-2",title:S?N("scheduleView.hideShiftColors"):N("scheduleView.showShiftColors"),children:(0,i.jsx)(eN.A,{className:"w-4 h-4"})}),Object.keys(s).length>0&&(0,i.jsxs)("div",{className:"relative",ref:j,children:[(0,i.jsxs)(g,{variant:"outline",size:"sm",onClick:()=>y(!v),className:"flex items-center gap-2",children:[N("schedule.export"),(0,i.jsx)(T.A,{className:"w-4 h-4"})]}),v&&(0,i.jsxs)("div",{className:"absolute right-0 top-full mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[(0,i.jsxs)("button",{onClick:()=>{if(0===Object.keys(s).length)return void Y.oR.error(N("toast.noSchedule"),{description:N("toast.pleaseGenerateFirst")});try{eP(s,n,r,l,N,u),Y.oR.success(N("toast.csvExported"),{description:N("toast.csvExportedDescription")})}catch(e){Y.oR.error(N("toast.exportFailed"),{description:N("toast.csvExportFailedDescription")})}y(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,i.jsx)(ew.A,{className:"w-4 h-4"}),N("schedule.exportCSV")]}),(0,i.jsxs)("button",{onClick:()=>{if(0===Object.keys(s).length)return void Y.oR.error(N("toast.noSchedule"),{description:N("toast.pleaseGenerateFirst")});try{eD(s,n,r,l,N,u),Y.oR.success(N("toast.imageExported"),{description:N("toast.imageExportedDescription")})}catch(e){Y.oR.error(N("toast.exportFailed"),{description:N("toast.imageExportFailedDescription")})}y(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,i.jsx)(ek.A,{className:"w-4 h-4"}),N("schedule.exportImage")]})]})]})]})]})}),(0,i.jsxs)(D,{children:[!c&&(0,i.jsx)("p",{className:"text-muted-foreground",children:N("schedule.noActiveSchedule")}),c&&(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"border border-gray-400 rounded-lg overflow-hidden",children:(0,i.jsxs)("div",{className:"grid grid-cols-7",children:[[N("days.0"),N("days.1"),N("days.2"),N("days.3"),N("days.4"),N("days.5"),N("days.6")].map(e=>(0,i.jsx)("div",{className:"p-3 text-center font-medium bg-muted border-r border-b border-gray-400 last:border-r-0",children:e},e)),(()=>{if(!r||!l)return null;let e=H(r,l),t=U(r,l),a=[],c=e+t;for(let t=0;t<e;t++){let e=(t+1)%7==0,s=t>=7*Math.floor(c/7),n=["p-2 min-h-20 border-gray-400"];e||n.push("border-r"),s||n.push("border-b"),a.push((0,i.jsx)("div",{className:o(n)},"empty-".concat(t)))}for(let r=1;r<=t;r++){let t=s[r],l=e+r-1,o=(l+1)%7==0,m=l>=7*Math.floor(c/7);a.push((0,i.jsx)(eE,{day:r,daySchedule:t,employees:n,constraints:d,selectedEmployee:h,settings:u,isLastInRow:o,isInLastRow:m,showShiftColors:S,onShiftClick:E,onDayClick:A},r))}return a})()]})})})]})]})};var eA=s(143),eI=s(4869);let eC={en:{name:"English",flag:"\uD83C\uDDFA\uD83C\uDDF8"},"zh-TW":{name:"繁體中文",flag:"\uD83C\uDDF9\uD83C\uDDFC"}};function eM(){let{locale:e,setLocale:t}=(0,eA.Y)();return(0,i.jsxs)(C,{value:e,onValueChange:e=>{t(e)},children:[(0,i.jsx)(_,{className:"w-10 h-10 p-0 border-none hover:bg-muted/50 rounded-md",children:(0,i.jsx)(M,{children:(0,i.jsx)(eI.A,{className:"h-5 w-5"})})}),(0,i.jsxs)(O,{children:[(0,i.jsx)(R,{value:"en",children:(0,i.jsxs)("span",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{children:eC.en.flag}),(0,i.jsx)("span",{children:eC.en.name})]})}),(0,i.jsx)(R,{value:"zh-TW",children:(0,i.jsxs)("span",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{children:eC["zh-TW"].flag}),(0,i.jsx)("span",{children:eC["zh-TW"].name})]})})]})]})}var e_=s(1368);let eO={shiftsPerDay:1,personsPerShift:[1],maxConsecutiveShifts:3,maxConsecutiveDays:6,minRestDaysBetweenShifts:0,preventMultipleShiftsPerDay:!0,maxShiftsPerWeek:7,minShiftsPerWeek:0,evenDistribution:!0,shiftLabels:["Shift 1"],preferredAlgorithm:"auto",apiFormat:"protobuf"},eR=()=>{let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(null),[n,r]=(0,a.useState)(eO),[l,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{c(),o(!0)},[]),(0,a.useEffect)(()=>{!1!==l&&localStorage.setItem("scheduleData",JSON.stringify({schedules:e,settings:n}))},[e,n,l]);let c=()=>{let e=localStorage.getItem("scheduleData");if(e)try{let s=JSON.parse(e);t((s.schedules||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))),r({...eO,...s.settings})}catch(e){console.error("Error loading from localStorage:",e)}},d=(e,s)=>{t(t=>t.map(t=>t.id===e?{...t,...s}:t))},h=()=>e.find(e=>e.id===s)||null,u=h(),m=(null==u?void 0:u.month)||0,f=(null==u?void 0:u.year)||0,p=(null==u?void 0:u.employees)||[],g=(null==u?void 0:u.constraints)||[];return{schedules:e,activeScheduleId:s,setActiveScheduleId:i,addSchedule:(s,a,n)=>{let r=[];if(n){let t=e.find(e=>e.id===n);t&&t.employees.length>0&&(r=t.employees.map(e=>({...e,id:(0,e_.A)()})))}let l={id:(0,e_.A)(),month:s,year:a,employees:r,constraints:[],schedule:{},createdAt:new Date,isGenerated:!1};return t(e=>[...e,l]),i(l.id),l.id},deleteSchedule:e=>{t(t=>t.filter(t=>t.id!==e)),s===e&&i(null)},updateSchedule:d,getActiveSchedule:h,selectedMonth:m,selectedYear:f,employees:p,setEmployees:e=>{s&&d(s,{employees:e})},constraints:g,setConstraints:e=>{s&&d(s,{constraints:e})},schedule:(null==u?void 0:u.schedule)||{},setSchedule:e=>{s&&d(s,{schedule:e,isGenerated:Object.keys(e).length>0})},settings:n,setSettings:r}},eW=(e,t,s,i,a,n,r)=>({addEmployee:()=>{let s=r?r("employees.newEmployee"):"New Employee",i=(e.length+1).toString().padStart(3,"0"),a={id:(0,e_.A)(),name:"".concat(s," ").concat(i),shiftsPerMonth:[4,8],weekdayShifts:[0,8],weekendShifts:[0,8],tags:[]};t([...e,a]),r?Y.oR.success(r("toast.employeeAdded"),{description:r("toast.employeeAddedDescription",{name:a.name})}):Y.oR.success("Employee added",{description:"".concat(a.name," has been added to the schedule.")})},removeEmployee:r=>{t(e.filter(e=>e.id!==r)),i(s.filter(e=>e.employeeId!==r));let l={...a};Object.keys(l).forEach(e=>{let t=l[Number.parseInt(e)];t&&t.shifts&&(t.shifts=t.shifts.map(e=>({...e,employeeIds:e.employeeIds.filter(e=>e!==r)})))}),n(l)},updateEmployee:(s,i)=>{t(e.map(e=>e.id===s?{...e,...i}:e)),r?Y.oR.success(r("toast.employeeUpdated"),{description:r("toast.employeeUpdatedDescription")}):Y.oR.success("Employee updated",{description:"Employee information has been saved."})},toggleEmployeeTag:(s,i)=>{t(e.map(e=>{if(e.id===s){let t=e.tags.includes(i);return{...e,tags:t?e.tags.filter(e=>e!==i):[...e.tags,i]}}return e}))}}),eF=(e,t)=>({getConstraintsForEmployee:t=>e.filter(e=>e.employeeId===t),getShiftConstraint:(t,s,i)=>e.find(e=>e.employeeId===t&&e.date===s&&e.shiftIndex===i),removeConstraint:(s,i,a)=>{t(e.filter(e=>e.employeeId!==s||e.date!==i||void 0!==a&&e.shiftIndex!==a))},setShiftConstraint:(s,i,a,n)=>{t([...e.filter(e=>e.employeeId!==s||e.date!==a||e.shiftIndex!==n),{id:(0,e_.A)(),employeeId:s,type:i,date:a,shiftIndex:n}])},setAllShiftsConstraint:(s,i,a,n)=>{t([...e.filter(e=>e.employeeId!==s||e.date!==a),...Array.from({length:n},(e,t)=>({id:(0,e_.A)(),employeeId:s,type:i,date:a,shiftIndex:t}))])}}),eL=(e,t)=>e*t.personsPerShift.reduce((e,t)=>e+t,0);var ez=s(2764),eV=s.n(ez);let eU=e=>Math.floor(Math.random()*e),eB=(e,t,s,i)=>{let a=eL(i,s);if(e.length<a)throw Error("Not enough slots in optimized schedule");let n={},r=0;for(let a=1;a<=i;a++){n[a]={shifts:[]};for(let i=0;i<s.shiftsPerDay;i++){let l=[],o=s.personsPerShift[i];for(let s=0;s<o;s++){let s=e[r];if(s>=0&&s<t.length)l.push(t[s].id);else throw Error("Invalid employee index ".concat(s," in optimized schedule"));r++}n[a].shifts.push({employeeIds:l})}}return n},eH=e=>{let t=[];e.forEach((e,s)=>{for(let i=0;i<e.shiftsPerMonth[1];i++)t.push(s)});for(let e=t.length-1;e>0;e--){let s=eU(e+1);[t[e],t[s]]=[t[s],t[e]]}return t},eJ=(e,t,s,i,a,n,r)=>{let l=0,o=eL(a,i),c={AVOID_VIOLATION:2e3,DUPLICATE_PERSON_IN_SHIFT:2e3,CONSECUTIVE:100,WEEKLY_LIMIT:100,UNEVEN_DISTRIBUTION:50,MISSED_PREFERENCE:100,REST_DAYS:80,HOLIDAY_DISTRIBUTION:1e3,WEEKEND_CONSECUTIVE:50,TOTAL_SHIFT_COUNT:2e3,WEEKEND_SHIFTS_PREFERENCE:150,WEEKDAY_SHIFTS_PREFERENCE:150},d=Array(t.length).fill(0),h=t.map(()=>({current:0,max:0})),u=Array(t.length).fill(0),m=Array(t.length).fill(0),f=t.map(()=>({current:0,max:0})),p=e.slice(0,o);if(p.length<o)throw Error("Optimized schedule does not have enough slots: expected ".concat(o,", got ").concat(p.length));p.forEach(e=>{if(e<-1||e>=t.length)throw Error("Invalid employee index ".concat(e," in optimized schedule"))});for(let e=0;e<a;e++){let a=e+1,o=eY(a,i),g=p.slice(o.start,o.end);for(let e=0;e<i.shiftsPerDay;e++){let t=eq(a,e,i);new Set(p.slice(t.start,t.end)).size<i.personsPerShift[e]&&(l+=c.DUPLICATE_PERSON_IN_SHIFT)}let x=J(a,n,r);s.forEach(e=>{if(e.date===a){let s=t.findIndex(t=>t.id===e.employeeId);if(-1===s)return;let n=eq(a,e.shiftIndex,i),r=p.slice(n.start,n.end);"avoid"===e.type&&r.includes(s)&&(l+=c.AVOID_VIOLATION),"prefer"!==e.type||r.includes(s)||(l+=c.MISSED_PREFERENCE)}});let v=[...new Set(g)];v.forEach(s=>{var a;if(d[s]++,x?u[s]++:m[s]++,e>0){let t=eY(e,i),a=!1;for(let e=t.start;e<t.end;e++)if(p[e]===s){a=!0;break}a?h[s].current++:h[s].current=1}else h[s].current=1;if(h[s].max=Math.max(h[s].max,h[s].current),x&&(null==(a=t[s])?void 0:a.tags.includes("tags.weekendType"))){if(e>0){let t=J(e,n,r),a=eY(e,i),l=!1;if(t){for(let e=a.start;e<Math.min(a.end,p.length);e++)if(p[e]===s){l=!0;break}}l?f[s].current++:f[s].current=1}else f[s].current=1;f[s].max=Math.max(f[s].max,f[s].current)}else f[s].current=0}),t.forEach((e,t)=>{v.includes(t)||(h[t].current=0,f[t].current=0)})}t.forEach((e,t)=>{let s=0;h[t].max>i.maxConsecutiveShifts&&(s+=(h[t].max-i.maxConsecutiveShifts)*c.CONSECUTIVE),e.tags.includes("tags.weekendType")&&(f[t].max>=2?s=0:s+=c.WEEKEND_CONSECUTIVE),l+=s});let g=t.map(()=>[]);for(let e=0;e<a;e++){let s=eY(e+1,i);t.forEach((t,i)=>{let a=!1;for(let e=s.start;e<s.end&&e<p.length;e++)if(p[e]===i){a=!0;break}a&&g[i].push(e)})}for(let e=0;e<Math.ceil(a/7);e++){let s=7*e,n=Math.min(s+6,a-1);t.forEach((e,t)=>{let a=0;for(let e=s;e<=n;e++)g[t].includes(e)&&a++;a>i.maxShiftsPerWeek&&(l+=(a-i.maxShiftsPerWeek)*c.WEEKLY_LIMIT)})}if(t.forEach((e,t)=>{let s=g[t].sort((e,t)=>e-t);for(let e=0;e<s.length-1;e++){let t=s[e+1]-s[e]-1;t<i.minRestDaysBetweenShifts&&(l+=(i.minRestDaysBetweenShifts-t)*c.REST_DAYS)}}),t.forEach((e,t)=>{let s=d[t];s<e.shiftsPerMonth[0]&&(l+=(e.shiftsPerMonth[0]-s)*c.TOTAL_SHIFT_COUNT),s>e.shiftsPerMonth[1]&&(l+=(s-e.shiftsPerMonth[1])*c.TOTAL_SHIFT_COUNT);let i=u[t],a=m[t];i<e.weekendShifts[0]&&(l+=(e.weekendShifts[0]-i)*c.WEEKEND_SHIFTS_PREFERENCE),i>e.weekendShifts[1]&&(l+=(i-e.weekendShifts[1])*c.WEEKEND_SHIFTS_PREFERENCE),a<e.weekdayShifts[0]&&(l+=(e.weekdayShifts[0]-a)*c.WEEKDAY_SHIFTS_PREFERENCE),a>e.weekdayShifts[1]&&(l+=(a-e.weekdayShifts[1])*c.WEEKDAY_SHIFTS_PREFERENCE)}),i.evenDistribution){let e=d.reduce((e,t)=>e+t,0)/d.length,t=d.reduce((t,s)=>t+Math.pow(s-e,2),0)/d.length;l+=t*c.UNEVEN_DISTRIBUTION}let x=u.reduce((e,t)=>e+t,0),v=m.reduce((e,t)=>e+t,0);return x>0&&v>0&&t.forEach((e,t)=>{let s=d[t];if(s>0){let e=Math.abs(u[t]/s-x/(x+v));u[t]>0&&0===m[t]&&s>1?l+=2*c.HOLIDAY_DISTRIBUTION:m[t]>0&&0===u[t]&&s>1?l+=c.HOLIDAY_DISTRIBUTION:e>.3&&(l+=e*c.HOLIDAY_DISTRIBUTION)}}),console.log("Cost calculated: ".concat(l)),l},eY=(e,t)=>{let s=t.personsPerShift.reduce((e,t)=>e+t,0);return{start:(e-1)*s,end:e*s}},eq=(e,t,s)=>{let i=eY(e,s).start;for(let e=0;e<t;e++)i+=s.personsPerShift[e];return{start:i,end:i+s.personsPerShift[t]}},eG=e=>{let t=[...e];if(t.length<2)return t;let s=["swap","move","reverse","transport"],i=s[eU(s.length)],a=eU(t.length),n=eU(t.length);switch(i){case"swap":[t[a],t[n]]=[t[n],t[a]];break;case"move":{let e=t.splice(a,1)[0];t.splice(n,0,e);break}case"reverse":{let e=Math.min(a,n),s=Math.max(a,n);for(;e<s;)[t[e],t[s]]=[t[s],t[e]],e++,s--;break}case"transport":{if(t.length<3)break;let e=Math.min(a,n),s=Math.max(a,n);if(e<s){let i=t.splice(e,s-e+1),a=eU(t.length);t.splice(a,0,...i)}}}return t},eK=(e,t,s,i,a)=>{if(0===e.length)return{schedule:{},success:!1,message:"Please add employees before generating a schedule."};let n=U(i,a),r=eL(n,s),l=e.reduce((e,t)=>e+t.shiftsPerMonth[0],0),o=e.reduce((e,t)=>e+t.shiftsPerMonth[1],0);if(o<r)return{schedule:{},success:!1,message:"Not enough maximum shifts available (".concat(o,") to cover all required shifts (").concat(r,")")};if(l>r)return{schedule:{},success:!1,message:"Minimum shifts required (".concat(l,") exceed total shifts needed (").concat(r,")")};let c=eH(e);try{console.log("Starting optimized simulated annealing with ".concat(e.length," employees, ").concat(n," days"));let r=Date.now(),l=eV()({initialState:c,tempMax:1e3,tempMin:.1,newState:e=>eG(e),getTemp:e=>.999*e,getEnergy:r=>eJ(r,e,t,s,n,i,a)}),o=Date.now();console.log("Simulated annealing completed in ".concat(o-r,"ms"));let d=eB(l,e,s,n),h=eJ(l,e,t,s,n,i,a),u=0===h?"Perfect schedule generated with all constraints satisfied!":"Schedule generated with optimization score: ".concat(Math.round(Math.max(0,h)));return{schedule:d,success:!0,message:u}}catch(e){return console.error("Simulated annealing failed:",e),{schedule:{},success:!1,message:"Simulated annealing failed."}}},eQ={Maximize:(e,t)=>e>=t,Minimize:(e,t)=>e<t},eX={Tournament2(e,t){let s=t.length,i=t[Math.floor(Math.random()*s)],a=t[Math.floor(Math.random()*s)];return e(i.fitness,a.fitness)?i.entity:a.entity},Tournament3(e,t){let s=t.length,i=t[Math.floor(Math.random()*s)],a=t[Math.floor(Math.random()*s)],n=t[Math.floor(Math.random()*s)],r=e(i.fitness,a.fitness)?i:a;return(r=e(r.fitness,n.fitness)?r:n).entity},Fittest:e=>e[0].entity,Random:e=>e[Math.floor(Math.random()*e.length)].entity},eZ={Tournament2:(e,t)=>[eX.Tournament2(e,t),eX.Tournament2(e,t)],Random:e=>[eX.Random(e),eX.Random(e)],FittestRandom:e=>[eX.Fittest(e),eX.Random(e)]};function e$(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}class e0{mutateOrNot(e){return Math.random()<=this.configuration.mutation&&this.mutate?this.mutate(e$(e)):e}start(){if(!this.fitness||!this.seed)throw Error("fitness and seed functions must be defined");this.select1||(this.select1=e=>eX.Tournament2(this.optimize,e)),this.select2||(this.select2=e=>eZ.Tournament2(this.optimize,e)),this.optimize||(this.optimize=eQ.Minimize);for(let e=0;e<this.configuration.size;++e)this.entities.push(e$(this.seed()));for(let e=0;e<this.configuration.iterations;++e){this.internalGenState={};let t=this.entities.map(e=>({fitness:this.fitness(e),entity:e})).sort((e,t)=>this.optimize(e.fitness,t.fitness)?-1:1),s=t.reduce((e,t)=>e+t.fitness,0)/t.length,i=Math.sqrt(t.map(e=>(e.fitness-s)*(e.fitness-s)).reduce((e,t)=>e+t,0)/t.length),a={maximum:t[0].fitness,minimum:t[t.length-1].fitness,mean:s,stdev:i},n=!this.generation||this.generation(t.slice(0,this.configuration.maxResults),e,a),r=void 0!==n&&!n||e===this.configuration.iterations-1;if(this.notification&&(r||0===this.configuration.skip||e%this.configuration.skip==0)&&this.notification(t.slice(0,this.configuration.maxResults),e,a,r),r)return t[0].entity;let l=[];for(this.configuration.fittestAlwaysSurvives&&l.push(t[0].entity);l.length<this.configuration.size;)if(this.crossover&&Math.random()<=this.configuration.crossover&&l.length+1<this.configuration.size){let e=this.select2(t),s=this.crossover(e$(e[0]),e$(e[1])).map(e=>this.mutateOrNot(e));l.push(s[0],s[1])}else l.push(this.mutateOrNot(this.select1(t)));this.entities=l}return this.entities.map(e=>({fitness:this.fitness(e),entity:e})).sort((e,t)=>this.optimize(e.fitness,t.fitness)?-1:1)[0].entity}async evolve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.configuration,e),new Promise((e,t)=>{try{let t=this.start();e(t)}catch(e){t(e)}})}constructor(){this.fitness=null,this.seed=null,this.mutate=null,this.crossover=null,this.select1=null,this.select2=null,this.optimize=null,this.generation=null,this.notification=null,this.configuration={size:250,crossover:.9,mutation:.2,iterations:100,fittestAlwaysSurvives:!0,maxResults:100,skip:0},this.userData={},this.internalGenState={},this.entities=[]}}let e1={create:()=>new e0,Optimize:eQ,Select1:eX,Select2:eZ},e2=e=>Math.floor(Math.random()*e),e3=(e,t,s,i)=>{if(!e||!Array.isArray(e))throw Error("Invalid genetic schedule provided to optimizedToSchedule");let a={};for(let n=1;n<=i;n++){a[n]={shifts:[]};for(let i=0;i<s.shiftsPerDay;i++){let r=[],l=(n-1)*s.shiftsPerDay+i;if(l<e.length){let s=e[l];for(let e=0;e<s.length;e++)s[e]&&e<t.length&&r.push(t[e].id)}else throw Error("schedule generated is too short");a[n].shifts.push({employeeIds:r})}}return a},e4=(e,t,s,i,a,n,r)=>{let l=0,o={MAX_CONSECUTIVE_SHIFTS:100,MAX_CONSECUTIVE_DAYS:100,ENOUGH_REST_DAYS:100,MULTIPLE_SHIFTS_PER_DAY:100,TOTAL_SHIFT_COUNT:100,WEEKDAY_SHIFT_COUNT:100,WEEKEND_SHIFT_COUNT:100,AVOID_VIOLATION:100,PREFER_VIOLATION:10},c=Array(t.length).fill(0),d=t.map(()=>[]),h=t.map(()=>[]),u=Array(t.length).fill(0),m=Array(t.length).fill(0);for(let t=1;t<=a;t++)for(let s=0;s<i.shiftsPerDay;s++){let a=(t-1)*i.shiftsPerDay+s,l=e[a];for(let e=0;e<l.length;e++)l[e]&&(d[e].push(t),h[e].push(a),c[e]++,J(t,n,r)?u[e]++:m[e]++)}return t.forEach((e,t)=>{let s=c[t],a=u[t],n=m[t],r=d[t],f=h[t];s<e.shiftsPerMonth[0]&&(l+=o.TOTAL_SHIFT_COUNT*(e.shiftsPerMonth[0]-s)),s>e.shiftsPerMonth[1]&&(l+=o.TOTAL_SHIFT_COUNT*(s-e.shiftsPerMonth[1])),a<e.weekendShifts[0]&&(l+=o.WEEKDAY_SHIFT_COUNT*(e.weekendShifts[0]-a)),a>e.weekendShifts[1]&&(l+=o.WEEKDAY_SHIFT_COUNT*(a-e.weekendShifts[1])),n<e.weekdayShifts[0]&&(l+=o.WEEKEND_SHIFT_COUNT*(e.weekdayShifts[0]-n)),n>e.weekdayShifts[1]&&(l+=o.WEEKEND_SHIFT_COUNT*(n-e.weekdayShifts[1]));let p=1,g=1,x=r[0],v=f[0];for(let e=1;e<f.length;e++){let t=r[e],s=f[e];s===v+1?++g>i.maxConsecutiveShifts&&(l+=o.MAX_CONSECUTIVE_SHIFTS*(g-i.maxConsecutiveShifts)):g=1,t===x&&i.preventMultipleShiftsPerDay&&(l+=o.MULTIPLE_SHIFTS_PER_DAY),t===x+1?++p>i.maxConsecutiveDays&&(l+=o.MAX_CONSECUTIVE_DAYS*(p-i.maxConsecutiveDays)):t>x+1&&(p=1,t-x-1<i.minRestDaysBetweenShifts&&(l+=o.ENOUGH_REST_DAYS*(x+1+i.minRestDaysBetweenShifts-t)*(x+1+i.minRestDaysBetweenShifts-t))),x=t,v=s}}),s.forEach(s=>{let a=t.findIndex(e=>e.id===s.employeeId);if(-1===a)return;let n=(s.date-1)*i.shiftsPerDay+s.shiftIndex;if(n>=e.length)return;let r=e[n][a];"avoid"===s.type&&r?l+=o.AVOID_VIOLATION:"prefer"!==s.type||r||(l+=o.PREFER_VIOLATION)}),l},e5=(e,t,s)=>{let i=["swap_shift","move_shift","transport_shift","shift_random","shift_random","shift_random"];switch(i[e2(i.length)]){case"swap_shift":{let i=e2(s),a=e2(s),n=e2(t.shiftsPerDay),r=i*t.shiftsPerDay+n,l=a*t.shiftsPerDay+n;[e[r],e[l]]=[e[l],e[r]];break}case"move_shift":{let i=e2(s),a=e2(s),n=e.splice(i*t.shiftsPerDay,t.shiftsPerDay);e.splice(a*t.shiftsPerDay,0,...n);break}case"transport_shift":{let i=e2(s),a=e2(s),n=Math.min(i,a),r=Math.max(i,a),l=e.splice(n*t.shiftsPerDay,(r-n+1)*t.shiftsPerDay),o=e2(s);e.splice(o*t.shiftsPerDay,0,...l);break}case"shift_random":{let t=e2(e.length);for(let s=e[t].length-1;s>0;s--){let i=e2(s+1);[e[t][s],e[t][i]]=[e[t][i],e[t][s]]}}}return e},e6=(e,t)=>{let s=e.length;if(s<2)return[e,t];let i=e2(s),a=e2(s);for(;i===a;)a=e2(s);i>a&&([i,a]=[a,i]);let n=[],r=[];for(let l=0;l<s;l++)l<i?(n.push([...e[l]]),r.push([...t[l]])):l<a?(n.push([...t[l]]),r.push([...e[l]])):(n.push([...e[l]]),r.push([...t[l]]));return[n,r]},e8=(e,t,s)=>Array.from({length:s},(s,i)=>{let a=t.personsPerShift[i%t.shiftsPerDay],n=Array(a).fill(!0).concat(Array(e.length-a).fill(!1));for(let e=n.length-1;e>0;e--){let t=e2(e+1);[n[e],n[t]]=[n[t],n[e]]}return n}),e7=async(e,t,s,i,a)=>{let n=U(i,a),r=eL(n,s),l=e.reduce((e,t)=>e+t.shiftsPerMonth[0],0),o=e.reduce((e,t)=>e+t.shiftsPerMonth[1],0);if(o<r)return{schedule:{},success:!1,message:"Not enough maximum shifts available (".concat(o,") to cover all required shifts (").concat(r,")")};if(l>r)return{schedule:{},success:!1,message:"Minimum shifts required (".concat(l,") exceed total shifts needed (").concat(r,")")};try{let r=e1.create();r.seed=()=>e8(e,s,n*s.shiftsPerDay),r.fitness=r=>e4(r,e,t,s,n,i,a),r.mutate=e=>e5(e,s,n),r.crossover=e6,r.select1=e=>.9>=Math.random()?e1.Select1.Tournament2(e1.Optimize.Minimize,e):e1.Select1.Fittest(e),r.select2=e=>.9>=Math.random()?e1.Select2.Tournament2(e1.Optimize.Minimize,e):e1.Select2.FittestRandom(e),r.generation=(e,t,s)=>{t%10==0&&console.log("Gen ".concat(t,": best = ").concat(s.maximum," stdev = ").concat(s.stdev));let i=e[0];return 0!==i.fitness};let l={size:10,iterations:3e4,crossover:.4,mutation:.7,maxResults:1,skip:5};console.log("Starting genetic algorithm with config:",l);let o=await Promise.race([r.evolve(l),new Promise((e,t)=>setTimeout(()=>t(Error("Genetic algorithm timeout")),3e4))]),c=e3(o,e,s,n),d=e4(o,e,t,s,n,i,a);return{schedule:c,success:!0,message:"Genetic algorithm completed successfully. Final penalty score: ".concat(d)}}catch(e){return console.error("Genetic algorithm error:",e),{schedule:{},success:!1,message:"Genetic algorithm failed: ".concat(e instanceof Error?e.message:"Unknown error")}}};var e9=s(6710),te=function(e){return e[e.AVOID=0]="AVOID",e[e.PREFER=1]="PREFER",e[e.MUST_WORK=2]="MUST_WORK",e[e.UNAVAILABLE=3]="UNAVAILABLE",e[e.SKILL_REQUIRED=4]="SKILL_REQUIRED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function tt(){return{id:"",name:"",shiftsPerMonth:[],weekdayShifts:[],weekendShifts:[],tags:[]}}let ts={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;for(let s of(""!==e.id&&t.uint32(10).string(e.id),""!==e.name&&t.uint32(18).string(e.name),t.uint32(26).fork(),e.shiftsPerMonth))t.int32(s);for(let s of(t.join(),t.uint32(34).fork(),e.weekdayShifts))t.int32(s);for(let s of(t.join(),t.uint32(42).fork(),e.weekendShifts))t.int32(s);for(let s of(t.join(),e.tags))t.uint32(50).string(s);return t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tt();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.id=s.string();continue;case 2:if(18!==e)break;a.name=s.string();continue;case 3:if(24===e){a.shiftsPerMonth.push(s.int32());continue}if(26===e){let e=s.uint32()+s.pos;for(;s.pos<e;)a.shiftsPerMonth.push(s.int32());continue}break;case 4:if(32===e){a.weekdayShifts.push(s.int32());continue}if(34===e){let e=s.uint32()+s.pos;for(;s.pos<e;)a.weekdayShifts.push(s.int32());continue}break;case 5:if(40===e){a.weekendShifts.push(s.int32());continue}if(42===e){let e=s.uint32()+s.pos;for(;s.pos<e;)a.weekendShifts.push(s.int32());continue}break;case 6:if(50!==e)break;a.tags.push(s.string());continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({id:tj(e.id)?globalThis.String(e.id):"",name:tj(e.name)?globalThis.String(e.name):"",shiftsPerMonth:globalThis.Array.isArray(null==e?void 0:e.shiftsPerMonth)?e.shiftsPerMonth.map(e=>globalThis.Number(e)):[],weekdayShifts:globalThis.Array.isArray(null==e?void 0:e.weekdayShifts)?e.weekdayShifts.map(e=>globalThis.Number(e)):[],weekendShifts:globalThis.Array.isArray(null==e?void 0:e.weekendShifts)?e.weekendShifts.map(e=>globalThis.Number(e)):[],tags:globalThis.Array.isArray(null==e?void 0:e.tags)?e.tags.map(e=>globalThis.String(e)):[]}),toJSON(e){var t,s,i,a;let n={};return""!==e.id&&(n.id=e.id),""!==e.name&&(n.name=e.name),(null==(t=e.shiftsPerMonth)?void 0:t.length)&&(n.shiftsPerMonth=e.shiftsPerMonth.map(e=>Math.round(e))),(null==(s=e.weekdayShifts)?void 0:s.length)&&(n.weekdayShifts=e.weekdayShifts.map(e=>Math.round(e))),(null==(i=e.weekendShifts)?void 0:i.length)&&(n.weekendShifts=e.weekendShifts.map(e=>Math.round(e))),(null==(a=e.tags)?void 0:a.length)&&(n.tags=e.tags),n},create:e=>ts.fromPartial(null!=e?e:{}),fromPartial(e){var t,s,i,a,n,r;let l=tt();return l.id=null!=(n=e.id)?n:"",l.name=null!=(r=e.name)?r:"",l.shiftsPerMonth=(null==(t=e.shiftsPerMonth)?void 0:t.map(e=>e))||[],l.weekdayShifts=(null==(s=e.weekdayShifts)?void 0:s.map(e=>e))||[],l.weekendShifts=(null==(i=e.weekendShifts)?void 0:i.map(e=>e))||[],l.tags=(null==(a=e.tags)?void 0:a.map(e=>e))||[],l}};function ti(){return{id:"",employeeId:"",type:0,date:0,shiftIndex:0,weight:0,requiredSkill:"",reason:""}}let ta={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;return""!==e.id&&t.uint32(10).string(e.id),""!==e.employeeId&&t.uint32(18).string(e.employeeId),0!==e.type&&t.uint32(24).int32(e.type),0!==e.date&&t.uint32(32).int32(e.date),0!==e.shiftIndex&&t.uint32(40).int32(e.shiftIndex),0!==e.weight&&t.uint32(53).float(e.weight),""!==e.requiredSkill&&t.uint32(58).string(e.requiredSkill),""!==e.reason&&t.uint32(66).string(e.reason),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=ti();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.id=s.string();continue;case 2:if(18!==e)break;a.employeeId=s.string();continue;case 3:if(24!==e)break;a.type=s.int32();continue;case 4:if(32!==e)break;a.date=s.int32();continue;case 5:if(40!==e)break;a.shiftIndex=s.int32();continue;case 6:if(53!==e)break;a.weight=s.float();continue;case 7:if(58!==e)break;a.requiredSkill=s.string();continue;case 8:if(66!==e)break;a.reason=s.string();continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({id:tj(e.id)?globalThis.String(e.id):"",employeeId:tj(e.employeeId)?globalThis.String(e.employeeId):"",type:tj(e.type)?function(e){switch(e){case 0:case"AVOID":return 0;case 1:case"PREFER":return 1;case 2:case"MUST_WORK":return 2;case 3:case"UNAVAILABLE":return 3;case 4:case"SKILL_REQUIRED":return 4;default:return -1}}(e.type):0,date:tj(e.date)?globalThis.Number(e.date):0,shiftIndex:tj(e.shiftIndex)?globalThis.Number(e.shiftIndex):0,weight:tj(e.weight)?globalThis.Number(e.weight):0,requiredSkill:tj(e.requiredSkill)?globalThis.String(e.requiredSkill):"",reason:tj(e.reason)?globalThis.String(e.reason):""}),toJSON(e){let t={};return""!==e.id&&(t.id=e.id),""!==e.employeeId&&(t.employeeId=e.employeeId),0!==e.type&&(t.type=function(e){switch(e){case 0:return"AVOID";case 1:return"PREFER";case 2:return"MUST_WORK";case 3:return"UNAVAILABLE";case 4:return"SKILL_REQUIRED";default:return"UNRECOGNIZED"}}(e.type)),0!==e.date&&(t.date=Math.round(e.date)),0!==e.shiftIndex&&(t.shiftIndex=Math.round(e.shiftIndex)),0!==e.weight&&(t.weight=e.weight),""!==e.requiredSkill&&(t.requiredSkill=e.requiredSkill),""!==e.reason&&(t.reason=e.reason),t},create:e=>ta.fromPartial(null!=e?e:{}),fromPartial(e){var t,s,i,a,n,r,l,o;let c=ti();return c.id=null!=(t=e.id)?t:"",c.employeeId=null!=(s=e.employeeId)?s:"",c.type=null!=(i=e.type)?i:0,c.date=null!=(a=e.date)?a:0,c.shiftIndex=null!=(n=e.shiftIndex)?n:0,c.weight=null!=(r=e.weight)?r:0,c.requiredSkill=null!=(l=e.requiredSkill)?l:"",c.reason=null!=(o=e.reason)?o:"",c}};function tn(){return{shiftsPerDay:0,personsPerShift:[],maxConsecutiveShifts:0,maxConsecutiveDays:0,minRestDaysBetweenShifts:0,preventMultipleShiftsPerDay:!1,maxShiftsPerWeek:0,minShiftsPerWeek:0,evenDistribution:!1,shiftLabels:[],weekendShiftBalance:!1,skillMatching:!1,requiredSkillsPerShift:[],preferenceWeight:0,fairnessWeight:0,optimizeFor:""}}let tr={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;for(let s of(0!==e.shiftsPerDay&&t.uint32(8).int32(e.shiftsPerDay),t.uint32(18).fork(),e.personsPerShift))t.int32(s);for(let s of(t.join(),0!==e.maxConsecutiveShifts&&t.uint32(24).int32(e.maxConsecutiveShifts),0!==e.maxConsecutiveDays&&t.uint32(32).int32(e.maxConsecutiveDays),0!==e.minRestDaysBetweenShifts&&t.uint32(40).int32(e.minRestDaysBetweenShifts),!1!==e.preventMultipleShiftsPerDay&&t.uint32(48).bool(e.preventMultipleShiftsPerDay),0!==e.maxShiftsPerWeek&&t.uint32(56).int32(e.maxShiftsPerWeek),0!==e.minShiftsPerWeek&&t.uint32(64).int32(e.minShiftsPerWeek),!1!==e.evenDistribution&&t.uint32(72).bool(e.evenDistribution),e.shiftLabels))t.uint32(82).string(s);for(let s of(!1!==e.weekendShiftBalance&&t.uint32(88).bool(e.weekendShiftBalance),!1!==e.skillMatching&&t.uint32(96).bool(e.skillMatching),e.requiredSkillsPerShift))to.encode(s,t.uint32(106).fork()).join();return 0!==e.preferenceWeight&&t.uint32(117).float(e.preferenceWeight),0!==e.fairnessWeight&&t.uint32(125).float(e.fairnessWeight),""!==e.optimizeFor&&t.uint32(130).string(e.optimizeFor),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tn();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(8!==e)break;a.shiftsPerDay=s.int32();continue;case 2:if(16===e){a.personsPerShift.push(s.int32());continue}if(18===e){let e=s.uint32()+s.pos;for(;s.pos<e;)a.personsPerShift.push(s.int32());continue}break;case 3:if(24!==e)break;a.maxConsecutiveShifts=s.int32();continue;case 4:if(32!==e)break;a.maxConsecutiveDays=s.int32();continue;case 5:if(40!==e)break;a.minRestDaysBetweenShifts=s.int32();continue;case 6:if(48!==e)break;a.preventMultipleShiftsPerDay=s.bool();continue;case 7:if(56!==e)break;a.maxShiftsPerWeek=s.int32();continue;case 8:if(64!==e)break;a.minShiftsPerWeek=s.int32();continue;case 9:if(72!==e)break;a.evenDistribution=s.bool();continue;case 10:if(82!==e)break;a.shiftLabels.push(s.string());continue;case 11:if(88!==e)break;a.weekendShiftBalance=s.bool();continue;case 12:if(96!==e)break;a.skillMatching=s.bool();continue;case 13:if(106!==e)break;a.requiredSkillsPerShift.push(to.decode(s,s.uint32()));continue;case 14:if(117!==e)break;a.preferenceWeight=s.float();continue;case 15:if(125!==e)break;a.fairnessWeight=s.float();continue;case 16:if(130!==e)break;a.optimizeFor=s.string();continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({shiftsPerDay:tj(e.shiftsPerDay)?globalThis.Number(e.shiftsPerDay):0,personsPerShift:globalThis.Array.isArray(null==e?void 0:e.personsPerShift)?e.personsPerShift.map(e=>globalThis.Number(e)):[],maxConsecutiveShifts:tj(e.maxConsecutiveShifts)?globalThis.Number(e.maxConsecutiveShifts):0,maxConsecutiveDays:tj(e.maxConsecutiveDays)?globalThis.Number(e.maxConsecutiveDays):0,minRestDaysBetweenShifts:tj(e.minRestDaysBetweenShifts)?globalThis.Number(e.minRestDaysBetweenShifts):0,preventMultipleShiftsPerDay:!!tj(e.preventMultipleShiftsPerDay)&&globalThis.Boolean(e.preventMultipleShiftsPerDay),maxShiftsPerWeek:tj(e.maxShiftsPerWeek)?globalThis.Number(e.maxShiftsPerWeek):0,minShiftsPerWeek:tj(e.minShiftsPerWeek)?globalThis.Number(e.minShiftsPerWeek):0,evenDistribution:!!tj(e.evenDistribution)&&globalThis.Boolean(e.evenDistribution),shiftLabels:globalThis.Array.isArray(null==e?void 0:e.shiftLabels)?e.shiftLabels.map(e=>globalThis.String(e)):[],weekendShiftBalance:!!tj(e.weekendShiftBalance)&&globalThis.Boolean(e.weekendShiftBalance),skillMatching:!!tj(e.skillMatching)&&globalThis.Boolean(e.skillMatching),requiredSkillsPerShift:globalThis.Array.isArray(null==e?void 0:e.requiredSkillsPerShift)?e.requiredSkillsPerShift.map(e=>to.fromJSON(e)):[],preferenceWeight:tj(e.preferenceWeight)?globalThis.Number(e.preferenceWeight):0,fairnessWeight:tj(e.fairnessWeight)?globalThis.Number(e.fairnessWeight):0,optimizeFor:tj(e.optimizeFor)?globalThis.String(e.optimizeFor):""}),toJSON(e){var t,s,i;let a={};return 0!==e.shiftsPerDay&&(a.shiftsPerDay=Math.round(e.shiftsPerDay)),(null==(t=e.personsPerShift)?void 0:t.length)&&(a.personsPerShift=e.personsPerShift.map(e=>Math.round(e))),0!==e.maxConsecutiveShifts&&(a.maxConsecutiveShifts=Math.round(e.maxConsecutiveShifts)),0!==e.maxConsecutiveDays&&(a.maxConsecutiveDays=Math.round(e.maxConsecutiveDays)),0!==e.minRestDaysBetweenShifts&&(a.minRestDaysBetweenShifts=Math.round(e.minRestDaysBetweenShifts)),!1!==e.preventMultipleShiftsPerDay&&(a.preventMultipleShiftsPerDay=e.preventMultipleShiftsPerDay),0!==e.maxShiftsPerWeek&&(a.maxShiftsPerWeek=Math.round(e.maxShiftsPerWeek)),0!==e.minShiftsPerWeek&&(a.minShiftsPerWeek=Math.round(e.minShiftsPerWeek)),!1!==e.evenDistribution&&(a.evenDistribution=e.evenDistribution),(null==(s=e.shiftLabels)?void 0:s.length)&&(a.shiftLabels=e.shiftLabels),!1!==e.weekendShiftBalance&&(a.weekendShiftBalance=e.weekendShiftBalance),!1!==e.skillMatching&&(a.skillMatching=e.skillMatching),(null==(i=e.requiredSkillsPerShift)?void 0:i.length)&&(a.requiredSkillsPerShift=e.requiredSkillsPerShift.map(e=>to.toJSON(e))),0!==e.preferenceWeight&&(a.preferenceWeight=e.preferenceWeight),0!==e.fairnessWeight&&(a.fairnessWeight=e.fairnessWeight),""!==e.optimizeFor&&(a.optimizeFor=e.optimizeFor),a},create:e=>tr.fromPartial(null!=e?e:{}),fromPartial(e){var t,s,i,a,n,r,l,o,c,d,h,u,m,f,p,g;let x=tn();return x.shiftsPerDay=null!=(a=e.shiftsPerDay)?a:0,x.personsPerShift=(null==(t=e.personsPerShift)?void 0:t.map(e=>e))||[],x.maxConsecutiveShifts=null!=(n=e.maxConsecutiveShifts)?n:0,x.maxConsecutiveDays=null!=(r=e.maxConsecutiveDays)?r:0,x.minRestDaysBetweenShifts=null!=(l=e.minRestDaysBetweenShifts)?l:0,x.preventMultipleShiftsPerDay=null!=(o=e.preventMultipleShiftsPerDay)&&o,x.maxShiftsPerWeek=null!=(c=e.maxShiftsPerWeek)?c:0,x.minShiftsPerWeek=null!=(d=e.minShiftsPerWeek)?d:0,x.evenDistribution=null!=(h=e.evenDistribution)&&h,x.shiftLabels=(null==(s=e.shiftLabels)?void 0:s.map(e=>e))||[],x.weekendShiftBalance=null!=(u=e.weekendShiftBalance)&&u,x.skillMatching=null!=(m=e.skillMatching)&&m,x.requiredSkillsPerShift=(null==(i=e.requiredSkillsPerShift)?void 0:i.map(e=>to.fromPartial(e)))||[],x.preferenceWeight=null!=(f=e.preferenceWeight)?f:0,x.fairnessWeight=null!=(p=e.fairnessWeight)?p:0,x.optimizeFor=null!=(g=e.optimizeFor)?g:"",x}};function tl(){return{skills:[]}}let to={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;for(let s of e.skills)t.uint32(10).string(s);return t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tl();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.skills.push(s.string());continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({skills:globalThis.Array.isArray(null==e?void 0:e.skills)?e.skills.map(e=>globalThis.String(e)):[]}),toJSON(e){var t;let s={};return(null==(t=e.skills)?void 0:t.length)&&(s.skills=e.skills),s},create:e=>to.fromPartial(null!=e?e:{}),fromPartial(e){var t;let s=tl();return s.skills=(null==(t=e.skills)?void 0:t.map(e=>e))||[],s}};function tc(){return{employees:[],constraints:[],settings:void 0,selectedMonth:0,selectedYear:0,timeout:0}}let td={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;for(let s of e.employees)ts.encode(s,t.uint32(10).fork()).join();for(let s of e.constraints)ta.encode(s,t.uint32(18).fork()).join();return void 0!==e.settings&&tr.encode(e.settings,t.uint32(26).fork()).join(),0!==e.selectedMonth&&t.uint32(32).int32(e.selectedMonth),0!==e.selectedYear&&t.uint32(40).int32(e.selectedYear),0!==e.timeout&&t.uint32(48).int32(e.timeout),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tc();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.employees.push(ts.decode(s,s.uint32()));continue;case 2:if(18!==e)break;a.constraints.push(ta.decode(s,s.uint32()));continue;case 3:if(26!==e)break;a.settings=tr.decode(s,s.uint32());continue;case 4:if(32!==e)break;a.selectedMonth=s.int32();continue;case 5:if(40!==e)break;a.selectedYear=s.int32();continue;case 6:if(48!==e)break;a.timeout=s.int32();continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({employees:globalThis.Array.isArray(null==e?void 0:e.employees)?e.employees.map(e=>ts.fromJSON(e)):[],constraints:globalThis.Array.isArray(null==e?void 0:e.constraints)?e.constraints.map(e=>ta.fromJSON(e)):[],settings:tj(e.settings)?tr.fromJSON(e.settings):void 0,selectedMonth:tj(e.selectedMonth)?globalThis.Number(e.selectedMonth):0,selectedYear:tj(e.selectedYear)?globalThis.Number(e.selectedYear):0,timeout:tj(e.timeout)?globalThis.Number(e.timeout):0}),toJSON(e){var t,s;let i={};return(null==(t=e.employees)?void 0:t.length)&&(i.employees=e.employees.map(e=>ts.toJSON(e))),(null==(s=e.constraints)?void 0:s.length)&&(i.constraints=e.constraints.map(e=>ta.toJSON(e))),void 0!==e.settings&&(i.settings=tr.toJSON(e.settings)),0!==e.selectedMonth&&(i.selectedMonth=Math.round(e.selectedMonth)),0!==e.selectedYear&&(i.selectedYear=Math.round(e.selectedYear)),0!==e.timeout&&(i.timeout=Math.round(e.timeout)),i},create:e=>td.fromPartial(null!=e?e:{}),fromPartial(e){var t,s,i,a,n;let r=tc();return r.employees=(null==(t=e.employees)?void 0:t.map(e=>ts.fromPartial(e)))||[],r.constraints=(null==(s=e.constraints)?void 0:s.map(e=>ta.fromPartial(e)))||[],r.settings=void 0!==e.settings&&null!==e.settings?tr.fromPartial(e.settings):void 0,r.selectedMonth=null!=(i=e.selectedMonth)?i:0,r.selectedYear=null!=(a=e.selectedYear)?a:0,r.timeout=null!=(n=e.timeout)?n:0,r}};function th(){return{employeeIds:[]}}let tu={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;for(let s of e.employeeIds)t.uint32(10).string(s);return t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=th();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.employeeIds.push(s.string());continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({employeeIds:globalThis.Array.isArray(null==e?void 0:e.employeeIds)?e.employeeIds.map(e=>globalThis.String(e)):[]}),toJSON(e){var t;let s={};return(null==(t=e.employeeIds)?void 0:t.length)&&(s.employeeIds=e.employeeIds),s},create:e=>tu.fromPartial(null!=e?e:{}),fromPartial(e){var t;let s=th();return s.employeeIds=(null==(t=e.employeeIds)?void 0:t.map(e=>e))||[],s}};function tm(){return{shifts:[]}}let tf={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;for(let s of e.shifts)tu.encode(s,t.uint32(10).fork()).join();return t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tm();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.shifts.push(tu.decode(s,s.uint32()));continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({shifts:globalThis.Array.isArray(null==e?void 0:e.shifts)?e.shifts.map(e=>tu.fromJSON(e)):[]}),toJSON(e){var t;let s={};return(null==(t=e.shifts)?void 0:t.length)&&(s.shifts=e.shifts.map(e=>tu.toJSON(e))),s},create:e=>tf.fromPartial(null!=e?e:{}),fromPartial(e){var t;let s=tm();return s.shifts=(null==(t=e.shifts)?void 0:t.map(e=>tu.fromPartial(e)))||[],s}},tp={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;return Object.entries(e.days).forEach(e=>{let[s,i]=e;tx.encode({key:s,value:i},t.uint32(10).fork()).join()}),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a={days:{}};for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:{if(10!==e)break;let t=tx.decode(s,s.uint32());void 0!==t.value&&(a.days[t.key]=t.value);continue}}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({days:!function(e){return"object"==typeof e&&null!==e}(e.days)?{}:Object.entries(e.days).reduce((e,t)=>{let[s,i]=t;return e[globalThis.Number(s)]=tf.fromJSON(i),e},{})}),toJSON(e){let t={};if(e.days){let s=Object.entries(e.days);s.length>0&&(t.days={},s.forEach(e=>{let[s,i]=e;t.days[s]=tf.toJSON(i)}))}return t},create:e=>tp.fromPartial(null!=e?e:{}),fromPartial(e){var t;let s={days:{}};return s.days=Object.entries(null!=(t=e.days)?t:{}).reduce((e,t)=>{let[s,i]=t;return void 0!==i&&(e[globalThis.Number(s)]=tf.fromPartial(i)),e},{}),s}};function tg(){return{key:0,value:void 0}}let tx={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;return 0!==e.key&&t.uint32(8).int32(e.key),void 0!==e.value&&tf.encode(e.value,t.uint32(18).fork()).join(),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tg();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(8!==e)break;a.key=s.int32();continue;case 2:if(18!==e)break;a.value=tf.decode(s,s.uint32());continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({key:tj(e.key)?globalThis.Number(e.key):0,value:tj(e.value)?tf.fromJSON(e.value):void 0}),toJSON(e){let t={};return 0!==e.key&&(t.key=Math.round(e.key)),void 0!==e.value&&(t.value=tf.toJSON(e.value)),t},create:e=>tx.fromPartial(null!=e?e:{}),fromPartial(e){var t;let s=tg();return s.key=null!=(t=e.key)?t:0,s.value=void 0!==e.value&&null!==e.value?tf.fromPartial(e.value):void 0,s}};function tv(){return{solverStatus:"",solveTime:0,objectiveValue:0,constraintsSatisfied:!1,algorithm:""}}let ty={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;return""!==e.solverStatus&&t.uint32(10).string(e.solverStatus),0!==e.solveTime&&t.uint32(17).double(e.solveTime),0!==e.objectiveValue&&t.uint32(24).int32(e.objectiveValue),!1!==e.constraintsSatisfied&&t.uint32(32).bool(e.constraintsSatisfied),""!==e.algorithm&&t.uint32(42).string(e.algorithm),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tv();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;a.solverStatus=s.string();continue;case 2:if(17!==e)break;a.solveTime=s.double();continue;case 3:if(24!==e)break;a.objectiveValue=s.int32();continue;case 4:if(32!==e)break;a.constraintsSatisfied=s.bool();continue;case 5:if(42!==e)break;a.algorithm=s.string();continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({solverStatus:tj(e.solverStatus)?globalThis.String(e.solverStatus):"",solveTime:tj(e.solveTime)?globalThis.Number(e.solveTime):0,objectiveValue:tj(e.objectiveValue)?globalThis.Number(e.objectiveValue):0,constraintsSatisfied:!!tj(e.constraintsSatisfied)&&globalThis.Boolean(e.constraintsSatisfied),algorithm:tj(e.algorithm)?globalThis.String(e.algorithm):""}),toJSON(e){let t={};return""!==e.solverStatus&&(t.solverStatus=e.solverStatus),0!==e.solveTime&&(t.solveTime=e.solveTime),0!==e.objectiveValue&&(t.objectiveValue=Math.round(e.objectiveValue)),!1!==e.constraintsSatisfied&&(t.constraintsSatisfied=e.constraintsSatisfied),""!==e.algorithm&&(t.algorithm=e.algorithm),t},create:e=>ty.fromPartial(null!=e?e:{}),fromPartial(e){var t,s,i,a,n;let r=tv();return r.solverStatus=null!=(t=e.solverStatus)?t:"",r.solveTime=null!=(s=e.solveTime)?s:0,r.objectiveValue=null!=(i=e.objectiveValue)?i:0,r.constraintsSatisfied=null!=(a=e.constraintsSatisfied)&&a,r.algorithm=null!=(n=e.algorithm)?n:"",r}};function tS(){return{success:!1,schedule:void 0,metadata:void 0,message:""}}let tb={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e9.fI;return!1!==e.success&&t.uint32(8).bool(e.success),void 0!==e.schedule&&tp.encode(e.schedule,t.uint32(18).fork()).join(),void 0!==e.metadata&&ty.encode(e.metadata,t.uint32(26).fork()).join(),""!==e.message&&t.uint32(34).string(e.message),t},decode(e,t){let s=e instanceof e9.V5?e:new e9.V5(e),i=void 0===t?s.len:s.pos+t,a=tS();for(;s.pos<i;){let e=s.uint32();switch(e>>>3){case 1:if(8!==e)break;a.success=s.bool();continue;case 2:if(18!==e)break;a.schedule=tp.decode(s,s.uint32());continue;case 3:if(26!==e)break;a.metadata=ty.decode(s,s.uint32());continue;case 4:if(34!==e)break;a.message=s.string();continue}if((7&e)==4||0===e)break;s.skip(7&e)}return a},fromJSON:e=>({success:!!tj(e.success)&&globalThis.Boolean(e.success),schedule:tj(e.schedule)?tp.fromJSON(e.schedule):void 0,metadata:tj(e.metadata)?ty.fromJSON(e.metadata):void 0,message:tj(e.message)?globalThis.String(e.message):""}),toJSON(e){let t={};return!1!==e.success&&(t.success=e.success),void 0!==e.schedule&&(t.schedule=tp.toJSON(e.schedule)),void 0!==e.metadata&&(t.metadata=ty.toJSON(e.metadata)),""!==e.message&&(t.message=e.message),t},create:e=>tb.fromPartial(null!=e?e:{}),fromPartial(e){var t,s;let i=tS();return i.success=null!=(t=e.success)&&t,i.schedule=void 0!==e.schedule&&null!==e.schedule?tp.fromPartial(e.schedule):void 0,i.metadata=void 0!==e.metadata&&null!==e.metadata?ty.fromPartial(e.metadata):void 0,i.message=null!=(s=e.message)?s:"",i}};function tj(e){return null!=e}let tN="https://1.34.36.98:26749";function tw(e){return{id:e.id,name:e.name,shiftsPerMonth:e.shiftsPerMonth,weekdayShifts:e.weekdayShifts,weekendShifts:e.weekendShifts,tags:e.tags}}function tk(e){return{id:e.id,employeeId:e.employeeId,type:"avoid"===e.type?te.AVOID:te.PREFER,date:e.date,shiftIndex:e.shiftIndex,weight:1,requiredSkill:"",reason:""}}async function tP(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new AbortController,a=setTimeout(()=>i.abort(),s);try{let s=await fetch(e,{method:"POST",signal:i.signal,headers:{"Content-Type":"application/x-protobuf",Accept:"application/x-protobuf"},body:t});if(clearTimeout(a),!s.ok){let e="HTTP ".concat(s.status,": ").concat(s.statusText);try{let t=await s.text();t&&(e=t)}catch(e){}throw new eo(e,s.status)}let n=new Uint8Array(await s.arrayBuffer());return tb.decode(n)}catch(e){if(clearTimeout(a),e instanceof DOMException&&"AbortError"===e.name)throw new el(s);if(e instanceof er)throw e;throw new er("Network error: ".concat(e instanceof Error?e.message:"Unknown error"))}}async function tD(e,t,s,i,a){var n,r;let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,o={employees:e.map(tw),constraints:t.map(tk),settings:{shiftsPerDay:(r=s).shiftsPerDay,personsPerShift:r.personsPerShift,maxConsecutiveShifts:r.maxConsecutiveShifts,maxConsecutiveDays:r.maxConsecutiveDays,minRestDaysBetweenShifts:r.minRestDaysBetweenShifts,preventMultipleShiftsPerDay:r.preventMultipleShiftsPerDay,maxShiftsPerWeek:r.maxShiftsPerWeek,minShiftsPerWeek:r.minShiftsPerWeek,evenDistribution:r.evenDistribution,shiftLabels:r.shiftLabels||[],weekendShiftBalance:!0,skillMatching:!1,requiredSkillsPerShift:[],preferenceWeight:.5,fairnessWeight:1,optimizeFor:"balanced"},selectedMonth:i,selectedYear:a,timeout:l},c=td.encode(o).finish(),d=await tP("".concat(tN,"/api/v1/schedule/generate-pb"),c,(l+5)*1e3);return{schedule:d.schedule?function(e){let t={};if(e.days)for(let[s,i]of Object.entries(e.days))t[parseInt(s)]={shifts:(i.shifts||[]).map(e=>({employeeIds:e.employeeIds||[]}))};return t}(d.schedule):{},success:d.success||!1,message:d.message||"Unknown response",metadata:d.metadata?{solver_status:(n=d.metadata).solverStatus||"UNKNOWN",solve_time:n.solveTime||0,objective_value:n.objectiveValue||0,constraints_satisfied:n.constraintsSatisfied||!1,algorithm:n.algorithm||"cp-sat"}:void 0,payloadSize:{request:c.length,response:tb.encode(d).finish().length}}}async function tE(){let e=Date.now();try{let t={employees:[{id:"test",name:"Test Employee",shiftsPerMonth:[1,2],weekdayShifts:[1,1],weekendShifts:[0,1],tags:[]}],constraints:[],settings:{shiftsPerDay:1,personsPerShift:[1],maxConsecutiveShifts:1,maxConsecutiveDays:1,minRestDaysBetweenShifts:1,preventMultipleShiftsPerDay:!1,maxShiftsPerWeek:7,minShiftsPerWeek:0,evenDistribution:!1,shiftLabels:["Day"],weekendShiftBalance:!1,skillMatching:!1,requiredSkillsPerShift:[],preferenceWeight:1,fairnessWeight:1,optimizeFor:"balanced"},selectedMonth:1,selectedYear:2025,timeout:5},s=td.encode(t).finish(),i=JSON.stringify(t).length,a=s.length;await tP("".concat(tN,"/api/v1/schedule/generate-pb"),s,5e3);let n=Date.now()-e;return{available:!0,latency:n,payloadSavings:Math.round(100*(i>0?(i-a)/i*100:0))/100}}catch(e){return{available:!1,error:e instanceof Error?e.message:"Unknown error"}}}let tT=()=>{let[e,t]=(0,a.useState)(!1);return{isGenerating:e,handleGenerateSchedule:async(e,s,i,a,n,r,l)=>{t(!0);try{let t,o=l||i.preferredAlgorithm||"auto";switch("auto"===o&&(("protobuf"===i.apiFormat?await tE():await ep()).available?o="cp-sat":(console.log("CP-SAT server not available, falling back to local algorithms"),o=1===i.shiftsPerDay?"simulated-annealing":"genetic")),o){case"cp-sat":console.log("Using CP-SAT solver..."),await new Promise(e=>setTimeout(e,500));try{if("protobuf"===i.apiFormat){if(console.log("Using Protocol Buffers API for CP-SAT..."),(t=await tD(e,s,i,a,n,30)).payloadSize){let e=Math.round((1-t.payloadSize.response/(t.payloadSize.request||1))*100);t.message+=" (Protobuf: ".concat(t.payloadSize.request,"→").concat(t.payloadSize.response," bytes, ").concat(e,"% smaller)")}}else console.log("Using JSON API for CP-SAT..."),t=await ef(e,s,i,a,n,30);if(t.success&&t.metadata){let{solve_time:e,objective_value:s,constraints_satisfied:i}=t.metadata;t.message+=" (Solved in ".concat(e.toFixed(2),"s, objective: ").concat(s,", constraints: ").concat(i?"all satisfied":"some violated",")")}}catch(r){r instanceof el?Y.oR.error("CP-SAT solver timeout",{description:"The solver took too long. Trying fallback algorithm..."}):r instanceof eo?Y.oR.error("CP-SAT server error",{description:"Server issue detected. Trying fallback algorithm..."}):r instanceof er&&Y.oR.error("CP-SAT connection error",{description:"Cannot connect to solver. Trying fallback algorithm..."}),console.log("CP-SAT failed, falling back to genetic algorithm:",r),o="genetic",(t=await e7(e,s,i,a,n)).message="Fallback: ".concat(t.message)}break;case"genetic":console.log("Using genetic algorithm..."),await new Promise(e=>setTimeout(e,500)),t=await e7(e,s,i,a,n);break;default:console.log("Using simulated annealing algorithm..."),await new Promise(e=>setTimeout(e,500)),t=eK(e,s,i,a,n)}if(t.success){let e;switch(r(t.schedule),o){case"cp-sat":let s="protobuf"===i.apiFormat?" (Protobuf)":" (JSON)";e="CP-SAT Solver"+s;break;case"genetic":e="Genetic Algorithm";break;default:e="Simulated Annealing"}Y.oR.success("Schedule generated with ".concat(e),{description:t.message})}else Y.oR.error("Generation failed",{description:t.message})}catch(e){console.error("Schedule generation error:",e),Y.oR.error("Generation error",{description:"An unexpected error occurred while generating the schedule."})}finally{t(!1)}}}},tA=()=>{let[e,t]=(0,a.useState)(!1),s=(0,a.useCallback)(()=>{t(e=>!e)},[]);return(0,a.useEffect)(()=>{let e=e=>{e.ctrlKey&&"b"===e.key&&(e.preventDefault(),s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),{isEmployeePanelCollapsed:e,toggleEmployeePanel:s}};function tI(){let e=(0,q.c3)(),{schedules:t,activeScheduleId:s,setActiveScheduleId:n,addSchedule:r,deleteSchedule:l,selectedMonth:m,selectedYear:f,employees:p,setEmployees:w,constraints:k,setConstraints:P,schedule:D,setSchedule:E,settings:T,setSettings:A}=eR(),{addEmployee:I,removeEmployee:C,updateEmployee:M,toggleEmployeeTag:_}=eW(p,w,k,P,D,E,e),{removeConstraint:O,setShiftConstraint:R,setAllShiftsConstraint:W}=eF(k,P),{isGenerating:F,handleGenerateSchedule:L}=tT(),{isEmployeePanelCollapsed:z,toggleEmployeePanel:V}=tA(),[U,B]=(0,a.useState)("");return(0,i.jsx)("div",{children:(0,i.jsxs)(c,{defaultValue:"about",className:"space-y-0",children:[(0,i.jsx)(d,{className:"w-full",children:(0,i.jsxs)("div",{className:"w-full flex justify-between items-center px-6",children:[(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsxs)(h,{value:"about",className:"flex items-center gap-2",children:[(0,i.jsx)(x.A,{className:"w-4 h-4"}),"About"]}),(0,i.jsxs)(h,{value:"setup",className:"flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"w-4 h-4"}),e("page.setup")]}),(0,i.jsxs)(h,{value:"constraints",className:"flex items-center gap-2",children:[(0,i.jsx)(y.A,{className:"w-4 h-4"}),e("page.constraints")]})]}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(eM,{})})]})}),(0,i.jsx)(u,{value:"about",className:"mt-0",children:(0,i.jsx)("div",{className:"container mx-auto p-6 max-w-6xl",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center max-w-3xl mx-auto",children:[(0,i.jsx)("h1",{className:"text-4xl font-bold mb-4",children:e("page.title")}),(0,i.jsx)("p",{className:"text-lg text-muted-foreground leading-relaxed",children:e("page.description")})]}),(0,i.jsx)("div",{className:"border-t pt-6",children:(0,i.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-center",children:e("dataManagement.title")}),(0,i.jsxs)("div",{className:"bg-muted/50 rounded-lg p-6 space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e("dataManagement.clearAllDataDescription")}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsxs)(g,{variant:"destructive",onClick:()=>{window.confirm(e("dataManagement.clearAllDataConfirm"))&&(localStorage.removeItem("scheduleData"),localStorage.removeItem("locale"),Y.oR.success(e("dataManagement.dataCleared")),window.location.reload())},className:"flex items-center gap-2",children:[(0,i.jsx)(S.A,{className:"w-4 h-4"}),e("dataManagement.clearAllData")]})})]})]})})]})})}),(0,i.jsx)(u,{value:"setup",className:"mt-0",children:(0,i.jsx)("div",{className:"container mx-auto p-6 transition-all duration-300 max-w-none",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(G,{schedules:t,activeScheduleId:s,onScheduleSelect:n,onScheduleAdd:r,onScheduleDelete:l}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(g,{variant:"outline",size:"sm",onClick:V,className:"mb-4 shadow-sm hover:shadow-md transition-all",title:z?"Show employee panel (Ctrl+B)":"Hide employee panel (Ctrl+B)",children:z?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.A,{className:"w-4 h-4 mr-2"}),(0,i.jsx)(j.A,{className:"w-4 h-4"}),(0,i.jsx)("span",{className:"ml-1",children:e("employees.showEmployees")})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.A,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:e("employees.hideEmployees")})]})}),(0,i.jsxs)("div",{className:o("transition-all duration-300 ease-in-out",z?"grid grid-cols-1 gap-6":"grid grid-cols-1 xl:grid-cols-4 gap-6"),children:[!z&&(0,i.jsx)("div",{className:"transition-all duration-300",children:(0,i.jsx)(ei,{employees:p,selectedEmployee:U,onEmployeeSelect:B,onAddEmployee:I,onRemoveEmployee:C,onUpdateEmployee:M,onToggleTag:_,predefinedTags:["tags.weekendType","tags.rookie","tags.veteran"],hasActiveSchedule:null!==s})}),(0,i.jsx)("div",{className:o("transition-all duration-300",z?"col-span-2":"xl:col-span-3"),children:(0,i.jsx)(eT,{schedule:D,employees:p,selectedMonth:m,selectedYear:f,hasActiveSchedule:null!==s,constraints:k,selectedEmployee:U,settings:T,onSetConstraint:(e,t,s,i)=>{void 0===i?W(e,t,s,T.shiftsPerDay):R(e,t,s,i)},onRemoveConstraint:O,onGenerateSchedule:()=>{L(p,k,T,m,f,E)},isGenerating:F})})]})]})]})})}),(0,i.jsx)(u,{value:"constraints",className:"mt-0",children:(0,i.jsx)("div",{className:"container mx-auto p-6 max-w-6xl",children:(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsx)(ej,{settings:T,onSettingsChange:A})})})})]})})}},5272:(e,t,s)=>{var i={"./en.json":[9373,373],"./zh-TW.json":[9032,32]};function a(e){if(!s.o(i,e))return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],a=t[0];return s.e(t[1]).then(()=>s.t(a,19))}a.keys=()=>Object.keys(i),a.id=5272,e.exports=a},7544:(e,t,s)=>{Promise.resolve().then(s.bind(s,1216))}},e=>{var t=t=>e(e.s=t);e.O(0,[208,967,441,684,358],()=>t(7544)),_N_E=e.O()}]);