(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{143:(e,t,s)=>{"use strict";s.d(t,{LocaleProvider:()=>i,Y:()=>o});var r=s(5155),a=s(2115),n=s(6096);let l=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[i,o]=(0,a.useState)("en"),[d,c]=(0,a.useState)(null);return((0,a.useEffect)(()=>{let e=localStorage.getItem("locale");e&&("en"===e||"zh-TW"===e)&&o(e)},[]),(0,a.useEffect)(()=>{(async()=>{try{let e=await s(5272)("./".concat(i,".json"));c(e.default)}catch(e){console.error("Failed to load messages:",e)}})()},[i]),d)?(0,r.jsx)(l.Provider,{value:{locale:i,setLocale:e=>{o(e),localStorage.setItem("locale",e)}},children:(0,r.jsx)(n.A,{locale:i,messages:d,children:t})}):(0,r.jsx)("div",{children:"Loading..."})}function o(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useLocale must be used within a LocaleProvider");return e}},5272:(e,t,s)=>{var r={"./en.json":[9373,373],"./zh-TW.json":[9032,32]};function a(e){if(!s.o(r,e))return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=r[e],a=t[0];return s.e(t[1]).then(()=>s.t(a,19))}a.keys=()=>Object.keys(r),a.id=5272,e.exports=a},7308:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eR});var r=s(5155),a=s(2115),n=s(2473),l=s(2596),i=s(9688);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,l.$)(t))}function d(e){let{className:t,...s}=e;return(0,r.jsx)(n.bL,{"data-slot":"tabs",className:o("flex flex-col gap-2",t),...s})}function c(e){let{className:t,...s}=e;return(0,r.jsx)(n.B8,{"data-slot":"tabs-list",className:o("bg-background text-muted-foreground w-full border-b shadow-sm",t),...s})}function h(e){let{className:t,...s}=e;return(0,r.jsx)(n.l9,{"data-slot":"tabs-trigger",className:o("data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-muted-foreground inline-flex h-14 items-center justify-center gap-2 px-8 py-4 text-sm font-medium whitespace-nowrap transition-all hover:text-foreground hover:bg-muted/80 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 relative after:absolute after:bottom-0 after:left-0 after:right-0 after:h-1 after:bg-transparent data-[state=active]:after:bg-primary",t),...s})}function m(e){let{className:t,...s}=e;return(0,r.jsx)(n.UC,{"data-slot":"tabs-content",className:o("flex-1 outline-none",t),...s})}var u=s(9708),x=s(2085);let f=(0,x.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function p(e){let{className:t,variant:s,size:a,asChild:n=!1,...l}=e,i=n?u.DX:"button";return(0,r.jsx)(i,{"data-slot":"button",className:o(f({variant:s,size:a,className:t})),...l})}var g=s(1284),v=s(9074),y=s(381),b=s(7580),j=s(3052),N=s(2355);function S(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:o("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function w(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:o("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function k(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:o("leading-none font-semibold",t),...s})}function E(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:o("px-6",t),...s})}var D=s(1522),P=s(6474),I=s(5196),C=s(7863);function A(e){let{...t}=e;return(0,r.jsx)(D.bL,{"data-slot":"select",...t})}function R(e){let{...t}=e;return(0,r.jsx)(D.WT,{"data-slot":"select-value",...t})}function M(e){let{className:t,size:s="default",children:a,...n}=e;return(0,r.jsxs)(D.l9,{"data-slot":"select-trigger","data-size":s,className:o("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[a,(0,r.jsx)(D.In,{asChild:!0,children:(0,r.jsx)(P.A,{className:"size-4 opacity-50"})})]})}function T(e){let{className:t,children:s,position:a="popper",...n}=e;return(0,r.jsx)(D.ZL,{children:(0,r.jsxs)(D.UC,{"data-slot":"select-content",className:o("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...n,children:[(0,r.jsx)(L,{}),(0,r.jsx)(D.LM,{className:o("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,r.jsx)(_,{})]})})}function z(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(D.q7,{"data-slot":"select-item",className:o("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...a,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(D.VF,{children:(0,r.jsx)(I.A,{className:"size-4"})})}),(0,r.jsx)(D.p4,{children:s})]})}function L(e){let{className:t,...s}=e;return(0,r.jsx)(D.PP,{"data-slot":"select-scroll-up-button",className:o("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(C.A,{className:"size-4"})})}function _(e){let{className:t,...s}=e;return(0,r.jsx)(D.wn,{"data-slot":"select-scroll-down-button",className:o("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(P.A,{className:"size-4"})})}var O=s(4616),F=s(646),U=s(9428),H=s(2525);let W=(e,t)=>e<0||e>11||!t?0:new Date(t,e+1,0).getDate(),V=(e,t)=>e<0||e>11?"":t("months.".concat(e))||"",B=(e,t)=>new Date(t,e,1).getDay(),Y=(e,t,s)=>{let r=new Date(s,t,e).getDay();return 0===r||6===r};var G=s(6671),q=s(7652);let K=e=>{let{schedules:t,activeScheduleId:s,onScheduleSelect:n,onScheduleAdd:l,onScheduleDelete:i}=e,[o,d]=(0,a.useState)(!1),[c,h]=(0,a.useState)(null),[m,u]=(0,a.useState)(null),[x,f]=(0,a.useState)("auto"),g=(0,q.c3)(),y=s&&!o,b=new Date,j=b.getMonth(),N=b.getFullYear(),D=()=>{if(0===t.length)return null;let e=t[0];for(let s=1;s<t.length;s++){let r=t[s];(r.year>e.year||r.year===e.year&&r.month>e.month)&&(e=r)}return e},P=()=>{let e=D();if(!e)return{month:j,year:N};let t=new Date(e.year,e.month),s=new Date(t.getFullYear(),t.getMonth()+1);return{month:s.getMonth(),year:s.getFullYear()}},I=(e,t,s)=>{i(e),G.oR.success(g("toast.scheduleDeleted"),{description:g("toast.scheduleDeletedDescription",{month:V(t,g),year:s})})},C=[...t].sort((e,t)=>t.year-e.year||t.month-e.month),L=Array.from({length:12},(e,t)=>({value:t.toString(),label:g("months.".concat(t))})),_=Array.from({length:10},(e,t)=>{let s=b.getFullYear()-2+t;return{value:s.toString(),label:s.toString()}});return(0,r.jsxs)(S,{children:[(0,r.jsxs)(w,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(k,{className:"flex items-center gap-2",children:[(0,r.jsx)(v.A,{className:"w-5 h-5"}),g("scheduleHistory.title"),y&&s&&(0,r.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["-"," ",(()=>{let e=t.find(e=>e.id===s);return e?"".concat(V(e.month,g)," ").concat(e.year):""})()]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[y&&(0,r.jsx)(p,{variant:"ghost",size:"sm",onClick:()=>n(null),className:"flex items-center gap-2",children:g("scheduleHistory.showAll")}),(0,r.jsxs)(p,{onClick:()=>{let{month:e,year:t}=P();d(!0),h(e),u(t),f("auto")},size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"w-4 h-4"}),g("scheduleHistory.addSchedule")]})]})]}),0===t.length&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:g("scheduleHistory.noSchedulesYet")})]}),!y&&(0,r.jsxs)(E,{className:"space-y-4",children:[o&&(0,r.jsxs)("div",{className:"p-4 border rounded-lg bg-muted/50 space-y-4",children:[(0,r.jsx)("h4",{className:"font-medium",children:g("scheduleHistory.createNewSchedule")}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:g("scheduleHistory.month")}),(0,r.jsxs)(A,{value:(null==c?void 0:c.toString())||"",onValueChange:e=>h(parseInt(e)),children:[(0,r.jsx)(M,{children:(0,r.jsx)(R,{placeholder:g("scheduleHistory.selectMonth")})}),(0,r.jsx)(T,{children:L.map(e=>(0,r.jsx)(z,{value:e.value,children:e.label},e.value))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:g("scheduleHistory.year")}),(0,r.jsxs)(A,{value:(null==m?void 0:m.toString())||"",onValueChange:e=>u(parseInt(e)),children:[(0,r.jsx)(M,{children:(0,r.jsx)(R,{placeholder:g("scheduleHistory.selectYear")})}),(0,r.jsx)(T,{children:_.map(e=>(0,r.jsx)(z,{value:e.value,children:e.label},e.value))})]})]})]}),t.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:g("scheduleHistory.employeeImport")}),(0,r.jsxs)(A,{value:x,onValueChange:f,children:[(0,r.jsx)(M,{children:(0,r.jsx)(R,{placeholder:g("scheduleHistory.chooseImportOption")})}),(0,r.jsxs)(T,{children:[(0,r.jsx)(z,{value:"auto",children:g("scheduleHistory.autoImportFromRecent")}),(0,r.jsx)(z,{value:"none",children:g("scheduleHistory.startWithEmptyList")}),C.map(e=>(0,r.jsxs)(z,{value:e.id,children:[g("scheduleHistory.copyFrom")," ",V(e.month,g)," ",e.year," (",e.employees.length," ",g("scheduleHistory.employees"),")"]},e.id))]})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:g("scheduleHistory.importNote")})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(p,{onClick:()=>{if(!c||!m)return void G.oR.error(g("toast.invalidInput"),{description:g("toast.selectBothMonthYear")});try{let e;if("auto"===x){let t=D();e=null==t?void 0:t.id}else"none"!==x&&(e=x);l(c,m,e),d(!1),h(null),u(null),f("auto");let t=e?g("toast.withImportedEmployees"):g("toast.withEmptyEmployeeList");G.oR.success(g("toast.scheduleCreated"),{description:g("toast.scheduleCreatedDescription",{month:V(c,g),year:m,importMessage:t})})}catch(e){G.oR.error(g("toast.creationFailed"),{description:e instanceof Error?e.message:g("toast.creationFailedDescription")})}},size:"sm",children:g("scheduleHistory.createSchedule")}),(0,r.jsx)(p,{variant:"outline",onClick:()=>{d(!1),h(null),u(null),f("auto")},size:"sm",children:g("scheduleHistory.cancel")})]})]}),C.length>0&&(0,r.jsx)("div",{className:"space-y-2",children:C.map(e=>(0,r.jsxs)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat(e.id===s?"bg-primary/10 border-primary":"hover:bg-muted/50"),onClick:()=>{e.id===s?n(null):n(e.id)},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.isGenerated?(0,r.jsx)(F.A,{className:"w-4 h-4 text-green-600"}):(0,r.jsx)(U.A,{className:"w-4 h-4 text-muted-foreground"}),(0,r.jsxs)("span",{className:"font-medium",children:[V(e.month,g)," ",e.year]})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.employees.length," ",g("scheduleHistory.employees")]}),(0,r.jsx)(p,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),I(e.id,e.month,e.year)},className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:(0,r.jsx)(H.A,{className:"w-3 h-3"})})]})]}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[g("scheduleHistory.created")," ",e.createdAt.toLocaleDateString(),e.isGenerated&&(0,r.jsxs)("span",{className:"ml-2 text-green-600",children:["• ",g("scheduleHistory.generated")]})]})]},e.id))})]})]})};function X(e){let{className:t,type:s,...a}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:o("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}var J=s(968);function Q(e){let{className:t,...s}=e;return(0,r.jsx)(J.b,{"data-slot":"label",className:o("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}let Z=(0,x.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function $(e){let{className:t,variant:s,asChild:a=!1,...n}=e,l=a?u.DX:"span";return(0,r.jsx)(l,{"data-slot":"badge",className:o(Z({variant:s}),t),...n})}var ee=s(4073);let et=a.forwardRef((e,t)=>{let{className:s,label:n,labelPosition:l="top",...i}=e,d=Array.isArray(i.value)?i.value:Array.isArray(i.defaultValue)?i.defaultValue:[i.min||0,i.max||100],[c,h]=a.useState(d);return a.useEffect(()=>{Array.isArray(i.value)&&h(i.value)},[i.value]),(0,r.jsxs)(ee.bL,{ref:t,className:o("relative flex w-full touch-none select-none items-center",s),...i,value:c,onValueChange:e=>{h(e),i.onValueChange&&i.onValueChange(e)},children:[(0,r.jsx)(ee.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,r.jsx)(ee.Q6,{className:"absolute h-full bg-primary"})}),c.map((e,t)=>(0,r.jsx)(a.Fragment,{children:(0,r.jsx)(ee.zi,{className:"block h-4 w-4 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:n&&(0,r.jsx)("span",{className:o("absolute flex w-full justify-center","top"===l&&"-top-7","bottom"===l&&"top-4"),children:n(e)})})},t))]})});et.displayName="DualRangeSlider";let es=e=>{let{employee:t,isSelected:s,isEditing:n,predefinedTags:l,onEmployeeSelect:i,onRemoveEmployee:o,onUpdateEmployee:d,onToggleTag:c,onStartEditing:h,onStopEditing:m}=e,[u,x]=(0,a.useState)(""),[f,g]=(0,a.useState)([0,0]),[v,y]=(0,a.useState)([0,0]),[b,j]=(0,a.useState)([0,0]),N=(0,q.c3)(),S=()=>{x(t.name),g(t.shiftsPerMonth),y(t.weekdayShifts),j(t.weekendShifts),h(t)};return(0,r.jsx)("div",{className:"border rounded-lg transition-colors ".concat(s?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:n?(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{htmlFor:"editName",className:"mb-1",children:N("employees.name")}),(0,r.jsx)(X,{id:"editName",value:u,onChange:e=>x(e.target.value),placeholder:N("employees.namePlaceholder")})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:N("employees.shiftsRangeNote")}),(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{className:"mb-2",children:N("employees.minMaxShiftsPerMonth")}),(0,r.jsx)("div",{className:"px-3 mb-8",children:(0,r.jsx)(et,{value:f,onValueChange:e=>g(e),max:31,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{className:"mb-2",children:N("employees.minMaxWeekdayShifts")}),(0,r.jsx)("div",{className:"px-3 mb-8",children:(0,r.jsx)(et,{value:v,onValueChange:e=>y(e),max:23,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{className:"mb-2",children:N("employees.minMaxWeekendShifts")}),(0,r.jsx)("div",{className:"px-3 mb-8",children:(0,r.jsx)(et,{value:b,onValueChange:e=>j(e),max:9,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{children:N("employees.tags")}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:l.map(e=>{let s=t.tags.includes(e);return(0,r.jsx)(p,{variant:s?"default":"outline",size:"sm",onClick:()=>c(t.id,e),children:N(e)},e)})})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(p,{onClick:()=>{d(t.id,{name:u,shiftsPerMonth:f,weekdayShifts:v,weekendShifts:b}),m()},size:"sm",children:N("employees.save")}),(0,r.jsx)(p,{onClick:m,variant:"outline",size:"sm",children:N("employees.cancel")}),(0,r.jsxs)(p,{onClick:()=>{o(t.id),m()},variant:"destructive",size:"sm",children:[(0,r.jsx)(H.A,{className:"w-4 h-4 mr-1"}),N("employees.delete")]})]})]}):(0,r.jsx)("div",{className:"p-3 cursor-pointer",onClick:()=>i(s?"":t.id),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:t.name}),(0,r.jsx)($,{variant:"secondary",children:t.shiftsPerMonth[0]===t.shiftsPerMonth[1]?"".concat(t.shiftsPerMonth[0]," ").concat(N("employees.shifts")):"".concat(t.shiftsPerMonth[0],"-").concat(t.shiftsPerMonth[1]," ").concat(N("employees.shifts"))})]}),t.tags.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:t.tags.map(e=>(0,r.jsx)($,{variant:"outline",className:"text-xs",children:N(e)},N(e)))}),s&&(0,r.jsx)("div",{className:"mt-2 text-xs text-blue-600",children:N("employees.selectedDescription")})]}),(0,r.jsx)(p,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),S()},children:N("employees.edit")})]})})})},er=e=>{let{employees:t,selectedEmployee:s,onEmployeeSelect:n,onAddEmployee:l,onRemoveEmployee:i,onUpdateEmployee:o,onToggleTag:d,predefinedTags:c,hasActiveSchedule:h}=e,[m,u]=(0,a.useState)(""),x=(0,q.c3)(),f=e=>{u(e.id)},g=()=>{u("")};return(0,r.jsxs)(S,{className:"flex flex-col min-h-[400px] max-h-[80vh]",children:[(0,r.jsxs)(w,{className:"flex-shrink-0",children:[(0,r.jsx)(k,{children:x("employees.title")}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:x(h?"employees.selectScheduleDescription":"employees.noActiveScheduleDescription")})]}),(0,r.jsx)(E,{className:"flex-1 flex flex-col overflow-hidden",children:h?0===t.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:x("employees.noEmployeesMessage")}),(0,r.jsxs)(p,{onClick:l,children:[(0,r.jsx)(O.A,{className:"w-4 h-4 mr-2"}),x("employees.addFirstEmployee")]})]}):(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,r.jsx)("div",{className:"flex-1 space-y-3 overflow-y-auto pr-2",children:t.map(e=>(0,r.jsx)(es,{employee:e,isSelected:s===e.id,isEditing:m===e.id,predefinedTags:c,onEmployeeSelect:n,onRemoveEmployee:i,onUpdateEmployee:o,onToggleTag:d,onStartEditing:f,onStopEditing:g},e.id))}),h&&(0,r.jsxs)(p,{onClick:l,variant:"outline",className:"w-full mt-3 flex-shrink-0",children:[(0,r.jsx)(O.A,{className:"w-4 h-4 mr-2"}),x("employees.addEmployee")]})]}):(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:x("employees.noActiveScheduleMessage")})})})]})},ea=e=>{var t;let{settings:s,onSettingsChange:a}=e,n=(0,q.c3)(),l=(e,t)=>{a({...s,[e]:t})};return(0,r.jsxs)(S,{children:[(0,r.jsxs)(w,{children:[(0,r.jsx)(k,{children:n("constraints.title")}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:n("constraints.description")})]}),(0,r.jsxs)(E,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{htmlFor:"shiftsPerDay",children:n("constraints.shiftsPerDay")}),(0,r.jsx)(X,{id:"shiftsPerDay",type:"number",min:"1",max:"3",value:s.shiftsPerDay,onChange:e=>{let t=Number.parseInt(e.target.value)||1,r=Array.from({length:t},(e,t)=>s.personsPerShift[t]||1),n=Array.from({length:t},(e,t)=>{var r;return(null==(r=s.shiftLabels)?void 0:r[t])||"Shift ".concat(t+1)});a({...s,shiftsPerDay:t,personsPerShift:r,shiftLabels:n})}}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.shiftsPerDayDescription")})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{children:n("constraints.personsPerShift")}),s.personsPerShift.map((e,t)=>{var a;return(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsxs)(Q,{className:"text-sm w-20",children:[(null==(a=s.shiftLabels)?void 0:a[t])||"Shift ".concat(t+1),":"]}),(0,r.jsx)(X,{type:"number",min:"1",max:"10",value:e,onChange:e=>{let r=[...s.personsPerShift];r[t]=Number.parseInt(e.target.value)||1,l("personsPerShift",r)},className:"w-20"})]},t)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.personsPerShiftDescription")})]}),s.shiftsPerDay>1&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{children:n("settings.shiftLabels")}),null==(t=s.shiftLabels)?void 0:t.map((e,t)=>(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsxs)(Q,{className:"text-sm w-20",children:[n("shiftPreferences.shiftLabel",{index:t+1}),":"]}),(0,r.jsx)(X,{type:"text",value:e,placeholder:n("settings.shiftLabelPlaceholder",{index:t+1}),onChange:e=>{let r=[...s.shiftLabels||[]];r[t]=e.target.value||"Shift ".concat(t+1),l("shiftLabels",r)},className:"flex-1"})]},t)),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("settings.customizeShiftNames")})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{htmlFor:"maxConsecutive",children:n("constraints.maxConsecutiveShifts")}),(0,r.jsx)(X,{id:"maxConsecutive",type:"number",min:"1",max:"7",value:s.maxConsecutiveShifts,onChange:e=>l("maxConsecutiveShifts",Number.parseInt(e.target.value)||1)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxConsecutiveShiftsDescription")})]})]}),(0,r.jsxs)("div",{className:"border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.restAndRecovery")}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{htmlFor:"minRestDays",children:n("constraints.minRestDaysBetweenShifts")}),(0,r.jsx)(X,{id:"minRestDays",type:"number",min:"0",max:"3",value:s.minRestDaysBetweenShifts,onChange:e=>l("minRestDaysBetweenShifts",Number.parseInt(e.target.value)||0)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.minRestDaysBetweenShiftsDescription")})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(Q,{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:s.weekendCoverageRequired,onChange:e=>l("weekendCoverageRequired",e.target.checked),className:"rounded"}),n("constraints.weekendCoverageRequired")]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.weekendCoverageRequiredDescription")})]})]})]}),(0,r.jsxs)("div",{className:"border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.weeklyLimits")}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{htmlFor:"minShiftsPerWeek",children:n("constraints.minShiftsPerWeek")}),(0,r.jsx)(X,{id:"minShiftsPerWeek",type:"number",min:"0",max:"7",value:s.minShiftsPerWeek,onChange:e=>l("minShiftsPerWeek",Number.parseInt(e.target.value)||0)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.minShiftsPerWeekDescription")})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(Q,{htmlFor:"maxShiftsPerWeek",children:n("constraints.maxShiftsPerWeek")}),(0,r.jsx)(X,{id:"maxShiftsPerWeek",type:"number",min:"1",max:"7",value:s.maxShiftsPerWeek,onChange:e=>l("maxShiftsPerWeek",Number.parseInt(e.target.value)||1)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxShiftsPerWeekDescription")})]})]})]}),(0,r.jsxs)("div",{className:"border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.fairnessAndDistribution")}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(Q,{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:s.evenDistribution,onChange:e=>l("evenDistribution",e.target.checked),className:"rounded"}),n("constraints.evenShiftDistribution")]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.evenShiftDistributionDescription")})]})})]}),(0,r.jsxs)("div",{className:"border-t pt-6 bg-muted/50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:n("constraints.constraintSummary")}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsxs)("strong",{children:[n("constraints.daily"),":"]})," ",s.shiftsPerDay," ",n("constraints.shifts"),","," ",s.personsPerShift," ",n("constraints.persons")," ",n("constraints.each")]}),(0,r.jsxs)("p",{children:[(0,r.jsxs)("strong",{children:[n("constraints.consecutive"),":"]})," ",n("constraints.max")," ",s.maxConsecutiveShifts," ",n("constraints.inARow")]}),(0,r.jsxs)("p",{children:[(0,r.jsxs)("strong",{children:[n("constraints.rest"),":"]})," ",s.minRestDaysBetweenShifts," ",n("constraints.dayMinimum")]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsxs)("strong",{children:[n("constraints.weekly"),":"]})," ",s.minShiftsPerWeek,"-",s.maxShiftsPerWeek," ",n("constraints.shiftsPerPerson")]}),(0,r.jsxs)("p",{children:[(0,r.jsxs)("strong",{children:[n("constraints.weekend"),":"]})," ",s.weekendCoverageRequired?n("constraints.required"):n("constraints.optional")]}),(0,r.jsxs)("p",{children:[(0,r.jsxs)("strong",{children:[n("constraints.distribution"),":"]})," ",s.evenDistribution?n("constraints.even"):n("constraints.flexible")]})]})]})]})]})]})};var en=s(4261),el=s(2118);let ei=(e,t,s,r,a,n)=>{let l=W(s,r),i="Date,Shift,Employee\n";for(let a=1;a<=l;a++){let l=e[a],o="".concat(r,"-").concat((s+1).toString().padStart(2,"0"),"-").concat(a.toString().padStart(2,"0"));(null==l?void 0:l.shifts)&&l.shifts.length>0?l.shifts.forEach((e,s)=>{var r;let a=(null==n||null==(r=n.shiftLabels)?void 0:r[s])||"Shift ".concat(s+1);e.employeeIds.length>0?e.employeeIds.forEach(e=>{let s=t.find(t=>t.id===e);i+="".concat(o,",").concat(a,",").concat((null==s?void 0:s.name)||"Unknown","\n")}):i+="".concat(o,",").concat(a,",No Assignment\n")}):i+="".concat(o,",No Shifts,No Assignment\n")}let o=new Blob([i],{type:"text/csv"}),d=window.URL.createObjectURL(o),c=document.createElement("a");c.href=d,c.download="schedule-".concat(V(s,a),"-").concat(r,".csv"),c.click(),window.URL.revokeObjectURL(d)},eo=(e,t,s,r,a,n)=>{let l=document.createElement("canvas"),i=l.getContext("2d");if(!i)return;let o=W(s,r),d=(null==n?void 0:n.shiftsPerDay)&&n.shiftsPerDay>1?60:40;l.width=980,l.height=60+Math.ceil(o/7)*d,i.fillStyle="#ffffff",i.fillRect(0,0,l.width,l.height),i.fillStyle="#000000",i.font="bold 24px Arial",i.textAlign="center",i.fillText("".concat(V(s,a)," ").concat(r," Schedule"),l.width/2,30),i.font="14px Arial",i.textAlign="left";for(let s=1;s<=o;s++){let r=Math.floor((s-1)/7),a=(s-1)%7*140,l=60+r*d;i.strokeStyle="#cccccc",i.strokeRect(a,l,140,d),i.fillStyle="#000000",i.fillText(s.toString(),a+5,l+20);let o=e[s];if((null==o?void 0:o.shifts)&&o.shifts.length>0){let e=35;o.shifts.forEach((s,r)=>{if(s.employeeIds.length>0){if((null==n?void 0:n.shiftsPerDay)&&n.shiftsPerDay>1){var l;let t=(null==(l=n.shiftLabels)?void 0:l[r])||"S".concat(r+1);i.fillStyle="#666666",i.font="10px Arial",i.fillText("".concat(t,":"),a+5,e),e+=12}s.employeeIds.slice(0,2).forEach(s=>{let r=t.find(e=>e.id===s);i.fillStyle="#0066cc",i.font="10px Arial";let n=(null==r?void 0:r.name)||"Unknown",l=n.length>12?n.substring(0,10)+"...":n;i.fillText(l,a+5,e),e+=10}),s.employeeIds.length>2&&(i.fillStyle="#888888",i.font="8px Arial",i.fillText("+".concat(s.employeeIds.length-2," more"),a+5,e),e+=10)}})}}l.toBlob(e=>{if(e){let t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="schedule-".concat(V(s,a),"-").concat(r,".png"),n.click(),window.URL.revokeObjectURL(t)}})},ed=e=>{var t;let{schedule:s,employees:n,selectedMonth:l,selectedYear:i,hasActiveSchedule:o,constraints:d=[],selectedEmployee:c,settings:h,onSetConstraint:m,onRemoveConstraint:u,onGenerateSchedule:x,isGenerating:f=!1}=e,[g,v]=(0,a.useState)(!1),y=(0,a.useRef)(null),b=(0,q.c3)();(0,a.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&v(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let j=(e,t)=>{if(!c||!m||!u)return;let s=d.find(s=>s.employeeId===c&&s.date===e&&"shiftIndex"in s&&s.shiftIndex===t);s?"prefer"===s.type?m(c,"avoid",e,t):"avoid"===s.type&&u(c,e,t):m(c,"prefer",e,t)},N=e=>{if(!c||!m||!u)return;let t=d.filter(t=>t.employeeId===c&&t.date===e),s=null;(s=0===t.length?"prefer":t.every(e=>"prefer"===e.type)?"avoid":null)?m(c,s,e):u(c,e)};return(0,r.jsxs)(S,{children:[(0,r.jsx)(w,{children:(0,r.jsxs)(k,{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!o&&b("schedule.title"),o&&b("schedule.monthSchedule",{month:V(l,b),year:i}),c&&(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[b("schedule.settingPreferencesFor")," ",(0,r.jsx)("strong",{children:null==(t=n.find(e=>e.id===c))?void 0:t.name})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[x&&(0,r.jsx)(p,{onClick:x,disabled:0===n.length||f,size:"sm",children:f?b("schedule.generating"):b("schedule.generateButton")}),Object.keys(s).length>0&&(0,r.jsxs)("div",{className:"relative",ref:y,children:[(0,r.jsxs)(p,{variant:"outline",size:"sm",onClick:()=>v(!g),className:"flex items-center gap-2",children:[b("schedule.export"),(0,r.jsx)(P.A,{className:"w-4 h-4"})]}),g&&(0,r.jsxs)("div",{className:"absolute right-0 top-full mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[(0,r.jsxs)("button",{onClick:()=>{if(0===Object.keys(s).length)return void G.oR.error(b("toast.noSchedule"),{description:b("toast.pleaseGenerateFirst")});try{ei(s,n,l,i,b,h),G.oR.success(b("toast.csvExported"),{description:b("toast.csvExportedDescription")})}catch(e){G.oR.error(b("toast.exportFailed"),{description:b("toast.csvExportFailedDescription")})}v(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(en.A,{className:"w-4 h-4"}),b("schedule.exportCSV")]}),(0,r.jsxs)("button",{onClick:()=>{if(0===Object.keys(s).length)return void G.oR.error(b("toast.noSchedule"),{description:b("toast.pleaseGenerateFirst")});try{eo(s,n,l,i,b,h),G.oR.success(b("toast.imageExported"),{description:b("toast.imageExportedDescription")})}catch(e){G.oR.error(b("toast.exportFailed"),{description:b("toast.imageExportFailedDescription")})}v(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(el.A,{className:"w-4 h-4"}),b("schedule.exportImage")]})]})]})]})]})}),(0,r.jsxs)(E,{children:[!o&&(0,r.jsx)("p",{className:"text-muted-foreground",children:b("schedule.noActiveSchedule")}),o&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:(0,r.jsxs)("div",{className:"grid grid-cols-7",children:[[b("days.0"),b("days.1"),b("days.2"),b("days.3"),b("days.4"),b("days.5"),b("days.6")].map(e=>(0,r.jsx)("div",{className:"p-3 text-center font-medium bg-muted border-r border-b border-gray-200 last:border-r-0",children:e},e)),(()=>{if(!l||!i)return null;let e=B(l,i),t=W(l,i),a=[];for(let s=0;s<e;s++){let n="p-2 min-h-20 border-gray-200 ";(s+1)%7!=0&&(n+="border-r "),s>=7*Math.floor((e+t)/7)||(n+="border-b "),a.push((0,r.jsx)("div",{className:n},"empty-".concat(s)))}for(let l=1;l<=t;l++){let i=s[l],o=c?d.filter(e=>e.employeeId===c&&e.date===l&&"shiftIndex"in e):[],m=null;if(o.length>0){let e=o.every(e=>"prefer"===e.type),t=o.every(e=>"avoid"===e.type);e?m="prefer":t&&(m="avoid")}let u=e+t,x=e+l-1,f="p-1 min-h-24 border-gray-200 ";(x+1)%7!=0&&(f+="border-r "),x>=7*Math.floor(u/7)||(f+="border-b "),c&&(f+="transition-colors "),a.push((0,r.jsxs)("div",{className:f,children:[(0,r.jsxs)("div",{className:"text-sm font-medium mb-1 flex justify-between items-center",children:[(0,r.jsx)("span",{children:l}),c&&m&&(0,r.jsxs)("span",{className:"text-xs px-1 rounded ".concat("prefer"===m?"bg-green-200 text-green-800":"bg-red-200 text-red-800"),children:["Day ","prefer"===m?"✓":"✗"]})]}),(0,r.jsx)("div",{className:"space-y-0.5",children:Array.from({length:h.shiftsPerDay},(e,t)=>{var s,a;let o=null==i||null==(s=i.shifts)?void 0:s[t],m=(null==o?void 0:o.employeeIds)||[],u=(null==(a=h.shiftLabels)?void 0:a[t])||"Shift ".concat(t+1),x=c?d.find(e=>e.employeeId===c&&e.date===l&&"shiftIndex"in e&&e.shiftIndex===t):null,f=c&&m.includes(c),p="text-xs p-1 rounded border min-h-6 cursor-pointer transition-colors ";return c?f?(null==x?void 0:x.type)==="prefer"?p+="bg-green-200 hover:bg-green-300 border-green-400 text-green-800 ":(null==x?void 0:x.type)==="avoid"?p+="bg-red-200 hover:bg-red-300 border-red-400 text-red-800 ":p+="bg-blue-100 hover:bg-blue-200 border-blue-400 text-blue-800 ":(null==x?void 0:x.type)==="prefer"?p+="bg-green-50 hover:bg-green-100 border-green-200 text-green-700 ":(null==x?void 0:x.type)==="avoid"?p+="bg-red-50 hover:bg-red-100 border-red-200 text-red-700 ":p+="hover:bg-blue-25 border-gray-200 ":p+="border-gray-200 ",(0,r.jsxs)("div",{className:p,onClick:()=>c&&j(l,t),title:"".concat(u," - Click to set preference"),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-0.5",children:[(0,r.jsx)("span",{className:"font-medium text-[10px] text-gray-600",children:h.shiftsPerDay>1?u.split(" ")[1]||u:""}),x&&(0,r.jsx)("span",{className:"text-[8px] px-0.5 rounded ".concat("prefer"===x.type?"bg-green-300 text-green-900":"bg-red-300 text-red-900"),children:"prefer"===x.type?"✓":"✗"})]}),(0,r.jsxs)("div",{className:"space-y-0.5",children:[m.map(e=>{let s=n.find(t=>t.id===e),a=c===e;return(0,r.jsx)("div",{className:"text-[10px] truncate ".concat(a?"font-bold":""),title:null==s?void 0:s.name,children:null==s?void 0:s.name},"".concat(e,"-").concat(l,"-").concat(t))}),0===m.length&&(0,r.jsx)("div",{className:"text-[10px] text-gray-400 italic",children:"Unassigned"})]})]},"".concat(l,"-shift-").concat(t))})}),c&&h.shiftsPerDay>1&&(0,r.jsx)("button",{onClick:()=>N(l),className:"mt-1 w-full text-[10px] py-0.5 px-1 rounded border transition-colors ".concat("prefer"===m?"bg-green-100 border-green-300 text-green-700 hover:bg-green-200":"avoid"===m?"bg-red-100 border-red-300 text-red-700 hover:bg-red-200":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),title:"Set preference for all shifts on this day",children:m?"All shifts: ".concat(m):"Set all shifts"})]},l))}return a})()]})}),c&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-blue-800 mb-2",children:h.shiftsPerDay>1?b("shiftPreferences.clickShiftToSet"):b("schedule.clickToSetPreferences")}),(0,r.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-green-100 border border-green-300 rounded"}),(0,r.jsx)("span",{children:h.shiftsPerDay>1?b("shiftPreferences.preferredShifts"):b("schedule.preferredDays")})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-red-100 border border-red-300 rounded"}),(0,r.jsx)("span",{children:h.shiftsPerDay>1?b("shiftPreferences.avoidShifts"):b("schedule.avoidDays")})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-white border border-gray-300 rounded"}),(0,r.jsx)("span",{children:h.shiftsPerDay>1?b("shiftPreferences.normalShifts"):b("schedule.normalDays")})]}),h.shiftsPerDay>1&&(0,r.jsx)("div",{className:"mt-2 pt-2 border-t border-blue-200",children:(0,r.jsx)("div",{className:"text-xs text-blue-700",children:b("shiftPreferences.shiftSpecific")})})]})]})]})]})]})};var ec=s(143),eh=s(4869);let em={en:{name:"English",flag:"\uD83C\uDDFA\uD83C\uDDF8"},"zh-TW":{name:"繁體中文",flag:"\uD83C\uDDF9\uD83C\uDDFC"}};function eu(){let{locale:e,setLocale:t}=(0,ec.Y)();return(0,r.jsxs)(A,{value:e,onValueChange:e=>{t(e)},children:[(0,r.jsx)(M,{className:"w-10 h-10 p-0 border-none hover:bg-muted/50 rounded-md",children:(0,r.jsx)(R,{children:(0,r.jsx)(eh.A,{className:"h-5 w-5"})})}),(0,r.jsxs)(T,{children:[(0,r.jsx)(z,{value:"en",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:em.en.flag}),(0,r.jsx)("span",{children:em.en.name})]})}),(0,r.jsx)(z,{value:"zh-TW",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:em["zh-TW"].flag}),(0,r.jsx)("span",{children:em["zh-TW"].name})]})})]})]})}var ex=s(1368);let ef={shiftsPerDay:1,personsPerShift:[1],maxConsecutiveShifts:3,minRestDaysBetweenShifts:0,weekendCoverageRequired:!0,maxShiftsPerWeek:5,minShiftsPerWeek:1,evenDistribution:!0,shiftLabels:["Shift 1"]},ep=()=>{let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)(null),[n,l]=(0,a.useState)(ef),[i,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{d(),o(!0)},[]),(0,a.useEffect)(()=>{!1!==i&&localStorage.setItem("scheduleData",JSON.stringify({schedules:e,settings:n}))},[e,n,i]);let d=()=>{let e=localStorage.getItem("scheduleData");if(e)try{let s=JSON.parse(e);t((s.schedules||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))),l({...ef,...s.settings})}catch(e){console.error("Error loading from localStorage:",e)}},c=(e,s)=>{t(t=>t.map(t=>t.id===e?{...t,...s}:t))},h=()=>e.find(e=>e.id===s)||null,m=h(),u=(null==m?void 0:m.month)||0,x=(null==m?void 0:m.year)||0,f=(null==m?void 0:m.employees)||[],p=(null==m?void 0:m.constraints)||[];return{schedules:e,activeScheduleId:s,setActiveScheduleId:r,addSchedule:(s,a,n)=>{if(e.some(e=>e.month===s&&e.year===a))throw Error("Schedule for ".concat(s,"/").concat(a," already exists"));let l=[];if(n){let t=e.find(e=>e.id===n);t&&t.employees.length>0&&(l=t.employees.map(e=>({...e,id:(0,ex.A)()})))}let i={id:(0,ex.A)(),month:s,year:a,employees:l,constraints:[],schedule:{},createdAt:new Date,isGenerated:!1};return t(e=>[...e,i]),r(i.id),i.id},deleteSchedule:e=>{t(t=>t.filter(t=>t.id!==e)),s===e&&r(null)},updateSchedule:c,getActiveSchedule:h,selectedMonth:u,selectedYear:x,employees:f,setEmployees:e=>{s&&c(s,{employees:e})},constraints:p,setConstraints:e=>{s&&c(s,{constraints:e})},schedule:(null==m?void 0:m.schedule)||{},setSchedule:e=>{s&&c(s,{schedule:e,isGenerated:Object.keys(e).length>0})},settings:n,setSettings:l}},eg=(e,t,s,r,a,n,l)=>({addEmployee:()=>{let s=l?l("employees.newEmployee"):"New Employee",r=(e.length+1).toString().padStart(3,"0"),a={id:(0,ex.A)(),name:"".concat(s," ").concat(r),shiftsPerMonth:[4,8],weekdayShifts:[0,8],weekendShifts:[0,8],tags:[]};t([...e,a]),l?G.oR.success(l("toast.employeeAdded"),{description:l("toast.employeeAddedDescription",{name:a.name})}):G.oR.success("Employee added",{description:"".concat(a.name," has been added to the schedule.")})},removeEmployee:l=>{t(e.filter(e=>e.id!==l)),r(s.filter(e=>e.employeeId!==l));let i={...a};Object.keys(i).forEach(e=>{let t=i[Number.parseInt(e)];t&&t.shifts&&(t.shifts=t.shifts.map(e=>({...e,employeeIds:e.employeeIds.filter(e=>e!==l)})))}),n(i)},updateEmployee:(s,r)=>{t(e.map(e=>e.id===s?{...e,...r}:e)),l?G.oR.success(l("toast.employeeUpdated"),{description:l("toast.employeeUpdatedDescription")}):G.oR.success("Employee updated",{description:"Employee information has been saved."})},toggleEmployeeTag:(s,r)=>{t(e.map(e=>{if(e.id===s){let t=e.tags.includes(r);return{...e,tags:t?e.tags.filter(e=>e!==r):[...e.tags,r]}}return e}))}}),ev=(e,t)=>({getConstraintsForEmployee:t=>e.filter(e=>e.employeeId===t),getShiftConstraint:(t,s,r)=>e.find(e=>e.employeeId===t&&e.date===s&&e.shiftIndex===r),removeConstraint:(s,r,a)=>{t(e.filter(e=>e.employeeId!==s||e.date!==r||void 0!==a&&e.shiftIndex!==a))},setShiftConstraint:(s,r,a,n)=>{t([...e.filter(e=>e.employeeId!==s||e.date!==a||e.shiftIndex!==n),{id:(0,ex.A)(),employeeId:s,type:r,date:a,shiftIndex:n}])},setAllShiftsConstraint:(s,r,a,n)=>{t([...e.filter(e=>e.employeeId!==s||e.date!==a),...Array.from({length:n},(e,t)=>({id:(0,ex.A)(),employeeId:s,type:r,date:a,shiftIndex:t}))])}}),ey=(e,t)=>e*t.personsPerShift.reduce((e,t)=>e+t,0);var eb=s(2764),ej=s.n(eb);let eN=e=>Math.floor(Math.random()*e),eS=(e,t,s,r)=>{let a=ey(r,s);if(e.length<a)throw Error("Not enough slots in optimized schedule");let n={},l=0;for(let a=1;a<=r;a++){n[a]={shifts:[]};for(let r=0;r<s.shiftsPerDay;r++){let i=[],o=s.personsPerShift[r];for(let s=0;s<o;s++){let s=e[l];if(s>=0&&s<t.length)i.push(t[s].id);else throw Error("Invalid employee index ".concat(s," in optimized schedule"));l++}n[a].shifts.push({employeeIds:i})}}return n},ew=e=>{let t=[];e.forEach((e,s)=>{for(let r=0;r<e.shiftsPerMonth[1];r++)t.push(s)});for(let e=t.length-1;e>0;e--){let s=eN(e+1);[t[e],t[s]]=[t[s],t[e]]}return t},ek=(e,t,s,r,a,n,l)=>{let i=0,o=ey(a,r),d={AVOID_VIOLATION:1e3,DUPLICATE_PERSON_IN_SHIFT:2e3,CONSECUTIVE:100,WEEKLY_LIMIT:100,UNEVEN_DISTRIBUTION:50,MISSED_PREFERENCE:10,REST_DAYS:80,HOLIDAY_DISTRIBUTION:1e3,WEEKEND_CONSECUTIVE:50,MIN_SHIFTS:200,MAX_SHIFTS:200},c=Array(t.length).fill(0),h=t.map(()=>({current:0,max:0})),m=Array(t.length).fill(0),u=Array(t.length).fill(0),x=t.map(()=>({current:0,max:0})),f=e.slice(0,o);if(f.length<o)throw Error("Optimized schedule does not have enough slots: expected ".concat(o,", got ").concat(f.length));f.forEach(e=>{if(e<-1||e>=t.length)throw Error("Invalid employee index ".concat(e," in optimized schedule"))});for(let e=0;e<a;e++){let a=e+1,o=eE(a,r),p=f.slice(o.start,o.end);for(let e=0;e<r.shiftsPerDay;e++){let t=eD(a,e,r);new Set(f.slice(t.start,t.end)).size<r.personsPerShift[e]&&(i+=d.DUPLICATE_PERSON_IN_SHIFT)}let g=Y(a,n,l);s.forEach(e=>{if(e.date===a){let s=t.findIndex(t=>t.id===e.employeeId);if(-1===s)return;let n=eD(a,e.shiftIndex,r),l=f.slice(n.start,n.end);"avoid"===e.type&&l.includes(s)&&(i+=d.AVOID_VIOLATION),"prefer"!==e.type||l.includes(s)||(i+=d.MISSED_PREFERENCE)}});let v=[...new Set(p)];v.forEach(s=>{var a;if(c[s]++,g?m[s]++:u[s]++,e>0){let t=eE(e,r),a=!1;for(let e=t.start;e<t.end;e++)if(f[e]===s){a=!0;break}a?h[s].current++:h[s].current=1}else h[s].current=1;if(h[s].max=Math.max(h[s].max,h[s].current),g&&(null==(a=t[s])?void 0:a.tags.includes("tags.weekendType"))){if(e>0){let t=Y(e,n,l),a=eE(e,r),i=!1;if(t){for(let e=a.start;e<Math.min(a.end,f.length);e++)if(f[e]===s){i=!0;break}}i?x[s].current++:x[s].current=1}else x[s].current=1;x[s].max=Math.max(x[s].max,x[s].current)}else x[s].current=0}),t.forEach((e,t)=>{v.includes(t)||(h[t].current=0,x[t].current=0)})}t.forEach((e,t)=>{let s=0;h[t].max>r.maxConsecutiveShifts&&(s+=(h[t].max-r.maxConsecutiveShifts)*d.CONSECUTIVE),e.tags.includes("tags.weekendType")&&(x[t].max>=2?s=0:s+=d.WEEKEND_CONSECUTIVE),i+=s});for(let e=0;e<Math.ceil(a/7);e++){let s=7*e,n=Math.min(s+6,a-1);t.forEach((e,t)=>{let a=0,l=[];for(let e=s;e<=n;e++){let s=eE(e+1,r),n=!1;for(let e=s.start;e<s.end&&e<f.length;e++)if(f[e]===t){n=!0;break}n&&(a++,l.push(e))}a>r.maxShiftsPerWeek&&(i+=(a-r.maxShiftsPerWeek)*d.WEEKLY_LIMIT);for(let e=0;e<l.length-1;e++){let t=l[e+1]-l[e]-1;t<r.minRestDaysBetweenShifts&&(i+=(r.minRestDaysBetweenShifts-t)*d.REST_DAYS)}})}if(t.forEach((e,t)=>{let s=c[t];s<e.shiftsPerMonth[0]&&(i+=(e.shiftsPerMonth[0]-s)*d.MIN_SHIFTS),s>e.shiftsPerMonth[1]&&(i+=(s-e.shiftsPerMonth[1])*d.MAX_SHIFTS)}),r.evenDistribution){let e=c.reduce((e,t)=>e+t,0)/c.length,t=c.reduce((t,s)=>t+Math.pow(s-e,2),0)/c.length;i+=t*d.UNEVEN_DISTRIBUTION}let p=m.reduce((e,t)=>e+t,0),g=u.reduce((e,t)=>e+t,0);return p>0&&g>0&&t.forEach((e,t)=>{let s=c[t];if(s>0){let e=Math.abs(m[t]/s-p/(p+g));m[t]>0&&0===u[t]&&s>1?i+=2*d.HOLIDAY_DISTRIBUTION:u[t]>0&&0===m[t]&&s>1?i+=d.HOLIDAY_DISTRIBUTION:e>.3&&(i+=e*d.HOLIDAY_DISTRIBUTION)}}),console.log("Cost calculated: ".concat(i)),i},eE=(e,t)=>{let s=t.personsPerShift.reduce((e,t)=>e+t,0);return{start:(e-1)*s,end:e*s}},eD=(e,t,s)=>{let r=eE(e,s).start;for(let e=0;e<t;e++)r+=s.personsPerShift[e];return{start:r,end:r+s.personsPerShift[t]}},eP=e=>{let t=[...e];if(t.length<2)return t;let s=["swap","move","reverse","transport"],r=s[eN(s.length)],a=eN(t.length),n=eN(t.length);switch(r){case"swap":[t[a],t[n]]=[t[n],t[a]];break;case"move":{let e=t.splice(a,1)[0];t.splice(n,0,e);break}case"reverse":{let e=Math.min(a,n),s=Math.max(a,n);for(;e<s;)[t[e],t[s]]=[t[s],t[e]],e++,s--;break}case"transport":{if(t.length<3)break;let e=Math.min(a,n),s=Math.max(a,n);if(e<s){let r=t.splice(e,s-e+1),a=eN(t.length);t.splice(a,0,...r)}}}return t},eI=(e,t,s,r,a)=>{if(0===e.length)return{schedule:{},success:!1,message:"Please add employees before generating a schedule."};let n=W(r,a),l=ey(n,s),i=e.reduce((e,t)=>e+t.shiftsPerMonth[0],0),o=e.reduce((e,t)=>e+t.shiftsPerMonth[1],0);if(o<l)return{schedule:{},success:!1,message:"Not enough maximum shifts available (".concat(o,") to cover all required shifts (").concat(l,")")};if(i>l)return{schedule:{},success:!1,message:"Minimum shifts required (".concat(i,") exceed total shifts needed (").concat(l,")")};let d=ew(e);try{console.log("Starting optimized simulated annealing with ".concat(e.length," employees, ").concat(n," days"));let l=Date.now(),i=ej()({initialState:d,tempMax:1e3,tempMin:.1,newState:e=>eP(e),getTemp:e=>.99*e,getEnergy:l=>ek(l,e,t,s,n,r,a)}),o=Date.now();console.log("Simulated annealing completed in ".concat(o-l,"ms"));let c=eS(i,e,s,n),h=ek(i,e,t,s,n,r,a),m=0===h?"Perfect schedule generated with all constraints satisfied!":"Schedule generated with optimization score: ".concat(Math.round(Math.max(0,h)));return{schedule:c,success:!0,message:m}}catch(e){return console.error("Simulated annealing failed:",e),{schedule:{},success:!1,message:"Simulated annealing failed."}}},eC=()=>{let[e,t]=(0,a.useState)(!1);return{isGenerating:e,handleGenerateSchedule:async(e,s,r,a,n,l)=>{t(!0);try{await new Promise(e=>setTimeout(e,500));let t=eI(e,s,r,a,n);t.success?(l(t.schedule),G.oR.success("Schedule generated",{description:t.message})):G.oR.error("Generation failed",{description:t.message})}catch(e){G.oR.error("Generation error",{description:"An unexpected error occurred while generating the schedule."})}finally{t(!1)}}}},eA=()=>{let[e,t]=(0,a.useState)(!1),s=(0,a.useCallback)(()=>{t(e=>!e)},[]);return(0,a.useEffect)(()=>{let e=e=>{e.ctrlKey&&"b"===e.key&&(e.preventDefault(),s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),{isEmployeePanelCollapsed:e,toggleEmployeePanel:s}};function eR(){let e=(0,q.c3)(),{schedules:t,activeScheduleId:s,setActiveScheduleId:n,addSchedule:l,deleteSchedule:i,selectedMonth:u,selectedYear:x,employees:f,setEmployees:S,constraints:w,setConstraints:k,schedule:E,setSchedule:D,settings:P,setSettings:I}=ep(),{addEmployee:C,removeEmployee:A,updateEmployee:R,toggleEmployeeTag:M}=eg(f,S,w,k,E,D,e),{removeConstraint:T,setShiftConstraint:z,setAllShiftsConstraint:L}=ev(w,k),{isGenerating:_,handleGenerateSchedule:O}=eC(),{isEmployeePanelCollapsed:F,toggleEmployeePanel:U}=eA(),[H,W]=(0,a.useState)("");return(0,r.jsx)("div",{children:(0,r.jsxs)(d,{defaultValue:"about",className:"space-y-0",children:[(0,r.jsx)(c,{className:"w-full",children:(0,r.jsxs)("div",{className:"w-full flex justify-between items-center px-6",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsxs)(h,{value:"about",className:"flex items-center gap-2",children:[(0,r.jsx)(g.A,{className:"w-4 h-4"}),"About"]}),(0,r.jsxs)(h,{value:"setup",className:"flex items-center gap-2",children:[(0,r.jsx)(v.A,{className:"w-4 h-4"}),e("page.setup")]}),(0,r.jsxs)(h,{value:"constraints",className:"flex items-center gap-2",children:[(0,r.jsx)(y.A,{className:"w-4 h-4"}),e("page.constraints")]})]}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)(eu,{})})]})}),(0,r.jsx)(m,{value:"about",className:"mt-0",children:(0,r.jsx)("div",{className:"container mx-auto p-6 max-w-6xl",children:(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"text-center max-w-3xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-4",children:e("page.title")}),(0,r.jsx)("p",{className:"text-lg text-muted-foreground leading-relaxed",children:e("page.description")})]})})})}),(0,r.jsx)(m,{value:"setup",className:"mt-0",children:(0,r.jsx)("div",{className:"container mx-auto p-6 transition-all duration-300 max-w-none",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(K,{schedules:t,activeScheduleId:s,onScheduleSelect:n,onScheduleAdd:l,onScheduleDelete:i}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(p,{variant:"outline",size:"sm",onClick:U,className:"mb-4 shadow-sm hover:shadow-md transition-all",title:F?"Show employee panel (Ctrl+B)":"Hide employee panel (Ctrl+B)",children:F?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.A,{className:"w-4 h-4 mr-2"}),(0,r.jsx)(j.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"ml-1",children:e("employees.showEmployees")})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.A,{className:"w-4 h-4 mr-2"}),(0,r.jsx)("span",{children:e("employees.hideEmployees")})]})}),(0,r.jsxs)("div",{className:o("transition-all duration-300 ease-in-out",F?"grid grid-cols-1 gap-6":"grid grid-cols-1 xl:grid-cols-5 gap-6"),children:[!F&&(0,r.jsx)("div",{className:"transition-all duration-300",children:(0,r.jsx)(er,{employees:f,selectedEmployee:H,onEmployeeSelect:W,onAddEmployee:C,onRemoveEmployee:A,onUpdateEmployee:R,onToggleTag:M,predefinedTags:["tags.weekendType","tags.rookie","tags.veteran"],hasActiveSchedule:null!==s})}),(0,r.jsx)("div",{className:o("transition-all duration-300",F?"col-span-2":"xl:col-span-4"),children:(0,r.jsx)(ed,{schedule:E,employees:f,selectedMonth:u,selectedYear:x,hasActiveSchedule:null!==s,constraints:w,selectedEmployee:H,settings:P,onSetConstraint:(e,t,s,r)=>{void 0===r?L(e,t,s,P.shiftsPerDay):z(e,t,s,r)},onRemoveConstraint:T,onGenerateSchedule:()=>{O(f,w,P,u,x,D)},isGenerating:_})})]})]})]})})}),(0,r.jsx)(m,{value:"constraints",className:"mt-0",children:(0,r.jsx)("div",{className:"container mx-auto p-6 max-w-6xl",children:(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsx)(ea,{settings:P,onSettingsChange:I})})})})]})})}},9848:(e,t,s)=>{Promise.resolve().then(s.bind(s,7308))}},e=>{var t=t=>e(e.s=t);e.O(0,[208,46,441,684,358],()=>t(9848)),_N_E=e.O()}]);