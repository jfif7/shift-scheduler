(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{143:(e,t,s)=>{"use strict";s.d(t,{LocaleProvider:()=>l,Y:()=>o});var i=s(5155),a=s(2115),n=s(6096);let r=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[l,o]=(0,a.useState)("en"),[c,d]=(0,a.useState)(null);return((0,a.useEffect)(()=>{let e=localStorage.getItem("locale");e&&("en"===e||"zh-TW"===e)&&o(e)},[]),(0,a.useEffect)(()=>{(async()=>{try{let e=await s(5272)("./".concat(l,".json"));d(e.default)}catch(e){console.error("Failed to load messages:",e)}})()},[l]),c)?(0,i.jsx)(r.Provider,{value:{locale:l,setLocale:e=>{o(e),localStorage.setItem("locale",e)}},children:(0,i.jsx)(n.A,{locale:l,messages:c,children:t})}):(0,i.jsx)("div",{children:"Loading..."})}function o(){let e=(0,a.useContext)(r);if(void 0===e)throw Error("useLocale must be used within a LocaleProvider");return e}},5272:(e,t,s)=>{var i={"./en.json":[9373,373],"./zh-TW.json":[9032,32]};function a(e){if(!s.o(i,e))return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],a=t[0];return s.e(t[1]).then(()=>s.t(a,19))}a.keys=()=>Object.keys(i),a.id=5272,e.exports=a},9848:(e,t,s)=>{Promise.resolve().then(s.bind(s,9886))},9886:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eq});var i=s(5155),a=s(2115),n=s(2473),r=s(2596),l=s(9688);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,r.$)(t))}function c(e){let{className:t,...s}=e;return(0,i.jsx)(n.bL,{"data-slot":"tabs",className:o("flex flex-col gap-2",t),...s})}function d(e){let{className:t,...s}=e;return(0,i.jsx)(n.B8,{"data-slot":"tabs-list",className:o("bg-background text-muted-foreground w-full border-b shadow-sm",t),...s})}function h(e){let{className:t,...s}=e;return(0,i.jsx)(n.l9,{"data-slot":"tabs-trigger",className:o("data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-muted-foreground inline-flex h-14 items-center justify-center gap-2 px-8 py-4 text-sm font-medium whitespace-nowrap transition-all hover:text-foreground hover:bg-muted/80 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 relative after:absolute after:bottom-0 after:left-0 after:right-0 after:h-1 after:bg-transparent data-[state=active]:after:bg-primary",t),...s})}function m(e){let{className:t,...s}=e;return(0,i.jsx)(n.UC,{"data-slot":"tabs-content",className:o("flex-1 outline-none",t),...s})}var u=s(9708),f=s(2085);let x=(0,f.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function p(e){let{className:t,variant:s,size:a,asChild:n=!1,...r}=e,l=n?u.DX:"button";return(0,i.jsx)(l,{"data-slot":"button",className:o(x({variant:s,size:a,className:t})),...r})}var g=s(1284),v=s(9074),y=s(381),j=s(7580),b=s(3052),S=s(2355);function N(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card",className:o("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function w(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card-header",className:o("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function E(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card-title",className:o("leading-none font-semibold",t),...s})}function D(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"card-content",className:o("px-6",t),...s})}var k=s(1522),P=s(6474),C=s(5196),I=s(7863);function A(e){let{...t}=e;return(0,i.jsx)(k.bL,{"data-slot":"select",...t})}function T(e){let{...t}=e;return(0,i.jsx)(k.WT,{"data-slot":"select-value",...t})}function _(e){let{className:t,size:s="default",children:a,...n}=e;return(0,i.jsxs)(k.l9,{"data-slot":"select-trigger","data-size":s,className:o("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[a,(0,i.jsx)(k.In,{asChild:!0,children:(0,i.jsx)(P.A,{className:"size-4 opacity-50"})})]})}function M(e){let{className:t,children:s,position:a="popper",...n}=e;return(0,i.jsx)(k.ZL,{children:(0,i.jsxs)(k.UC,{"data-slot":"select-content",className:o("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...n,children:[(0,i.jsx)(O,{}),(0,i.jsx)(k.LM,{className:o("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,i.jsx)(z,{})]})})}function R(e){let{className:t,children:s,...a}=e;return(0,i.jsxs)(k.q7,{"data-slot":"select-item",className:o("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...a,children:[(0,i.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,i.jsx)(k.VF,{children:(0,i.jsx)(C.A,{className:"size-4"})})}),(0,i.jsx)(k.p4,{children:s})]})}function O(e){let{className:t,...s}=e;return(0,i.jsx)(k.PP,{"data-slot":"select-scroll-up-button",className:o("flex cursor-default items-center justify-center py-1",t),...s,children:(0,i.jsx)(I.A,{className:"size-4"})})}function z(e){let{className:t,...s}=e;return(0,i.jsx)(k.wn,{"data-slot":"select-scroll-down-button",className:o("flex cursor-default items-center justify-center py-1",t),...s,children:(0,i.jsx)(P.A,{className:"size-4"})})}var F=s(4616),L=s(646),U=s(9428),H=s(2525);let V=(e,t)=>e<0||e>11||!t?0:new Date(t,e+1,0).getDate(),W=(e,t)=>e<0||e>11?"":t("months.".concat(e))||"",Y=(e,t)=>new Date(t,e,1).getDay(),B=(e,t,s)=>{let i=new Date(s,t,e).getDay();return 0===i||6===i};var G=s(6671),K=s(7652);let q=e=>{let{schedules:t,activeScheduleId:s,onScheduleSelect:n,onScheduleAdd:r,onScheduleDelete:l}=e,[o,c]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),[m,u]=(0,a.useState)(null),[f,x]=(0,a.useState)("auto"),g=(0,K.c3)(),y=s&&!o,j=new Date,b=j.getMonth(),S=j.getFullYear(),k=()=>{if(0===t.length)return null;let e=t[0];for(let s=1;s<t.length;s++){let i=t[s];(i.year>e.year||i.year===e.year&&i.month>e.month)&&(e=i)}return e},P=()=>{let e=k();if(!e)return{month:b,year:S};let t=new Date(e.year,e.month),s=new Date(t.getFullYear(),t.getMonth()+1);return{month:s.getMonth(),year:s.getFullYear()}},C=(e,t,s)=>{l(e),G.oR.success(g("toast.scheduleDeleted"),{description:g("toast.scheduleDeletedDescription",{month:W(t,g),year:s})})},I=[...t].sort((e,t)=>t.year-e.year||t.month-e.month),O=Array.from({length:12},(e,t)=>({value:t.toString(),label:g("months.".concat(t))})),z=Array.from({length:10},(e,t)=>{let s=j.getFullYear()-2+t;return{value:s.toString(),label:s.toString()}});return(0,i.jsxs)(N,{children:[(0,i.jsxs)(w,{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(E,{className:"flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"w-5 h-5"}),g("scheduleHistory.title"),y&&s&&(0,i.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["-"," ",(()=>{let e=t.find(e=>e.id===s);return e?"".concat(W(e.month,g)," ").concat(e.year):""})()]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[y&&(0,i.jsx)(p,{variant:"ghost",size:"sm",onClick:()=>n(null),className:"flex items-center gap-2",children:g("scheduleHistory.showAll")}),(0,i.jsxs)(p,{onClick:()=>{let{month:e,year:t}=P();c(!0),h(e),u(t),x("auto")},size:"sm",className:"flex items-center gap-2",children:[(0,i.jsx)(F.A,{className:"w-4 h-4"}),g("scheduleHistory.addSchedule")]})]})]}),0===t.length&&(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:g("scheduleHistory.noSchedulesYet")})]}),!y&&(0,i.jsxs)(D,{className:"space-y-4",children:[o&&(0,i.jsxs)("div",{className:"p-4 border rounded-lg bg-muted/50 space-y-4",children:[(0,i.jsx)("h4",{className:"font-medium",children:g("scheduleHistory.createNewSchedule")}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:g("scheduleHistory.month")}),(0,i.jsxs)(A,{value:(null==d?void 0:d.toString())||"",onValueChange:e=>h(parseInt(e)),children:[(0,i.jsx)(_,{children:(0,i.jsx)(T,{placeholder:g("scheduleHistory.selectMonth")})}),(0,i.jsx)(M,{children:O.map(e=>(0,i.jsx)(R,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:g("scheduleHistory.year")}),(0,i.jsxs)(A,{value:(null==m?void 0:m.toString())||"",onValueChange:e=>u(parseInt(e)),children:[(0,i.jsx)(_,{children:(0,i.jsx)(T,{placeholder:g("scheduleHistory.selectYear")})}),(0,i.jsx)(M,{children:z.map(e=>(0,i.jsx)(R,{value:e.value,children:e.label},e.value))})]})]})]}),t.length>0&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:g("scheduleHistory.employeeImport")}),(0,i.jsxs)(A,{value:f,onValueChange:x,children:[(0,i.jsx)(_,{children:(0,i.jsx)(T,{placeholder:g("scheduleHistory.chooseImportOption")})}),(0,i.jsxs)(M,{children:[(0,i.jsx)(R,{value:"auto",children:g("scheduleHistory.autoImportFromRecent")}),(0,i.jsx)(R,{value:"none",children:g("scheduleHistory.startWithEmptyList")}),I.map(e=>(0,i.jsxs)(R,{value:e.id,children:[g("scheduleHistory.copyFrom")," ",W(e.month,g)," ",e.year," (",e.employees.length," ",g("scheduleHistory.employees"),")"]},e.id))]})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:g("scheduleHistory.importNote")})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(p,{onClick:()=>{if(!d||!m)return void G.oR.error(g("toast.invalidInput"),{description:g("toast.selectBothMonthYear")});try{let e;if("auto"===f){let t=k();e=null==t?void 0:t.id}else"none"!==f&&(e=f);r(d,m,e),c(!1),h(null),u(null),x("auto");let t=e?g("toast.withImportedEmployees"):g("toast.withEmptyEmployeeList");G.oR.success(g("toast.scheduleCreated"),{description:g("toast.scheduleCreatedDescription",{month:W(d,g),year:m,importMessage:t})})}catch(e){G.oR.error(g("toast.creationFailed"),{description:e instanceof Error?e.message:g("toast.creationFailedDescription")})}},size:"sm",children:g("scheduleHistory.createSchedule")}),(0,i.jsx)(p,{variant:"outline",onClick:()=>{c(!1),h(null),u(null),x("auto")},size:"sm",children:g("scheduleHistory.cancel")})]})]}),I.length>0&&(0,i.jsx)("div",{className:"space-y-2",children:I.map(e=>(0,i.jsxs)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat(e.id===s?"bg-primary/10 border-primary":"hover:bg-muted/50"),onClick:()=>{e.id===s?n(null):n(e.id)},children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center gap-3",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[e.isGenerated?(0,i.jsx)(L.A,{className:"w-4 h-4 text-green-600"}):(0,i.jsx)(U.A,{className:"w-4 h-4 text-muted-foreground"}),(0,i.jsxs)("span",{className:"font-medium",children:[W(e.month,g)," ",e.year]})]})}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.employees.length," ",g("scheduleHistory.employees")]}),(0,i.jsx)(p,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),C(e.id,e.month,e.year)},className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:(0,i.jsx)(H.A,{className:"w-3 h-3"})})]})]}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[g("scheduleHistory.created")," ",e.createdAt.toLocaleDateString(),e.isGenerated&&(0,i.jsxs)("span",{className:"ml-2 text-green-600",children:["• ",g("scheduleHistory.generated")]})]})]},e.id))})]})]})};function X(e){let{className:t,type:s,...a}=e;return(0,i.jsx)("input",{type:s,"data-slot":"input",className:o("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}var J=s(968);function Q(e){let{className:t,...s}=e;return(0,i.jsx)(J.b,{"data-slot":"label",className:o("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}let Z=(0,f.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function $(e){let{className:t,variant:s,asChild:a=!1,...n}=e,r=a?u.DX:"span";return(0,i.jsx)(r,{"data-slot":"badge",className:o(Z({variant:s}),t),...n})}var ee=s(4073);let et=a.forwardRef((e,t)=>{let{className:s,label:n,labelPosition:r="top",...l}=e,c=Array.isArray(l.value)?l.value:Array.isArray(l.defaultValue)?l.defaultValue:[l.min||0,l.max||100],[d,h]=a.useState(c);return a.useEffect(()=>{Array.isArray(l.value)&&h(l.value)},[l.value]),(0,i.jsxs)(ee.bL,{ref:t,className:o("relative flex w-full touch-none select-none items-center",s),...l,value:d,onValueChange:e=>{h(e),l.onValueChange&&l.onValueChange(e)},children:[(0,i.jsx)(ee.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,i.jsx)(ee.Q6,{className:"absolute h-full bg-primary"})}),d.map((e,t)=>(0,i.jsx)(a.Fragment,{children:(0,i.jsx)(ee.zi,{className:"block h-4 w-4 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:n&&(0,i.jsx)("span",{className:o("absolute flex w-full justify-center","top"===r&&"-top-7","bottom"===r&&"top-4"),children:n(e)})})},t))]})});et.displayName="DualRangeSlider";let es=e=>{let{employee:t,isSelected:s,isEditing:n,predefinedTags:r,onEmployeeSelect:l,onRemoveEmployee:o,onUpdateEmployee:c,onToggleTag:d,onStartEditing:h,onStopEditing:m}=e,[u,f]=(0,a.useState)(""),[x,g]=(0,a.useState)([0,0]),[v,y]=(0,a.useState)([0,0]),[j,b]=(0,a.useState)([0,0]),S=(0,K.c3)(),N=()=>{f(t.name),g(t.shiftsPerMonth),y(t.weekdayShifts),b(t.weekendShifts),h(t)};return(0,i.jsx)("div",{className:"border rounded-lg transition-colors ".concat(s?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:n?(0,i.jsxs)("div",{className:"p-4 space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(Q,{htmlFor:"editName",className:"mb-1",children:S("employees.name")}),(0,i.jsx)(X,{id:"editName",value:u,onChange:e=>f(e.target.value),placeholder:S("employees.namePlaceholder")})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:S("employees.shiftsRangeNote")}),(0,i.jsxs)("div",{children:[(0,i.jsx)(Q,{className:"mb-2",children:S("employees.minMaxShiftsPerMonth")}),(0,i.jsx)("div",{className:"px-3 mb-8",children:(0,i.jsx)(et,{value:x,onValueChange:e=>g(e),max:31,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(Q,{className:"mb-2",children:S("employees.minMaxWeekdayShifts")}),(0,i.jsx)("div",{className:"px-3 mb-8",children:(0,i.jsx)(et,{value:v,onValueChange:e=>y(e),max:23,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(Q,{className:"mb-2",children:S("employees.minMaxWeekendShifts")}),(0,i.jsx)("div",{className:"px-3 mb-8",children:(0,i.jsx)(et,{value:j,onValueChange:e=>b(e),max:9,min:0,step:1,className:"w-full",label:e=>null==e?void 0:e.toString(),labelPosition:"bottom"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(Q,{children:S("employees.tags")}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.map(e=>{let s=t.tags.includes(e);return(0,i.jsx)(p,{variant:s?"default":"outline",size:"sm",onClick:()=>d(t.id,e),children:S(e)},e)})})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(p,{onClick:()=>{c(t.id,{name:u,shiftsPerMonth:x,weekdayShifts:v,weekendShifts:j}),m()},size:"sm",children:S("employees.save")}),(0,i.jsx)(p,{onClick:m,variant:"outline",size:"sm",children:S("employees.cancel")}),(0,i.jsxs)(p,{onClick:()=>{o(t.id),m()},variant:"destructive",size:"sm",children:[(0,i.jsx)(H.A,{className:"w-4 h-4 mr-1"}),S("employees.delete")]})]})]}):(0,i.jsx)("div",{className:"p-3 cursor-pointer",onClick:()=>l(s?"":t.id),children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"font-medium",children:t.name}),(0,i.jsx)($,{variant:"secondary",children:t.shiftsPerMonth[0]===t.shiftsPerMonth[1]?"".concat(t.shiftsPerMonth[0]," ").concat(S("employees.shifts")):"".concat(t.shiftsPerMonth[0],"-").concat(t.shiftsPerMonth[1]," ").concat(S("employees.shifts"))})]}),t.tags.length>0&&(0,i.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:t.tags.map(e=>(0,i.jsx)($,{variant:"outline",className:"text-xs",children:S(e)},S(e)))}),s&&(0,i.jsx)("div",{className:"mt-2 text-xs text-blue-600",children:S("employees.selectedDescription")})]}),(0,i.jsx)(p,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),N()},children:S("employees.edit")})]})})})},ei=e=>{let{employees:t,selectedEmployee:s,onEmployeeSelect:n,onAddEmployee:r,onRemoveEmployee:l,onUpdateEmployee:o,onToggleTag:c,predefinedTags:d,hasActiveSchedule:h}=e,[m,u]=(0,a.useState)(""),f=(0,K.c3)(),x=e=>{u(e.id)},g=()=>{u("")};return(0,i.jsxs)(N,{className:"flex flex-col min-h-[400px] max-h-[80vh]",children:[(0,i.jsxs)(w,{className:"flex-shrink-0",children:[(0,i.jsx)(E,{children:f("employees.title")}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:f(h?"employees.selectScheduleDescription":"employees.noActiveScheduleDescription")})]}),(0,i.jsx)(D,{className:"flex-1 flex flex-col overflow-hidden",children:h?0===t.length?(0,i.jsxs)("div",{className:"text-center py-8",children:[(0,i.jsx)("p",{className:"text-muted-foreground mb-4",children:f("employees.noEmployeesMessage")}),(0,i.jsxs)(p,{onClick:r,children:[(0,i.jsx)(F.A,{className:"w-4 h-4 mr-2"}),f("employees.addFirstEmployee")]})]}):(0,i.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,i.jsx)("div",{className:"flex-1 space-y-3 overflow-y-auto pr-2",children:t.map(e=>(0,i.jsx)(es,{employee:e,isSelected:s===e.id,isEditing:m===e.id,predefinedTags:d,onEmployeeSelect:n,onRemoveEmployee:l,onUpdateEmployee:o,onToggleTag:c,onStartEditing:x,onStopEditing:g},e.id))}),h&&(0,i.jsxs)(p,{onClick:r,variant:"outline",className:"w-full mt-3 flex-shrink-0",children:[(0,i.jsx)(F.A,{className:"w-4 h-4 mr-2"}),f("employees.addEmployee")]})]}):(0,i.jsx)("div",{className:"text-center py-8",children:(0,i.jsx)("p",{className:"text-muted-foreground mb-4",children:f("employees.noActiveScheduleMessage")})})})]})},ea=e=>{let{value:t,onChange:s,min:n=0,max:r=100,defaultValue:l=n,id:o,className:c,placeholder:d}=e,[h,m]=(0,a.useState)(t.toString());return(0,a.useEffect)(()=>{m(t.toString())},[t]),(0,i.jsx)(X,{id:o,type:"number",min:n,max:r,value:h,onChange:e=>m(e.target.value),onBlur:()=>{let e=Math.max(n,Math.min(r,Number.parseInt(h)||l));m(e.toString()),e!==t&&s(e)},className:c,placeholder:d})},en=e=>{var t;let{settings:s,onSettingsChange:a}=e,n=(0,K.c3)(),r=(e,t)=>{a({...s,[e]:t})};return(0,i.jsxs)(N,{children:[(0,i.jsxs)(w,{children:[(0,i.jsx)(E,{children:n("constraints.title")}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:n("constraints.description")})]}),(0,i.jsxs)(D,{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{htmlFor:"shiftsPerDay",children:n("constraints.shiftsPerDay")}),(0,i.jsx)(ea,{id:"shiftsPerDay",value:s.shiftsPerDay,onChange:e=>{let t=Array.from({length:e},(e,t)=>s.personsPerShift[t]||1),i=Array.from({length:e},(e,t)=>{var i;return(null==(i=s.shiftLabels)?void 0:i[t])||"Shift ".concat(t+1)});a({...s,shiftsPerDay:e,personsPerShift:t,shiftLabels:i})},min:1,max:3,defaultValue:1}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.shiftsPerDayDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{children:n("constraints.personsPerShift")}),s.personsPerShift.map((e,t)=>{var a;return(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsxs)(Q,{className:"text-sm w-20",children:[(null==(a=s.shiftLabels)?void 0:a[t])||"Shift ".concat(t+1),":"]}),(0,i.jsx)(ea,{value:e,onChange:e=>{let i=[...s.personsPerShift];i[t]=e,r("personsPerShift",i)},min:1,max:10,defaultValue:1,className:"w-20"})]},t)}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.personsPerShiftDescription")})]}),s.shiftsPerDay>1&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{children:n("settings.shiftLabels")}),null==(t=s.shiftLabels)?void 0:t.map((e,t)=>(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsxs)(Q,{className:"text-sm w-20",children:[n("shiftPreferences.shiftLabel",{index:t+1}),":"]}),(0,i.jsx)(X,{type:"text",value:e,placeholder:n("settings.shiftLabelPlaceholder",{index:t+1}),onChange:e=>{let i=[...s.shiftLabels||[]];i[t]=e.target.value||"Shift ".concat(t+1),r("shiftLabels",i)},className:"flex-1"})]},t)),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("settings.customizeShiftNames")})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.restAndRecovery")}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{htmlFor:"maxConsecutive",children:n("constraints.maxConsecutiveShifts")}),(0,i.jsx)(ea,{id:"maxConsecutive",value:s.maxConsecutiveShifts,onChange:e=>r("maxConsecutiveShifts",e),min:1,max:7,defaultValue:1}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxConsecutiveShiftsDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{htmlFor:"maxConsecutiveDays",children:n("constraints.maxConsecutiveDays")}),(0,i.jsx)(ea,{id:"maxConsecutiveDays",value:s.maxConsecutiveDays,onChange:e=>r("maxConsecutiveDays",e),min:1,max:7,defaultValue:3}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxConsecutiveDaysDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{htmlFor:"minRestDays",children:n("constraints.minRestDaysBetweenShifts")}),(0,i.jsx)(ea,{id:"minRestDays",value:s.minRestDaysBetweenShifts,onChange:e=>r("minRestDaysBetweenShifts",e),min:0,max:3,defaultValue:0}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.minRestDaysBetweenShiftsDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(Q,{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:s.preventMultipleShiftsPerDay,onChange:e=>r("preventMultipleShiftsPerDay",e.target.checked),className:"rounded"}),n("constraints.preventMultipleShiftsPerDay")]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.preventMultipleShiftsPerDayDescription")})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.weeklyLimits")}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{htmlFor:"minShiftsPerWeek",children:n("constraints.minShiftsPerWeek")}),(0,i.jsx)(ea,{id:"minShiftsPerWeek",value:s.minShiftsPerWeek,onChange:e=>r("minShiftsPerWeek",e),min:0,max:7,defaultValue:0}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.minShiftsPerWeekDescription")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Q,{htmlFor:"maxShiftsPerWeek",children:n("constraints.maxShiftsPerWeek")}),(0,i.jsx)(ea,{id:"maxShiftsPerWeek",value:s.maxShiftsPerWeek,onChange:e=>r("maxShiftsPerWeek",e),min:1,max:7,defaultValue:1}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.maxShiftsPerWeekDescription")})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:n("constraints.fairnessAndDistribution")}),(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(Q,{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:s.evenDistribution,onChange:e=>r("evenDistribution",e.target.checked),className:"rounded"}),n("constraints.evenShiftDistribution")]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:n("constraints.evenShiftDistributionDescription")})]})})]}),(0,i.jsxs)("div",{className:"border-t pt-6 bg-muted/50 p-4 rounded-lg",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-2",children:n("constraints.constraintSummary")}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.daily"),":"]})," ",n("constraints.dailySummary",{shiftsPerDay:s.shiftsPerDay,personsPerShift:s.personsPerShift.join(n("constraints.separator"))})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.consecutive"),":"]})," ",n("constraints.consecutiveSummary",{maxShifts:s.maxConsecutiveShifts,maxDays:s.maxConsecutiveDays})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.rest"),":"]})," ",n("constraints.restSummary",{days:s.minRestDaysBetweenShifts})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.multipleShifts"),":"]})," ",s.preventMultipleShiftsPerDay?n("constraints.prevented"):n("constraints.allowed")]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.weekly"),":"]})," ",n("constraints.weeklySummary",{minShifts:s.minShiftsPerWeek,maxShifts:s.maxShiftsPerWeek})]}),(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[n("constraints.distribution"),":"]})," ",s.evenDistribution?n("constraints.even"):n("constraints.flexible")]})]})]})]})]})]})};var er=s(3127),el=s(4261),eo=s(2118);let ec=(e,t,s,i,a,n)=>{let r=V(s,i),l="Date,Shift,Employee\n";for(let a=1;a<=r;a++){let r=e[a],o="".concat(i,"-").concat((s+1).toString().padStart(2,"0"),"-").concat(a.toString().padStart(2,"0"));(null==r?void 0:r.shifts)&&r.shifts.length>0?r.shifts.forEach((e,s)=>{var i;let a=(null==n||null==(i=n.shiftLabels)?void 0:i[s])||"Shift ".concat(s+1);e.employeeIds.length>0?e.employeeIds.forEach(e=>{let s=t.find(t=>t.id===e);l+="".concat(o,",").concat(a,",").concat((null==s?void 0:s.name)||"Unknown","\n")}):l+="".concat(o,",").concat(a,",No Assignment\n")}):l+="".concat(o,",No Shifts,No Assignment\n")}let o=new Blob([l],{type:"text/csv"}),c=window.URL.createObjectURL(o),d=document.createElement("a");d.href=c,d.download="schedule-".concat(W(s,a),"-").concat(i,".csv"),d.click(),window.URL.revokeObjectURL(c)},ed=(e,t,s,i,a,n)=>{let r=document.createElement("canvas"),l=r.getContext("2d");if(!l)return;let o=V(s,i),c=(null==n?void 0:n.shiftsPerDay)&&n.shiftsPerDay>1?60:40;r.width=980,r.height=60+Math.ceil(o/7)*c,l.fillStyle="#ffffff",l.fillRect(0,0,r.width,r.height),l.fillStyle="#000000",l.font="bold 24px Arial",l.textAlign="center",l.fillText("".concat(W(s,a)," ").concat(i," Schedule"),r.width/2,30),l.font="14px Arial",l.textAlign="left";for(let s=1;s<=o;s++){let i=Math.floor((s-1)/7),a=(s-1)%7*140,r=60+i*c;l.strokeStyle="#cccccc",l.strokeRect(a,r,140,c),l.fillStyle="#000000",l.fillText(s.toString(),a+5,r+20);let o=e[s];if((null==o?void 0:o.shifts)&&o.shifts.length>0){let e=35;o.shifts.forEach((s,i)=>{if(s.employeeIds.length>0){if((null==n?void 0:n.shiftsPerDay)&&n.shiftsPerDay>1){var r;let t=(null==(r=n.shiftLabels)?void 0:r[i])||"S".concat(i+1);l.fillStyle="#666666",l.font="10px Arial",l.fillText("".concat(t,":"),a+5,e),e+=12}s.employeeIds.slice(0,2).forEach(s=>{let i=t.find(e=>e.id===s);l.fillStyle="#0066cc",l.font="10px Arial";let n=(null==i?void 0:i.name)||"Unknown",r=n.length>12?n.substring(0,10)+"...":n;l.fillText(r,a+5,e),e+=10}),s.employeeIds.length>2&&(l.fillStyle="#888888",l.font="8px Arial",l.fillText("+".concat(s.employeeIds.length-2," more"),a+5,e),e+=10)}})}}r.toBlob(e=>{if(e){let t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="schedule-".concat(W(s,a),"-").concat(i,".png"),n.click(),window.URL.revokeObjectURL(t)}})},eh=e=>{let{day:t,daySchedule:s,employees:a,constraints:n,selectedEmployee:r,settings:l,isLastInRow:c,isInLastRow:d,showShiftColors:h=!1,onShiftClick:m,onDayClick:u}=e,f=(0,K.c3)(),x=r?n.filter(e=>e.employeeId===r&&e.date===t):[],p=null;if(x.length>0){let e=x.every(e=>"prefer"===e.type),t=x.every(e=>"avoid"===e.type);e?p="prefer":t&&(p="avoid")}let g=["p-1 min-h-24 border-gray-400 transition-colors"];return c||g.push("border-r"),d||g.push("border-b"),(0,i.jsxs)("div",{className:o(g),children:[(0,i.jsxs)("div",{className:"mb-1 relative flex justify-center items-center",children:[(0,i.jsx)("span",{className:"text-sm font-medium",children:t}),r&&l.shiftsPerDay>1&&(0,i.jsx)("button",{onClick:()=>u(t),className:o(["absolute right-0 text-[10px] border transition-colors truncate max-w-[calc(50%-0.5rem)]","constraint-button-".concat(p)]),title:f("scheduleView.setAllShiftsDescription"),children:f("scheduleView.setAllShifts_".concat(p))})]}),(0,i.jsx)("div",{className:"space-y-0.5",children:Array.from({length:l.shiftsPerDay},(e,n)=>{var c,d;let u=null==s||null==(c=s.shifts)?void 0:c[n],f=(null==u?void 0:u.employeeIds)||[],p=(null==(d=l.shiftLabels)?void 0:d[n])||"Shift ".concat(n+1),g=r?x.find(e=>e.shiftIndex===n):null,v=["text-xs border min-h-6 cursor-pointer transition-colors relative"];return h&&l.shiftsPerDay>1&&v.push("shift-".concat(n)),r&&f.includes(r)&&v.push("ring-2 ring-blue-400"),(0,i.jsxs)("div",{className:o(v),onClick:()=>r&&m(t,n),title:p,children:[g&&(0,i.jsx)("div",{className:"absolute top-0 right-0 z-10",children:(0,i.jsx)("span",{className:o(["text-[8px] px-1 py-1 rounded text-white font-bold shadow-sm","prefer"===g.type?"bg-green-600":"bg-red-600"]),children:"prefer"===g.type?"✓":"✗"})}),(0,i.jsx)("div",{className:"space-y-0.5 grid grid-cols-[repeat(auto-fit,minmax(60px,1fr))] gap-0.5",children:f.map((e,s)=>{let l=a.find(t=>t.id===e),c=r===e;return(0,i.jsx)("div",{className:o("text-[12px] truncate",c?"font-bold ring-1 ring-blue-400":""),title:null==l?void 0:l.name,children:null==l?void 0:l.name},"".concat(e,"-").concat(t,"-").concat(n,"-").concat(s))})})]},"".concat(t,"-shift-").concat(n))})})]})},em=e=>{var t;let{schedule:s,employees:n,selectedMonth:r,selectedYear:l,hasActiveSchedule:c,constraints:d=[],selectedEmployee:h,settings:m,onSetConstraint:u,onRemoveConstraint:f,onGenerateSchedule:x,isGenerating:g=!1}=e,[v,y]=(0,a.useState)(!1),[j,b]=(0,a.useState)(!0),S=(0,a.useRef)(null),k=(0,K.c3)();(0,a.useEffect)(()=>{let e=e=>{S.current&&!S.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let C=(e,t)=>{if(!h||!u||!f)return;let s=d.find(s=>s.employeeId===h&&s.date===e&&s.shiftIndex===t);s?"prefer"===s.type?u(h,"avoid",e,t):"avoid"===s.type&&f(h,e,t):u(h,"prefer",e,t)},I=e=>{if(!h||!u||!f)return;let t=d.filter(t=>t.employeeId===h&&t.date===e),s=null;(s=0===t.length?"prefer":t.every(e=>"prefer"===e.type)?"avoid":null)?u(h,s,e):f(h,e)};return(0,i.jsxs)(N,{children:[(0,i.jsx)(w,{children:(0,i.jsxs)(E,{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[!c&&k("schedule.title"),c&&k("schedule.monthSchedule",{month:W(r,k),year:l}),h&&(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:[k("schedule.settingPreferencesFor")," ",(0,i.jsx)("strong",{children:null==(t=n.find(e=>e.id===h))?void 0:t.name})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[x&&(0,i.jsx)(p,{onClick:x,disabled:0===n.length||g,size:"sm",children:g?k("schedule.generating"):k("schedule.generateButton")}),m.shiftsPerDay>1&&(0,i.jsx)(p,{variant:j?"default":"outline",size:"sm",onClick:()=>b(!j),className:"flex items-center gap-2",title:j?k("scheduleView.hideShiftColors"):k("scheduleView.showShiftColors"),children:(0,i.jsx)(er.A,{className:"w-4 h-4"})}),Object.keys(s).length>0&&(0,i.jsxs)("div",{className:"relative",ref:S,children:[(0,i.jsxs)(p,{variant:"outline",size:"sm",onClick:()=>y(!v),className:"flex items-center gap-2",children:[k("schedule.export"),(0,i.jsx)(P.A,{className:"w-4 h-4"})]}),v&&(0,i.jsxs)("div",{className:"absolute right-0 top-full mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[(0,i.jsxs)("button",{onClick:()=>{if(0===Object.keys(s).length)return void G.oR.error(k("toast.noSchedule"),{description:k("toast.pleaseGenerateFirst")});try{ec(s,n,r,l,k,m),G.oR.success(k("toast.csvExported"),{description:k("toast.csvExportedDescription")})}catch(e){G.oR.error(k("toast.exportFailed"),{description:k("toast.csvExportFailedDescription")})}y(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,i.jsx)(el.A,{className:"w-4 h-4"}),k("schedule.exportCSV")]}),(0,i.jsxs)("button",{onClick:()=>{if(0===Object.keys(s).length)return void G.oR.error(k("toast.noSchedule"),{description:k("toast.pleaseGenerateFirst")});try{ed(s,n,r,l,k,m),G.oR.success(k("toast.imageExported"),{description:k("toast.imageExportedDescription")})}catch(e){G.oR.error(k("toast.exportFailed"),{description:k("toast.imageExportFailedDescription")})}y(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[(0,i.jsx)(eo.A,{className:"w-4 h-4"}),k("schedule.exportImage")]})]})]})]})]})}),(0,i.jsxs)(D,{children:[!c&&(0,i.jsx)("p",{className:"text-muted-foreground",children:k("schedule.noActiveSchedule")}),c&&(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"border border-gray-400 rounded-lg overflow-hidden",children:(0,i.jsxs)("div",{className:"grid grid-cols-7",children:[[k("days.0"),k("days.1"),k("days.2"),k("days.3"),k("days.4"),k("days.5"),k("days.6")].map(e=>(0,i.jsx)("div",{className:"p-3 text-center font-medium bg-muted border-r border-b border-gray-400 last:border-r-0",children:e},e)),(()=>{if(!r||!l)return null;let e=Y(r,l),t=V(r,l),a=[],c=e+t;for(let t=0;t<e;t++){let e=(t+1)%7==0,s=t>=7*Math.floor(c/7),n=["p-2 min-h-20 border-gray-400"];e||n.push("border-r"),s||n.push("border-b"),a.push((0,i.jsx)("div",{className:o(n)},"empty-".concat(t)))}for(let r=1;r<=t;r++){let t=s[r],l=e+r-1,o=(l+1)%7==0,u=l>=7*Math.floor(c/7);a.push((0,i.jsx)(eh,{day:r,daySchedule:t,employees:n,constraints:d,selectedEmployee:h,settings:m,isLastInRow:o,isInLastRow:u,showShiftColors:j,onShiftClick:C,onDayClick:I},r))}return a})()]})})})]})]})};var eu=s(143),ef=s(4869);let ex={en:{name:"English",flag:"\uD83C\uDDFA\uD83C\uDDF8"},"zh-TW":{name:"繁體中文",flag:"\uD83C\uDDF9\uD83C\uDDFC"}};function ep(){let{locale:e,setLocale:t}=(0,eu.Y)();return(0,i.jsxs)(A,{value:e,onValueChange:e=>{t(e)},children:[(0,i.jsx)(_,{className:"w-10 h-10 p-0 border-none hover:bg-muted/50 rounded-md",children:(0,i.jsx)(T,{children:(0,i.jsx)(ef.A,{className:"h-5 w-5"})})}),(0,i.jsxs)(M,{children:[(0,i.jsx)(R,{value:"en",children:(0,i.jsxs)("span",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{children:ex.en.flag}),(0,i.jsx)("span",{children:ex.en.name})]})}),(0,i.jsx)(R,{value:"zh-TW",children:(0,i.jsxs)("span",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{children:ex["zh-TW"].flag}),(0,i.jsx)("span",{children:ex["zh-TW"].name})]})})]})]})}var eg=s(1368);let ev={shiftsPerDay:1,personsPerShift:[1],maxConsecutiveShifts:3,maxConsecutiveDays:6,minRestDaysBetweenShifts:0,preventMultipleShiftsPerDay:!0,maxShiftsPerWeek:7,minShiftsPerWeek:0,evenDistribution:!0,shiftLabels:["Shift 1"]},ey=()=>{let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(null),[n,r]=(0,a.useState)(ev),[l,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{c(),o(!0)},[]),(0,a.useEffect)(()=>{!1!==l&&localStorage.setItem("scheduleData",JSON.stringify({schedules:e,settings:n}))},[e,n,l]);let c=()=>{let e=localStorage.getItem("scheduleData");if(e)try{let s=JSON.parse(e);t((s.schedules||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))),r({...ev,...s.settings})}catch(e){console.error("Error loading from localStorage:",e)}},d=(e,s)=>{t(t=>t.map(t=>t.id===e?{...t,...s}:t))},h=()=>e.find(e=>e.id===s)||null,m=h(),u=(null==m?void 0:m.month)||0,f=(null==m?void 0:m.year)||0,x=(null==m?void 0:m.employees)||[],p=(null==m?void 0:m.constraints)||[];return{schedules:e,activeScheduleId:s,setActiveScheduleId:i,addSchedule:(s,a,n)=>{let r=[];if(n){let t=e.find(e=>e.id===n);t&&t.employees.length>0&&(r=t.employees.map(e=>({...e,id:(0,eg.A)()})))}let l={id:(0,eg.A)(),month:s,year:a,employees:r,constraints:[],schedule:{},createdAt:new Date,isGenerated:!1};return t(e=>[...e,l]),i(l.id),l.id},deleteSchedule:e=>{t(t=>t.filter(t=>t.id!==e)),s===e&&i(null)},updateSchedule:d,getActiveSchedule:h,selectedMonth:u,selectedYear:f,employees:x,setEmployees:e=>{s&&d(s,{employees:e})},constraints:p,setConstraints:e=>{s&&d(s,{constraints:e})},schedule:(null==m?void 0:m.schedule)||{},setSchedule:e=>{s&&d(s,{schedule:e,isGenerated:Object.keys(e).length>0})},settings:n,setSettings:r}},ej=(e,t,s,i,a,n,r)=>({addEmployee:()=>{let s=r?r("employees.newEmployee"):"New Employee",i=(e.length+1).toString().padStart(3,"0"),a={id:(0,eg.A)(),name:"".concat(s," ").concat(i),shiftsPerMonth:[4,8],weekdayShifts:[0,8],weekendShifts:[0,8],tags:[]};t([...e,a]),r?G.oR.success(r("toast.employeeAdded"),{description:r("toast.employeeAddedDescription",{name:a.name})}):G.oR.success("Employee added",{description:"".concat(a.name," has been added to the schedule.")})},removeEmployee:r=>{t(e.filter(e=>e.id!==r)),i(s.filter(e=>e.employeeId!==r));let l={...a};Object.keys(l).forEach(e=>{let t=l[Number.parseInt(e)];t&&t.shifts&&(t.shifts=t.shifts.map(e=>({...e,employeeIds:e.employeeIds.filter(e=>e!==r)})))}),n(l)},updateEmployee:(s,i)=>{t(e.map(e=>e.id===s?{...e,...i}:e)),r?G.oR.success(r("toast.employeeUpdated"),{description:r("toast.employeeUpdatedDescription")}):G.oR.success("Employee updated",{description:"Employee information has been saved."})},toggleEmployeeTag:(s,i)=>{t(e.map(e=>{if(e.id===s){let t=e.tags.includes(i);return{...e,tags:t?e.tags.filter(e=>e!==i):[...e.tags,i]}}return e}))}}),eb=(e,t)=>({getConstraintsForEmployee:t=>e.filter(e=>e.employeeId===t),getShiftConstraint:(t,s,i)=>e.find(e=>e.employeeId===t&&e.date===s&&e.shiftIndex===i),removeConstraint:(s,i,a)=>{t(e.filter(e=>e.employeeId!==s||e.date!==i||void 0!==a&&e.shiftIndex!==a))},setShiftConstraint:(s,i,a,n)=>{t([...e.filter(e=>e.employeeId!==s||e.date!==a||e.shiftIndex!==n),{id:(0,eg.A)(),employeeId:s,type:i,date:a,shiftIndex:n}])},setAllShiftsConstraint:(s,i,a,n)=>{t([...e.filter(e=>e.employeeId!==s||e.date!==a),...Array.from({length:n},(e,t)=>({id:(0,eg.A)(),employeeId:s,type:i,date:a,shiftIndex:t}))])}}),eS=(e,t)=>e*t.personsPerShift.reduce((e,t)=>e+t,0);var eN=s(2764),ew=s.n(eN);let eE=e=>Math.floor(Math.random()*e),eD=(e,t,s,i)=>{let a=eS(i,s);if(e.length<a)throw Error("Not enough slots in optimized schedule");let n={},r=0;for(let a=1;a<=i;a++){n[a]={shifts:[]};for(let i=0;i<s.shiftsPerDay;i++){let l=[],o=s.personsPerShift[i];for(let s=0;s<o;s++){let s=e[r];if(s>=0&&s<t.length)l.push(t[s].id);else throw Error("Invalid employee index ".concat(s," in optimized schedule"));r++}n[a].shifts.push({employeeIds:l})}}return n},ek=e=>{let t=[];e.forEach((e,s)=>{for(let i=0;i<e.shiftsPerMonth[1];i++)t.push(s)});for(let e=t.length-1;e>0;e--){let s=eE(e+1);[t[e],t[s]]=[t[s],t[e]]}return t},eP=(e,t,s,i,a,n,r)=>{let l=0,o=eS(a,i),c={AVOID_VIOLATION:2e3,DUPLICATE_PERSON_IN_SHIFT:2e3,CONSECUTIVE:100,WEEKLY_LIMIT:100,UNEVEN_DISTRIBUTION:50,MISSED_PREFERENCE:100,REST_DAYS:80,HOLIDAY_DISTRIBUTION:1e3,WEEKEND_CONSECUTIVE:50,TOTAL_SHIFT_COUNT:2e3,WEEKEND_SHIFTS_PREFERENCE:150,WEEKDAY_SHIFTS_PREFERENCE:150},d=Array(t.length).fill(0),h=t.map(()=>({current:0,max:0})),m=Array(t.length).fill(0),u=Array(t.length).fill(0),f=t.map(()=>({current:0,max:0})),x=e.slice(0,o);if(x.length<o)throw Error("Optimized schedule does not have enough slots: expected ".concat(o,", got ").concat(x.length));x.forEach(e=>{if(e<-1||e>=t.length)throw Error("Invalid employee index ".concat(e," in optimized schedule"))});for(let e=0;e<a;e++){let a=e+1,o=eC(a,i),p=x.slice(o.start,o.end);for(let e=0;e<i.shiftsPerDay;e++){let t=eI(a,e,i);new Set(x.slice(t.start,t.end)).size<i.personsPerShift[e]&&(l+=c.DUPLICATE_PERSON_IN_SHIFT)}let g=B(a,n,r);s.forEach(e=>{if(e.date===a){let s=t.findIndex(t=>t.id===e.employeeId);if(-1===s)return;let n=eI(a,e.shiftIndex,i),r=x.slice(n.start,n.end);"avoid"===e.type&&r.includes(s)&&(l+=c.AVOID_VIOLATION),"prefer"!==e.type||r.includes(s)||(l+=c.MISSED_PREFERENCE)}});let v=[...new Set(p)];v.forEach(s=>{var a;if(d[s]++,g?m[s]++:u[s]++,e>0){let t=eC(e,i),a=!1;for(let e=t.start;e<t.end;e++)if(x[e]===s){a=!0;break}a?h[s].current++:h[s].current=1}else h[s].current=1;if(h[s].max=Math.max(h[s].max,h[s].current),g&&(null==(a=t[s])?void 0:a.tags.includes("tags.weekendType"))){if(e>0){let t=B(e,n,r),a=eC(e,i),l=!1;if(t){for(let e=a.start;e<Math.min(a.end,x.length);e++)if(x[e]===s){l=!0;break}}l?f[s].current++:f[s].current=1}else f[s].current=1;f[s].max=Math.max(f[s].max,f[s].current)}else f[s].current=0}),t.forEach((e,t)=>{v.includes(t)||(h[t].current=0,f[t].current=0)})}t.forEach((e,t)=>{let s=0;h[t].max>i.maxConsecutiveShifts&&(s+=(h[t].max-i.maxConsecutiveShifts)*c.CONSECUTIVE),e.tags.includes("tags.weekendType")&&(f[t].max>=2?s=0:s+=c.WEEKEND_CONSECUTIVE),l+=s});let p=t.map(()=>[]);for(let e=0;e<a;e++){let s=eC(e+1,i);t.forEach((t,i)=>{let a=!1;for(let e=s.start;e<s.end&&e<x.length;e++)if(x[e]===i){a=!0;break}a&&p[i].push(e)})}for(let e=0;e<Math.ceil(a/7);e++){let s=7*e,n=Math.min(s+6,a-1);t.forEach((e,t)=>{let a=0;for(let e=s;e<=n;e++)p[t].includes(e)&&a++;a>i.maxShiftsPerWeek&&(l+=(a-i.maxShiftsPerWeek)*c.WEEKLY_LIMIT)})}if(t.forEach((e,t)=>{let s=p[t].sort((e,t)=>e-t);for(let e=0;e<s.length-1;e++){let t=s[e+1]-s[e]-1;t<i.minRestDaysBetweenShifts&&(l+=(i.minRestDaysBetweenShifts-t)*c.REST_DAYS)}}),t.forEach((e,t)=>{let s=d[t];s<e.shiftsPerMonth[0]&&(l+=(e.shiftsPerMonth[0]-s)*c.TOTAL_SHIFT_COUNT),s>e.shiftsPerMonth[1]&&(l+=(s-e.shiftsPerMonth[1])*c.TOTAL_SHIFT_COUNT);let i=m[t],a=u[t];i<e.weekendShifts[0]&&(l+=(e.weekendShifts[0]-i)*c.WEEKEND_SHIFTS_PREFERENCE),i>e.weekendShifts[1]&&(l+=(i-e.weekendShifts[1])*c.WEEKEND_SHIFTS_PREFERENCE),a<e.weekdayShifts[0]&&(l+=(e.weekdayShifts[0]-a)*c.WEEKDAY_SHIFTS_PREFERENCE),a>e.weekdayShifts[1]&&(l+=(a-e.weekdayShifts[1])*c.WEEKDAY_SHIFTS_PREFERENCE)}),i.evenDistribution){let e=d.reduce((e,t)=>e+t,0)/d.length,t=d.reduce((t,s)=>t+Math.pow(s-e,2),0)/d.length;l+=t*c.UNEVEN_DISTRIBUTION}let g=m.reduce((e,t)=>e+t,0),v=u.reduce((e,t)=>e+t,0);return g>0&&v>0&&t.forEach((e,t)=>{let s=d[t];if(s>0){let e=Math.abs(m[t]/s-g/(g+v));m[t]>0&&0===u[t]&&s>1?l+=2*c.HOLIDAY_DISTRIBUTION:u[t]>0&&0===m[t]&&s>1?l+=c.HOLIDAY_DISTRIBUTION:e>.3&&(l+=e*c.HOLIDAY_DISTRIBUTION)}}),console.log("Cost calculated: ".concat(l)),l},eC=(e,t)=>{let s=t.personsPerShift.reduce((e,t)=>e+t,0);return{start:(e-1)*s,end:e*s}},eI=(e,t,s)=>{let i=eC(e,s).start;for(let e=0;e<t;e++)i+=s.personsPerShift[e];return{start:i,end:i+s.personsPerShift[t]}},eA=e=>{let t=[...e];if(t.length<2)return t;let s=["swap","move","reverse","transport"],i=s[eE(s.length)],a=eE(t.length),n=eE(t.length);switch(i){case"swap":[t[a],t[n]]=[t[n],t[a]];break;case"move":{let e=t.splice(a,1)[0];t.splice(n,0,e);break}case"reverse":{let e=Math.min(a,n),s=Math.max(a,n);for(;e<s;)[t[e],t[s]]=[t[s],t[e]],e++,s--;break}case"transport":{if(t.length<3)break;let e=Math.min(a,n),s=Math.max(a,n);if(e<s){let i=t.splice(e,s-e+1),a=eE(t.length);t.splice(a,0,...i)}}}return t},eT=(e,t,s,i,a)=>{if(0===e.length)return{schedule:{},success:!1,message:"Please add employees before generating a schedule."};let n=V(i,a),r=eS(n,s),l=e.reduce((e,t)=>e+t.shiftsPerMonth[0],0),o=e.reduce((e,t)=>e+t.shiftsPerMonth[1],0);if(o<r)return{schedule:{},success:!1,message:"Not enough maximum shifts available (".concat(o,") to cover all required shifts (").concat(r,")")};if(l>r)return{schedule:{},success:!1,message:"Minimum shifts required (".concat(l,") exceed total shifts needed (").concat(r,")")};let c=ek(e);try{console.log("Starting optimized simulated annealing with ".concat(e.length," employees, ").concat(n," days"));let r=Date.now(),l=ew()({initialState:c,tempMax:1e3,tempMin:.1,newState:e=>eA(e),getTemp:e=>.999*e,getEnergy:r=>eP(r,e,t,s,n,i,a)}),o=Date.now();console.log("Simulated annealing completed in ".concat(o-r,"ms"));let d=eD(l,e,s,n),h=eP(l,e,t,s,n,i,a),m=0===h?"Perfect schedule generated with all constraints satisfied!":"Schedule generated with optimization score: ".concat(Math.round(Math.max(0,h)));return{schedule:d,success:!0,message:m}}catch(e){return console.error("Simulated annealing failed:",e),{schedule:{},success:!1,message:"Simulated annealing failed."}}},e_={Maximize:(e,t)=>e>=t,Minimize:(e,t)=>e<t},eM={Tournament2(e,t){let s=t.length,i=t[Math.floor(Math.random()*s)],a=t[Math.floor(Math.random()*s)];return e(i.fitness,a.fitness)?i.entity:a.entity},Tournament3(e,t){let s=t.length,i=t[Math.floor(Math.random()*s)],a=t[Math.floor(Math.random()*s)],n=t[Math.floor(Math.random()*s)],r=e(i.fitness,a.fitness)?i:a;return(r=e(r.fitness,n.fitness)?r:n).entity},Fittest:e=>e[0].entity,Random:e=>e[Math.floor(Math.random()*e.length)].entity},eR={Tournament2:(e,t)=>[eM.Tournament2(e,t),eM.Tournament2(e,t)],Random:e=>[eM.Random(e),eM.Random(e)],FittestRandom:e=>[eM.Fittest(e),eM.Random(e)]};function eO(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}class ez{mutateOrNot(e){return Math.random()<=this.configuration.mutation&&this.mutate?this.mutate(eO(e)):e}start(){if(!this.fitness||!this.seed)throw Error("fitness and seed functions must be defined");this.select1||(this.select1=e=>eM.Tournament2(this.optimize,e)),this.select2||(this.select2=e=>eR.Tournament2(this.optimize,e)),this.optimize||(this.optimize=e_.Minimize);for(let e=0;e<this.configuration.size;++e)this.entities.push(eO(this.seed()));for(let e=0;e<this.configuration.iterations;++e){this.internalGenState={};let t=this.entities.map(e=>({fitness:this.fitness(e),entity:e})).sort((e,t)=>this.optimize(e.fitness,t.fitness)?-1:1),s=t.reduce((e,t)=>e+t.fitness,0)/t.length,i=Math.sqrt(t.map(e=>(e.fitness-s)*(e.fitness-s)).reduce((e,t)=>e+t,0)/t.length),a={maximum:t[0].fitness,minimum:t[t.length-1].fitness,mean:s,stdev:i},n=!this.generation||this.generation(t.slice(0,this.configuration.maxResults),e,a),r=void 0!==n&&!n||e===this.configuration.iterations-1;if(this.notification&&(r||0===this.configuration.skip||e%this.configuration.skip==0)&&this.notification(t.slice(0,this.configuration.maxResults),e,a,r),r)return t[0].entity;let l=[];for(this.configuration.fittestAlwaysSurvives&&l.push(t[0].entity);l.length<this.configuration.size;)if(this.crossover&&Math.random()<=this.configuration.crossover&&l.length+1<this.configuration.size){let e=this.select2(t),s=this.crossover(eO(e[0]),eO(e[1])).map(e=>this.mutateOrNot(e));l.push(s[0],s[1])}else l.push(this.mutateOrNot(this.select1(t)));this.entities=l}return this.entities.map(e=>({fitness:this.fitness(e),entity:e})).sort((e,t)=>this.optimize(e.fitness,t.fitness)?-1:1)[0].entity}async evolve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.configuration,e),new Promise((e,t)=>{try{let t=this.start();e(t)}catch(e){t(e)}})}constructor(){this.fitness=null,this.seed=null,this.mutate=null,this.crossover=null,this.select1=null,this.select2=null,this.optimize=null,this.generation=null,this.notification=null,this.configuration={size:250,crossover:.9,mutation:.2,iterations:100,fittestAlwaysSurvives:!0,maxResults:100,skip:0},this.userData={},this.internalGenState={},this.entities=[]}}let eF={create:()=>new ez,Optimize:e_,Select1:eM,Select2:eR},eL=e=>Math.floor(Math.random()*e),eU=(e,t,s,i)=>{if(!e||!Array.isArray(e))throw Error("Invalid genetic schedule provided to optimizedToSchedule");let a={};for(let n=1;n<=i;n++){a[n]={shifts:[]};for(let i=0;i<s.shiftsPerDay;i++){let r=[],l=(n-1)*s.shiftsPerDay+i;if(l<e.length){let s=e[l];for(let e=0;e<s.length;e++)s[e]&&e<t.length&&r.push(t[e].id)}else throw Error("schedule generated is too short");a[n].shifts.push({employeeIds:r})}}return a},eH=(e,t,s,i,a,n,r)=>{let l=0,o={MAX_CONSECUTIVE_SHIFTS:100,MAX_CONSECUTIVE_DAYS:100,ENOUGH_REST_DAYS:100,MULTIPLE_SHIFTS_PER_DAY:100,TOTAL_SHIFT_COUNT:100,WEEKDAY_SHIFT_COUNT:100,WEEKEND_SHIFT_COUNT:100,AVOID_VIOLATION:100,PREFER_VIOLATION:10},c=Array(t.length).fill(0),d=t.map(()=>[]),h=t.map(()=>[]),m=Array(t.length).fill(0),u=Array(t.length).fill(0);for(let t=1;t<=a;t++)for(let s=0;s<i.shiftsPerDay;s++){let a=(t-1)*i.shiftsPerDay+s,l=e[a];for(let e=0;e<l.length;e++)l[e]&&(d[e].push(t),h[e].push(a),c[e]++,B(t,n,r)?m[e]++:u[e]++)}return t.forEach((e,t)=>{let s=c[t],a=m[t],n=u[t],r=d[t],f=h[t];s<e.shiftsPerMonth[0]&&(l+=o.TOTAL_SHIFT_COUNT*(e.shiftsPerMonth[0]-s)),s>e.shiftsPerMonth[1]&&(l+=o.TOTAL_SHIFT_COUNT*(s-e.shiftsPerMonth[1])),a<e.weekendShifts[0]&&(l+=o.WEEKDAY_SHIFT_COUNT*(e.weekendShifts[0]-a)),a>e.weekendShifts[1]&&(l+=o.WEEKDAY_SHIFT_COUNT*(a-e.weekendShifts[1])),n<e.weekdayShifts[0]&&(l+=o.WEEKEND_SHIFT_COUNT*(e.weekdayShifts[0]-n)),n>e.weekdayShifts[1]&&(l+=o.WEEKEND_SHIFT_COUNT*(n-e.weekdayShifts[1]));let x=1,p=1,g=r[0],v=f[0];for(let e=1;e<f.length;e++){let t=r[e],s=f[e];s===v+1?++p>i.maxConsecutiveShifts&&(l+=o.MAX_CONSECUTIVE_SHIFTS*(p-i.maxConsecutiveShifts)):p=1,t===g&&i.preventMultipleShiftsPerDay&&(l+=o.MULTIPLE_SHIFTS_PER_DAY),t===g+1?++x>i.maxConsecutiveDays&&(l+=o.MAX_CONSECUTIVE_DAYS*(x-i.maxConsecutiveDays)):t>g+1&&(x=1,t-g-1<i.minRestDaysBetweenShifts&&(l+=o.ENOUGH_REST_DAYS*(g+1+i.minRestDaysBetweenShifts-t)*(g+1+i.minRestDaysBetweenShifts-t))),g=t,v=s}}),s.forEach(s=>{let a=t.findIndex(e=>e.id===s.employeeId);if(-1===a)return;let n=(s.date-1)*i.shiftsPerDay+s.shiftIndex;if(n>=e.length)return;let r=e[n][a];"avoid"===s.type&&r?l+=o.AVOID_VIOLATION:"prefer"!==s.type||r||(l+=o.PREFER_VIOLATION)}),l},eV=(e,t,s)=>{let i=["swap_shift","move_shift","transport_shift","shift_random","shift_random","shift_random"];switch(i[eL(i.length)]){case"swap_shift":{let i=eL(s),a=eL(s),n=eL(t.shiftsPerDay),r=i*t.shiftsPerDay+n,l=a*t.shiftsPerDay+n;[e[r],e[l]]=[e[l],e[r]];break}case"move_shift":{let i=eL(s),a=eL(s),n=e.splice(i*t.shiftsPerDay,t.shiftsPerDay);e.splice(a*t.shiftsPerDay,0,...n);break}case"transport_shift":{let i=eL(s),a=eL(s),n=Math.min(i,a),r=Math.max(i,a),l=e.splice(n*t.shiftsPerDay,(r-n+1)*t.shiftsPerDay),o=eL(s);e.splice(o*t.shiftsPerDay,0,...l);break}case"shift_random":{let t=eL(e.length);for(let s=e[t].length-1;s>0;s--){let i=eL(s+1);[e[t][s],e[t][i]]=[e[t][i],e[t][s]]}}}return e},eW=(e,t)=>{let s=e.length;if(s<2)return[e,t];let i=eL(s),a=eL(s);for(;i===a;)a=eL(s);i>a&&([i,a]=[a,i]);let n=[],r=[];for(let l=0;l<s;l++)l<i?(n.push([...e[l]]),r.push([...t[l]])):l<a?(n.push([...t[l]]),r.push([...e[l]])):(n.push([...e[l]]),r.push([...t[l]]));return[n,r]},eY=(e,t,s)=>Array.from({length:s},(s,i)=>{let a=t.personsPerShift[i%t.shiftsPerDay],n=Array(a).fill(!0).concat(Array(e.length-a).fill(!1));for(let e=n.length-1;e>0;e--){let t=eL(e+1);[n[e],n[t]]=[n[t],n[e]]}return n}),eB=async(e,t,s,i,a)=>{let n=V(i,a),r=eS(n,s),l=e.reduce((e,t)=>e+t.shiftsPerMonth[0],0),o=e.reduce((e,t)=>e+t.shiftsPerMonth[1],0);if(o<r)return{schedule:{},success:!1,message:"Not enough maximum shifts available (".concat(o,") to cover all required shifts (").concat(r,")")};if(l>r)return{schedule:{},success:!1,message:"Minimum shifts required (".concat(l,") exceed total shifts needed (").concat(r,")")};try{let r=eF.create();r.seed=()=>eY(e,s,n*s.shiftsPerDay),r.fitness=r=>eH(r,e,t,s,n,i,a),r.mutate=e=>eV(e,s,n),r.crossover=eW,r.select1=e=>.9>=Math.random()?eF.Select1.Tournament2(eF.Optimize.Minimize,e):eF.Select1.Fittest(e),r.select2=e=>.9>=Math.random()?eF.Select2.Tournament2(eF.Optimize.Minimize,e):eF.Select2.FittestRandom(e),r.generation=(e,t,s)=>{t%10==0&&console.log("Gen ".concat(t,": best = ").concat(s.maximum," stdev = ").concat(s.stdev));let i=e[0];return 0!==i.fitness};let l={size:10,iterations:3e4,crossover:.5,mutation:.4,maxResults:1,skip:5};console.log("Starting genetic algorithm with config:",l);let o=await Promise.race([r.evolve(l),new Promise((e,t)=>setTimeout(()=>t(Error("Genetic algorithm timeout")),3e4))]),c=eU(o,e,s,n),d=eH(o,e,t,s,n,i,a);return{schedule:c,success:!0,message:"Genetic algorithm completed successfully. Final penalty score: ".concat(d)}}catch(e){return console.error("Genetic algorithm error:",e),{schedule:{},success:!1,message:"Genetic algorithm failed: ".concat(e instanceof Error?e.message:"Unknown error")}}},eG=()=>{let[e,t]=(0,a.useState)(!1);return{isGenerating:e,handleGenerateSchedule:async function(e,s,i,a,n,r){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"auto";t(!0);try{let t;if("auto"===l&&(l=1===i.shiftsPerDay?"simulated-annealing":"genetic"),await new Promise(e=>setTimeout(e,500)),"genetic"===l?(console.log("Using genetic algorithm..."),t=await eB(e,s,i,a,n)):(console.log("Using simulated annealing algorithm..."),t=eT(e,s,i,a,n)),t.success){r(t.schedule);let e="genetic"===l?"Genetic Algorithm":"Simulated Annealing";G.oR.success("Schedule generated with ".concat(e),{description:t.message})}else G.oR.error("Generation failed",{description:t.message})}catch(e){console.error("Schedule generation error:",e),G.oR.error("Generation error",{description:"An unexpected error occurred while generating the schedule."})}finally{t(!1)}}}},eK=()=>{let[e,t]=(0,a.useState)(!1),s=(0,a.useCallback)(()=>{t(e=>!e)},[]);return(0,a.useEffect)(()=>{let e=e=>{e.ctrlKey&&"b"===e.key&&(e.preventDefault(),s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),{isEmployeePanelCollapsed:e,toggleEmployeePanel:s}};function eq(){let e=(0,K.c3)(),{schedules:t,activeScheduleId:s,setActiveScheduleId:n,addSchedule:r,deleteSchedule:l,selectedMonth:u,selectedYear:f,employees:x,setEmployees:N,constraints:w,setConstraints:E,schedule:D,setSchedule:k,settings:P,setSettings:C}=ey(),{addEmployee:I,removeEmployee:A,updateEmployee:T,toggleEmployeeTag:_}=ej(x,N,w,E,D,k,e),{removeConstraint:M,setShiftConstraint:R,setAllShiftsConstraint:O}=eb(w,E),{isGenerating:z,handleGenerateSchedule:F}=eG(),{isEmployeePanelCollapsed:L,toggleEmployeePanel:U}=eK(),[H,V]=(0,a.useState)("");return(0,i.jsx)("div",{children:(0,i.jsxs)(c,{defaultValue:"about",className:"space-y-0",children:[(0,i.jsx)(d,{className:"w-full",children:(0,i.jsxs)("div",{className:"w-full flex justify-between items-center px-6",children:[(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsxs)(h,{value:"about",className:"flex items-center gap-2",children:[(0,i.jsx)(g.A,{className:"w-4 h-4"}),"About"]}),(0,i.jsxs)(h,{value:"setup",className:"flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"w-4 h-4"}),e("page.setup")]}),(0,i.jsxs)(h,{value:"constraints",className:"flex items-center gap-2",children:[(0,i.jsx)(y.A,{className:"w-4 h-4"}),e("page.constraints")]})]}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(ep,{})})]})}),(0,i.jsx)(m,{value:"about",className:"mt-0",children:(0,i.jsx)("div",{className:"container mx-auto p-6 max-w-6xl",children:(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsxs)("div",{className:"text-center max-w-3xl mx-auto",children:[(0,i.jsx)("h1",{className:"text-4xl font-bold mb-4",children:e("page.title")}),(0,i.jsx)("p",{className:"text-lg text-muted-foreground leading-relaxed",children:e("page.description")})]})})})}),(0,i.jsx)(m,{value:"setup",className:"mt-0",children:(0,i.jsx)("div",{className:"container mx-auto p-6 transition-all duration-300 max-w-none",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(q,{schedules:t,activeScheduleId:s,onScheduleSelect:n,onScheduleAdd:r,onScheduleDelete:l}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(p,{variant:"outline",size:"sm",onClick:U,className:"mb-4 shadow-sm hover:shadow-md transition-all",title:L?"Show employee panel (Ctrl+B)":"Hide employee panel (Ctrl+B)",children:L?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.A,{className:"w-4 h-4 mr-2"}),(0,i.jsx)(b.A,{className:"w-4 h-4"}),(0,i.jsx)("span",{className:"ml-1",children:e("employees.showEmployees")})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(S.A,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:e("employees.hideEmployees")})]})}),(0,i.jsxs)("div",{className:o("transition-all duration-300 ease-in-out",L?"grid grid-cols-1 gap-6":"grid grid-cols-1 xl:grid-cols-4 gap-6"),children:[!L&&(0,i.jsx)("div",{className:"transition-all duration-300",children:(0,i.jsx)(ei,{employees:x,selectedEmployee:H,onEmployeeSelect:V,onAddEmployee:I,onRemoveEmployee:A,onUpdateEmployee:T,onToggleTag:_,predefinedTags:["tags.weekendType","tags.rookie","tags.veteran"],hasActiveSchedule:null!==s})}),(0,i.jsx)("div",{className:o("transition-all duration-300",L?"col-span-2":"xl:col-span-3"),children:(0,i.jsx)(em,{schedule:D,employees:x,selectedMonth:u,selectedYear:f,hasActiveSchedule:null!==s,constraints:w,selectedEmployee:H,settings:P,onSetConstraint:(e,t,s,i)=>{void 0===i?O(e,t,s,P.shiftsPerDay):R(e,t,s,i)},onRemoveConstraint:M,onGenerateSchedule:()=>{F(x,w,P,u,f,k)},isGenerating:z})})]})]})]})})}),(0,i.jsx)(m,{value:"constraints",className:"mt-0",children:(0,i.jsx)("div",{className:"container mx-auto p-6 max-w-6xl",children:(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsx)(en,{settings:P,onSettingsChange:C})})})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[208,964,441,684,358],()=>t(9848)),_N_E=e.O()}]);